[0m18:46:52.363685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000244AB46FE20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000244AD712E50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000244AD712F70>]}


============================== 18:46:52.369510 | 0695adcd-226a-4d22-bdab-c2a032c74b9d ==============================
[0m18:46:52.369510 [info ] [MainThread]: Running with dbt=1.10.11
[0m18:46:52.370646 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'warn_error': 'None', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt debug', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'empty': 'None', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m18:46:52.403258 [info ] [MainThread]: dbt version: 1.10.11
[0m18:46:52.404261 [info ] [MainThread]: python version: 3.9.23
[0m18:46:52.405259 [info ] [MainThread]: python path: C:\Users\yshoo\anaconda3\envs\realestate_analytics\python.exe
[0m18:46:52.406260 [info ] [MainThread]: os info: Windows-10-10.0.26100-SP0
[0m18:46:57.471578 [info ] [MainThread]: Using profiles dir at C:\Users\yshoo\.dbt
[0m18:46:57.472629 [info ] [MainThread]: Using profiles.yml file at C:\Users\yshoo\.dbt\profiles.yml
[0m18:46:57.473826 [info ] [MainThread]: Using dbt_project.yml file at C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\dbt_project.yml
[0m18:46:57.476243 [info ] [MainThread]: adapter type: bigquery
[0m18:46:57.477241 [info ] [MainThread]: adapter version: 1.10.2
[0m18:46:57.662305 [info ] [MainThread]: Configuration:
[0m18:46:57.664626 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m18:46:57.665628 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m18:46:57.666625 [info ] [MainThread]: Required dependencies:
[0m18:46:57.666625 [debug] [MainThread]: Executing "git --help"
[0m18:46:57.767596 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone      Clone a repository into a new directory\n   init       Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add        Add file contents to the index\n   mv         Move or rename a file, a directory, or a symlink\n   restore    Restore working tree files\n   rm         Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect     Use binary search to find the commit that introduced a bug\n   diff       Show changes between commits, commit and working tree, etc\n   grep       Print lines matching a pattern\n   log        Show commit logs\n   show       Show various types of objects\n   status     Show the working tree status\n\ngrow, mark and tweak your common history\n   backfill   Download missing objects in a partial clone\n   branch     List, create, or delete branches\n   commit     Record changes to the repository\n   merge      Join two or more development histories together\n   rebase     Reapply commits on top of another base tip\n   reset      Reset current HEAD to the specified state\n   switch     Switch branches\n   tag        Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch      Download objects and refs from another repository\n   pull       Fetch from and integrate with another repository or a local branch\n   push       Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m18:46:57.768594 [debug] [MainThread]: STDERR: "b''"
[0m18:46:57.769736 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m18:46:57.770736 [info ] [MainThread]: Connection:
[0m18:46:57.771735 [info ] [MainThread]:   method: oauth
[0m18:46:57.772813 [info ] [MainThread]:   database: real-estate-project-2025
[0m18:46:57.772813 [info ] [MainThread]:   execution_project: real-estate-project-2025
[0m18:46:57.774062 [info ] [MainThread]:   schema: real_estate_silver
[0m18:46:57.775084 [info ] [MainThread]:   location: asia-northeast1
[0m18:46:57.776441 [info ] [MainThread]:   priority: interactive
[0m18:46:57.777890 [info ] [MainThread]:   maximum_bytes_billed: None
[0m18:46:57.778890 [info ] [MainThread]:   impersonate_service_account: None
[0m18:46:57.778890 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m18:46:57.780134 [info ] [MainThread]:   job_retries: 1
[0m18:46:57.781188 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m18:46:57.782186 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m18:46:57.783190 [info ] [MainThread]:   timeout_seconds: 300
[0m18:46:57.784186 [info ] [MainThread]:   client_id: None
[0m18:46:57.784186 [info ] [MainThread]:   token_uri: None
[0m18:46:57.785666 [info ] [MainThread]:   compute_region: None
[0m18:46:57.786666 [info ] [MainThread]:   dataproc_cluster_name: None
[0m18:46:57.787664 [info ] [MainThread]:   gcs_bucket: None
[0m18:46:57.788669 [info ] [MainThread]:   dataproc_batch: None
[0m18:46:57.789665 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m18:46:58.922178 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m18:46:58.923179 [debug] [MainThread]: On debug: select 1 as id
[0m18:46:58.924299 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:47:12.215083 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:373b213e-5037-4db2-a3a7-ac90e1d5ecc2&page=queryresults
[0m18:47:13.025861 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m18:47:13.027862 [info ] [MainThread]: [32mAll checks passed![0m
[0m18:47:13.030148 [debug] [MainThread]: Command `dbt debug` succeeded at 18:47:13.030148 after 20.87 seconds
[0m18:47:13.031150 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m18:47:13.032149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000244AB46FE20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000244AD6B81C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000244BA969A60>]}
[0m18:47:13.033150 [debug] [MainThread]: Flushing usage events
[0m18:47:14.289966 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:40:09.213882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FDEE5FFEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FDF08A2F70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FDF08A21C0>]}


============================== 21:40:09.223670 | cf02cb3a-8512-4b02-9ce7-a2b74d3dccd3 ==============================
[0m21:40:09.223670 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:40:09.226272 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'quiet': 'False', 'use_experimental_parser': 'False', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:40:16.905864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cf02cb3a-8512-4b02-9ce7-a2b74d3dccd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FDFD97DCA0>]}
[0m21:40:17.012086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cf02cb3a-8512-4b02-9ce7-a2b74d3dccd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FDFDA09790>]}
[0m21:40:17.013401 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:40:18.222496 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:40:18.225500 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m21:40:18.226498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'cf02cb3a-8512-4b02-9ce7-a2b74d3dccd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FDFDAA0E50>]}
[0m21:40:20.519335 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'my_first_dbt_model' in the 'models' section of file 'models\example\schema.yml'
[0m21:40:20.522963 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'my_second_dbt_model' in the 'models' section of file 'models\example\schema.yml'
[0m21:40:20.891243 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.realestate_analytics.unique_my_first_dbt_model_id.16e066b321' (models\example\schema.yml) depends on a node named 'my_first_dbt_model' in package '' which was not found
[0m21:40:20.892242 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.realestate_analytics.not_null_my_first_dbt_model_id.5fb22c2710' (models\example\schema.yml) depends on a node named 'my_first_dbt_model' in package '' which was not found
[0m21:40:20.894244 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.realestate_analytics.unique_my_second_dbt_model_id.57a0f8c493' (models\example\schema.yml) depends on a node named 'my_second_dbt_model' in package '' which was not found
[0m21:40:20.895247 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.realestate_analytics.not_null_my_second_dbt_model_id.151b76d778' (models\example\schema.yml) depends on a node named 'my_second_dbt_model' in package '' which was not found
[0m21:40:21.064610 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt_project.example
[0m21:40:21.083698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cf02cb3a-8512-4b02-9ce7-a2b74d3dccd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FDFF4FA130>]}
[0m21:40:21.506556 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:40:21.511671 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:40:21.580431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cf02cb3a-8512-4b02-9ce7-a2b74d3dccd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FDECC9D3A0>]}
[0m21:40:21.581436 [info ] [MainThread]: Found 1 model, 1 source, 495 macros
[0m21:40:21.582463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cf02cb3a-8512-4b02-9ce7-a2b74d3dccd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FDFD936A90>]}
[0m21:40:21.584461 [info ] [MainThread]: 
[0m21:40:21.584461 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:40:21.585863 [info ] [MainThread]: 
[0m21:40:21.587296 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:40:21.589622 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:40:21.590625 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:40:28.235615 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_real-estate-project-2025, now create_real-estate-project-2025_real_estate_silver)
[0m21:40:28.236843 [debug] [ThreadPool]: Creating schema "database: "real-estate-project-2025"
schema: "real_estate_silver"
"
[0m21:40:28.253753 [debug] [ThreadPool]: On create_real-estate-project-2025_real_estate_silver: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "connection_name": "create_real-estate-project-2025_real_estate_silver"} */
create schema if not exists `real-estate-project-2025`.`real_estate_silver`
  
[0m21:40:28.254753 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:40:29.211398 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:aa595800-bb0a-4822-98a0-b32c97ca15f8&page=queryresults
[0m21:40:32.579224 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:40:32.580670 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:40:33.342372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cf02cb3a-8512-4b02-9ce7-a2b74d3dccd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FDFE48DD00>]}
[0m21:40:33.344371 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:40:33.355371 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:40:33.357373 [info ] [Thread-1  ]: 1 of 1 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:40:33.359371 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_transactions'
[0m21:40:33.361691 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:40:33.379803 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:40:33.383804 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:40:33.429804 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m21:40:33.435858 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

WITH source AS (
    -- „Éá„Éº„Çø„ÇΩ„Éº„Çπ„Çíraw_land„Å´‰∏ÄÊú¨Âåñ
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
),

renamed_and_casted AS (
    -- „Ç´„É©„É†Âêç„ÇíËã±Ë™û„Å´Â§âÊèõ„Åó„ÄÅÂü∫Êú¨ÁöÑ„Å™„Éá„Éº„ÇøÂûã„ÇíÂ§âÊèõ„Åô„Çã
    SELECT
        type AS transaction_type,
        region,
        city_code,
        prefecture,
        city_name,
        district_name,
        station_name,
        SAFE_CAST(distance_to_station_min AS INT64) AS distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        built_year,
        building_structure,
        purpose,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        -- „ÄåÂèñÂºïÊôÇÊúü„Äç„ÇíÊó•‰ªòÂûã„Å´Â§âÊèõ
        CAST(
            REPLACE(
                REPLACE(
                    REPLACE(
                        REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'),
                    'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'),
                'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'),
            'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes
    FROM
        source
),

add_building_age AS (
    -- Âª∫ÁØâÂπ¥„ÇíË•øÊö¶„Å´Â§âÊèõ„Åó„ÄÅÁØâÂπ¥Êï∞„ÇíË®àÁÆó„Åô„Çã
    SELECT
        *,
        -- „ÄåÂª∫ÁØâÂπ¥„Äç„ÇíË•øÊö¶„ÅÆÊï∞ÂÄ§„Å´Â§âÊèõ
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad
    FROM
        renamed_and_casted
)

-- ÊúÄÁµÇÁöÑ„Å™SELECTÊñá
SELECT
    *,
    -- ÂèñÂºïÊôÇÁÇπ„Åß„ÅÆÁØâÂπ¥Êï∞„ÇíË®àÁÆóÔºàÂª∫ÁØâÂπ¥„Åå‰∏çÊòé„Å™Â†¥Âêà„ÅØNULLÔºâ
    EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction
FROM
    add_building_age;


[0m21:40:33.438111 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:40:34.577961 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:8c859253-eb27-4cc0-a276-c3a507d437d5&page=queryresults
[0m21:40:34.973717 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf02cb3a-8512-4b02-9ce7-a2b74d3dccd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FDF78A7A60>]}
[0m21:40:34.974715 [info ] [Thread-1  ]: 1 of 1 OK created sql view model real_estate_silver.stg_transactions ........... [[32mCREATE VIEW (0 processed)[0m in 1.61s]
[0m21:40:34.979358 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:40:34.982237 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:40:34.983736 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:40:34.984746 [debug] [MainThread]: Connection 'create_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:40:34.985752 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:40:34.986770 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:40:34.988009 [info ] [MainThread]: 
[0m21:40:34.989049 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 13.40 seconds (13.40s).
[0m21:40:34.991510 [debug] [MainThread]: Command end result
[0m21:40:35.035625 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:40:35.041878 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:40:35.052432 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:40:35.052432 [info ] [MainThread]: 
[0m21:40:35.054925 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:40:35.054925 [info ] [MainThread]: 
[0m21:40:35.056919 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m21:40:35.058918 [debug] [MainThread]: Command `dbt run` succeeded at 21:40:35.058918 after 25.98 seconds
[0m21:40:35.059919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FDEE5FFEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FDEF995D60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FDFE16F820>]}
[0m21:40:35.060918 [debug] [MainThread]: Flushing usage events
[0m21:40:36.360258 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:00:09.316286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A03D1FE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A050ACE50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A05F5A190>]}


============================== 22:00:09.325626 | 763029a4-c867-443a-b101-353cf112d0b3 ==============================
[0m22:00:09.325626 [info ] [MainThread]: Running with dbt=1.10.11
[0m22:00:09.327630 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'partial_parse': 'True', 'no_print': 'None', 'empty': 'None', 'invocation_command': 'dbt debug', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m22:00:09.390656 [info ] [MainThread]: dbt version: 1.10.11
[0m22:00:09.391654 [info ] [MainThread]: python version: 3.9.23
[0m22:00:09.392653 [info ] [MainThread]: python path: C:\Users\yshoo\anaconda3\envs\realestate_analytics\python.exe
[0m22:00:09.393877 [info ] [MainThread]: os info: Windows-10-10.0.26100-SP0
[0m22:00:17.062697 [info ] [MainThread]: Using profiles dir at C:\Users\yshoo\.dbt
[0m22:00:17.065042 [info ] [MainThread]: Using profiles.yml file at C:\Users\yshoo\.dbt\profiles.yml
[0m22:00:17.066044 [info ] [MainThread]: Using dbt_project.yml file at C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\dbt_project.yml
[0m22:00:17.067374 [info ] [MainThread]: adapter type: bigquery
[0m22:00:17.067374 [info ] [MainThread]: adapter version: 1.10.2
[0m22:00:17.258075 [info ] [MainThread]: Configuration:
[0m22:00:17.260368 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m22:00:17.262585 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m22:00:17.263583 [info ] [MainThread]: Required dependencies:
[0m22:00:17.263583 [debug] [MainThread]: Executing "git --help"
[0m22:00:17.351517 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone      Clone a repository into a new directory\n   init       Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add        Add file contents to the index\n   mv         Move or rename a file, a directory, or a symlink\n   restore    Restore working tree files\n   rm         Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect     Use binary search to find the commit that introduced a bug\n   diff       Show changes between commits, commit and working tree, etc\n   grep       Print lines matching a pattern\n   log        Show commit logs\n   show       Show various types of objects\n   status     Show the working tree status\n\ngrow, mark and tweak your common history\n   backfill   Download missing objects in a partial clone\n   branch     List, create, or delete branches\n   commit     Record changes to the repository\n   merge      Join two or more development histories together\n   rebase     Reapply commits on top of another base tip\n   reset      Reset current HEAD to the specified state\n   switch     Switch branches\n   tag        Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch      Download objects and refs from another repository\n   pull       Fetch from and integrate with another repository or a local branch\n   push       Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:00:17.352516 [debug] [MainThread]: STDERR: "b''"
[0m22:00:17.354644 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:00:17.355855 [info ] [MainThread]: Connection:
[0m22:00:17.356375 [info ] [MainThread]:   method: oauth
[0m22:00:17.357641 [info ] [MainThread]:   database: real-estate-project-2025
[0m22:00:17.358728 [info ] [MainThread]:   execution_project: real-estate-project-2025
[0m22:00:17.359731 [info ] [MainThread]:   schema: real_estate_silver
[0m22:00:17.360726 [info ] [MainThread]:   location: asia-northeast1
[0m22:00:17.361725 [info ] [MainThread]:   priority: interactive
[0m22:00:17.361725 [info ] [MainThread]:   maximum_bytes_billed: None
[0m22:00:17.362742 [info ] [MainThread]:   impersonate_service_account: None
[0m22:00:17.364232 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m22:00:17.364232 [info ] [MainThread]:   job_retries: 1
[0m22:00:17.365255 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m22:00:17.366637 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m22:00:17.367672 [info ] [MainThread]:   timeout_seconds: 300
[0m22:00:17.368674 [info ] [MainThread]:   client_id: None
[0m22:00:17.369928 [info ] [MainThread]:   token_uri: None
[0m22:00:17.369928 [info ] [MainThread]:   compute_region: None
[0m22:00:17.370973 [info ] [MainThread]:   dataproc_cluster_name: None
[0m22:00:17.372992 [info ] [MainThread]:   gcs_bucket: None
[0m22:00:17.372992 [info ] [MainThread]:   dataproc_batch: None
[0m22:00:17.374073 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m22:00:18.997688 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m22:00:18.999038 [debug] [MainThread]: On debug: select 1 as id
[0m22:00:19.000037 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:00:29.028252 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:28a9cd95-c92e-4378-a791-77bfe0bf0a8d&page=queryresults
[0m22:00:29.887485 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m22:00:29.889504 [info ] [MainThread]: [32mAll checks passed![0m
[0m22:00:29.891498 [debug] [MainThread]: Command `dbt debug` succeeded at 22:00:29.891498 after 20.76 seconds
[0m22:00:29.892499 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m22:00:29.892499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A03D1FE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A132443D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A05F7D940>]}
[0m22:00:29.893501 [debug] [MainThread]: Flushing usage events
[0m22:00:31.374253 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:00:40.348900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000225276FFE50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000225299A1F40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000225299A1190>]}


============================== 22:00:40.356011 | ab8796fc-7ffc-455d-a0f2-04b26dd74a17 ==============================
[0m22:00:40.356011 [info ] [MainThread]: Running with dbt=1.10.11
[0m22:00:40.358179 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'partial_parse': 'True', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'no_print': 'None', 'invocation_command': 'dbt run', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m22:00:46.424935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ab8796fc-7ffc-455d-a0f2-04b26dd74a17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022536A8EBB0>]}
[0m22:00:46.530771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ab8796fc-7ffc-455d-a0f2-04b26dd74a17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002252C49F1C0>]}
[0m22:00:46.532080 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m22:00:47.787301 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m22:00:48.333796 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 0 files added, 1 files changed.
[0m22:00:48.334796 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m22:00:48.788440 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt_project.example
[0m22:00:48.819443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ab8796fc-7ffc-455d-a0f2-04b26dd74a17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002253738A130>]}
[0m22:00:48.966273 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m22:00:48.973358 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m22:00:49.027730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ab8796fc-7ffc-455d-a0f2-04b26dd74a17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002253732D310>]}
[0m22:00:49.028730 [info ] [MainThread]: Found 1 model, 1 source, 495 macros
[0m22:00:49.029729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ab8796fc-7ffc-455d-a0f2-04b26dd74a17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022537395130>]}
[0m22:00:49.032730 [info ] [MainThread]: 
[0m22:00:49.033730 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:00:49.034730 [info ] [MainThread]: 
[0m22:00:49.036730 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:00:49.039579 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m22:00:49.040602 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:00:52.948078 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m22:00:52.949078 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:00:53.634630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ab8796fc-7ffc-455d-a0f2-04b26dd74a17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022536FD6E80>]}
[0m22:00:53.636648 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:00:53.646736 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m22:00:53.648738 [info ] [Thread-1  ]: 1 of 1 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m22:00:53.650820 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_transactions'
[0m22:00:53.651818 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m22:00:53.671842 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m22:00:53.675842 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m22:00:53.729343 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m22:00:53.733345 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
),

renamed_and_casted AS (
    SELECT
        type AS transaction_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        SAFE_CAST(distance_to_station_min AS INT64) AS distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        built_year AS built_year_original,
        building_structure,
        purpose,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes
    FROM
        source
),

with_ad_year AS (
    SELECT
        *,
        CASE
            WHEN STARTS_WITH(built_year_original, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year_original, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year_original, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year_original, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year_original, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year_original, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year_original, r'(\d+)') AS INT64)
        END AS built_year_ad
    FROM
        renamed_and_casted
)

SELECT
    * EXCEPT (built_year_original, built_year_ad),
    built_year_ad AS built_year,
    EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,

    -- ‚òÖ‚òÖ‚òÖ „Åì„Åì„Åå„ÄåLDK„Äç„ÇíÂàá„ÇäÂá∫„Åô„Çà„ÅÜ„Å´‰øÆÊ≠£„Åó„Åü„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    CASE
        WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
        WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
        WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
        WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
        WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
        WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
        WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
        WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
        ELSE 'Other'
    END AS floor_plan_category
    -- ‚òÖ‚òÖ‚òÖ „Åì„Åì„Åæ„Åß ‚òÖ‚òÖ‚òÖ
FROM
    with_ad_year;


[0m22:00:53.734791 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m22:00:54.595344 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:61f98586-b3ea-4530-a9ec-efb60264fa79&page=queryresults
[0m22:00:55.541820 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ab8796fc-7ffc-455d-a0f2-04b26dd74a17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022537481280>]}
[0m22:00:55.543937 [info ] [Thread-1  ]: 1 of 1 OK created sql view model real_estate_silver.stg_transactions ........... [[32mCREATE VIEW (0 processed)[0m in 1.89s]
[0m22:00:55.546001 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m22:00:55.548503 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:00:55.550734 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:00:55.551733 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m22:00:55.552735 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m22:00:55.553877 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m22:00:55.554873 [info ] [MainThread]: 
[0m22:00:55.555867 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 6.52 seconds (6.52s).
[0m22:00:55.557971 [debug] [MainThread]: Command end result
[0m22:00:55.595741 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m22:00:55.601221 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m22:00:55.613006 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m22:00:55.614061 [info ] [MainThread]: 
[0m22:00:55.616060 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:00:55.617209 [info ] [MainThread]: 
[0m22:00:55.618418 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:00:55.621552 [debug] [MainThread]: Command `dbt run` succeeded at 22:00:55.620552 after 15.40 seconds
[0m22:00:55.621552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000225276FFE50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022536C90430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002252C49F1C0>]}
[0m22:00:55.622832 [debug] [MainThread]: Flushing usage events
[0m22:00:56.853183 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:07:59.296631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002353C67FEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002353E921F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002353E921220>]}


============================== 21:07:59.306947 | 89657983-5d1a-46f9-bb29-d0f6fb446b93 ==============================
[0m21:07:59.306947 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:07:59.306947 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'quiet': 'False', 'partial_parse': 'True', 'empty': 'False', 'invocation_command': 'dbt run', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:08:06.789802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '89657983-5d1a-46f9-bb29-d0f6fb446b93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002354BA38400>]}
[0m21:08:06.882756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '89657983-5d1a-46f9-bb29-d0f6fb446b93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002354BA47C40>]}
[0m21:08:06.882756 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:08:07.968775 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:08:08.419066 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:08:08.419066 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m21:08:08.799883 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt_project.example
[0m21:08:08.832156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '89657983-5d1a-46f9-bb29-d0f6fb446b93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002354C2D6130>]}
[0m21:08:08.976436 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:08:08.992169 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:08:09.055147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '89657983-5d1a-46f9-bb29-d0f6fb446b93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002354C2EFCA0>]}
[0m21:08:09.055147 [info ] [MainThread]: Found 1 model, 1 source, 495 macros
[0m21:08:09.055147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '89657983-5d1a-46f9-bb29-d0f6fb446b93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002354C0F6D90>]}
[0m21:08:09.055147 [info ] [MainThread]: 
[0m21:08:09.055147 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:08:09.055147 [info ] [MainThread]: 
[0m21:08:09.055147 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:08:09.055147 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:08:09.055147 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:08:17.531650 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:08:17.531650 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:08:18.245548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '89657983-5d1a-46f9-bb29-d0f6fb446b93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002354BA89DC0>]}
[0m21:08:18.245548 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:08:18.268132 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:08:18.268132 [info ] [Thread-1  ]: 1 of 1 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:08:18.271219 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_transactions'
[0m21:08:18.271219 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:08:18.278622 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:08:18.278622 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:08:18.330137 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m21:08:18.330137 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

WITH source AS (
    -- „Éá„Éº„Çø„ÇΩ„Éº„Çπ„Å®„Åó„Å¶raw_land„ÉÜ„Éº„Éñ„É´„ÇíÊåáÂÆö
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
),

interim AS (
    -- „Éá„Éº„ÇøÂûãÂ§âÊèõ„ÄÅÂü∫Êú¨ÁöÑ„Å™Ë®àÁÆó„ÄÅ„É™„Éç„Éº„É†„ÇíË°å„ÅÜ
    SELECT
        -- ÂÖÉ„ÅÆCSV„ÅÆÂàóÈ†Ü„ÇíÁ∂≠ÊåÅ„Åó„Å§„Å§„ÄÅÂ§âÊèõÂá¶ÁêÜ„ÇíË®òËø∞
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        SAFE_CAST(distance_to_station_min AS INT64) AS distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,

        -- Ë•øÊö¶„ÅÆÂª∫ÁØâÂπ¥„ÇíË®àÁÆó (Âæå„Åß„É™„Éç„Éº„É†)
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,

        -- ÈñìÂèñ„Çä„ÅÆ„Ç´„ÉÜ„Ç¥„É™ÂàÜÈ°û„ÇíË®àÁÆó
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category

    FROM
        source
)

-- ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„Å®È†ÜÁï™„ÅÆÂÆöÁæ©
SELECT
    transaction_type,
    price_info_type,
    prefecture,
    city_name,
    district_name,
    station_name,
    distance_to_station_min,
    total_price_jpy,
    price_per_tsubo_jpy,
    floor_plan,
    floor_plan_category, -- ÈñìÂèñ„Çä„ÅÆÈö£„Å´„Ç´„ÉÜ„Ç¥„É™„ÇíÈÖçÁΩÆ
    area_sq_m,
    price_per_sq_m,
    land_shape,
    frontage_m,
    total_floor_area_sq_m,
    built_year_ad AS built_year, -- Ë•øÊö¶„ÅÆÂª∫ÁØâÂπ¥„Çí„Åì„Åì„Å´ÈÖçÁΩÆ
    -- Âª∫ÁØâÂπ¥„ÅÆÈö£„Å´ÁØâÂπ¥Êï∞„ÇíÈÖçÁΩÆ
    EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
    building_structure,
    purpose,
    future_purpose,
    road_direction,
    road_type,
    road_width_m,
    city_planning,
    building_coverage_ratio_pct,
    floor_area_ratio_pct,
    transaction_date,
    renovation,
    special_notes
FROM
    interim;


[0m21:08:18.330137 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:08:19.499289 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:ee2b280d-8e74-4d7b-99ea-35b85cb89064&page=queryresults
[0m21:08:20.317024 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '89657983-5d1a-46f9-bb29-d0f6fb446b93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002354C3EF5B0>]}
[0m21:08:20.319172 [info ] [Thread-1  ]: 1 of 1 OK created sql view model real_estate_silver.stg_transactions ........... [[32mCREATE VIEW (0 processed)[0m in 2.05s]
[0m21:08:20.320493 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:08:20.320493 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:08:20.320493 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:08:20.325319 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:08:20.325319 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:08:20.325319 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:08:20.325319 [info ] [MainThread]: 
[0m21:08:20.329225 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 11.27 seconds (11.27s).
[0m21:08:20.329225 [debug] [MainThread]: Command end result
[0m21:08:20.370887 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:08:20.374323 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:08:20.383617 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:08:20.383617 [info ] [MainThread]: 
[0m21:08:20.383617 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:08:20.383617 [info ] [MainThread]: 
[0m21:08:20.383617 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m21:08:20.383617 [debug] [MainThread]: Command `dbt run` succeeded at 21:08:20.383617 after 21.26 seconds
[0m21:08:20.383617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002353C67FEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002353E04F670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002354BA47C40>]}
[0m21:08:20.396068 [debug] [MainThread]: Flushing usage events
[0m21:08:21.626531 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:21:57.913881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBA7C4FE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBA9EF1F40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBA9EF11C0>]}


============================== 21:21:57.927507 | 027b7f9a-2147-4522-8dd7-0a948443ba13 ==============================
[0m21:21:57.927507 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:21:57.929983 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'partial_parse': 'True', 'warn_error': 'None', 'empty': 'False', 'invocation_command': 'dbt run', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:22:03.279362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '027b7f9a-2147-4522-8dd7-0a948443ba13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBB6FDE670>]}
[0m21:22:03.376423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '027b7f9a-2147-4522-8dd7-0a948443ba13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBA9E672B0>]}
[0m21:22:03.378431 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:22:04.400435 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:22:04.778654 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:22:04.778654 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m21:22:05.171759 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt_project.example
[0m21:22:05.189683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '027b7f9a-2147-4522-8dd7-0a948443ba13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBB78A0FD0>]}
[0m21:22:05.332148 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:22:05.349720 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:22:05.393383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '027b7f9a-2147-4522-8dd7-0a948443ba13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBB78839A0>]}
[0m21:22:05.395395 [info ] [MainThread]: Found 1 model, 1 source, 495 macros
[0m21:22:05.395395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '027b7f9a-2147-4522-8dd7-0a948443ba13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBB76CAFA0>]}
[0m21:22:05.397405 [info ] [MainThread]: 
[0m21:22:05.399415 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:22:05.399415 [info ] [MainThread]: 
[0m21:22:05.399415 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:22:05.404207 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:22:05.404207 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:22:10.767010 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:22:10.768457 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:22:11.447476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '027b7f9a-2147-4522-8dd7-0a948443ba13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBB77F8790>]}
[0m21:22:11.447476 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:22:11.460022 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:22:11.461032 [info ] [Thread-1  ]: 1 of 1 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:22:11.461032 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_transactions'
[0m21:22:11.461032 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:22:11.478475 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:22:11.481310 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:22:11.525143 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m21:22:11.527843 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

WITH source AS (
    -- „Éá„Éº„Çø„ÇΩ„Éº„Çπ„Å®„Åó„Å¶raw_land„ÉÜ„Éº„Éñ„É´„ÇíÊåáÂÆö
    SELECT 
        * 
    FROM 
        `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE
        type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    -- „Éá„Éº„ÇøÂûãÂ§âÊèõ„ÄÅÂü∫Êú¨ÁöÑ„Å™Ë®àÁÆó„ÄÅ„É™„Éç„Éº„É†„ÇíË°å„ÅÜ
    SELECT
        -- ÂÖÉ„ÅÆCSV„ÅÆÂàóÈ†Ü„ÇíÁ∂≠ÊåÅ„Åó„Å§„Å§„ÄÅÂ§âÊèõÂá¶ÁêÜ„ÇíË®òËø∞
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        SAFE_CAST(distance_to_station_min AS INT64) AS distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,

        -- Ë•øÊö¶„ÅÆÂª∫ÁØâÂπ¥„ÇíË®àÁÆó (Âæå„Åß„É™„Éç„Éº„É†)
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,

        -- ÈñìÂèñ„Çä„ÅÆ„Ç´„ÉÜ„Ç¥„É™ÂàÜÈ°û„ÇíË®àÁÆó
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category

    FROM
        source
)

-- ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„Å®È†ÜÁï™„ÅÆÂÆöÁæ©
SELECT
    transaction_type,
    price_info_type,
    prefecture,
    city_name,
    district_name,
    station_name,
    distance_to_station_min,
    total_price_jpy,
    price_per_tsubo_jpy,
    floor_plan,
    floor_plan_category, -- ÈñìÂèñ„Çä„ÅÆÈö£„Å´„Ç´„ÉÜ„Ç¥„É™„ÇíÈÖçÁΩÆ
    area_sq_m,
    price_per_sq_m,
    land_shape,
    frontage_m,
    total_floor_area_sq_m,
    built_year_ad AS built_year, -- Ë•øÊö¶„ÅÆÂª∫ÁØâÂπ¥„Çí„Åì„Åì„Å´ÈÖçÁΩÆ
    -- Âª∫ÁØâÂπ¥„ÅÆÈö£„Å´ÁØâÂπ¥Êï∞„ÇíÈÖçÁΩÆ
    EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
    building_structure,
    purpose,
    future_purpose,
    road_direction,
    road_type,
    road_width_m,
    city_planning,
    building_coverage_ratio_pct,
    floor_area_ratio_pct,
    transaction_date,
    renovation,
    special_notes
FROM
    interim;


[0m21:22:11.527843 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:22:12.539173 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:45260021-c87c-4827-90be-d5768e315a2a&page=queryresults
[0m21:22:13.409288 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '027b7f9a-2147-4522-8dd7-0a948443ba13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBB898D7F0>]}
[0m21:22:13.409288 [info ] [Thread-1  ]: 1 of 1 OK created sql view model real_estate_silver.stg_transactions ........... [[32mCREATE VIEW (0 processed)[0m in 1.95s]
[0m21:22:13.413336 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:22:13.416080 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:22:13.416080 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:22:13.416080 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:22:13.416080 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:22:13.416080 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:22:13.416080 [info ] [MainThread]: 
[0m21:22:13.416080 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 8.02 seconds (8.02s).
[0m21:22:13.416080 [debug] [MainThread]: Command end result
[0m21:22:13.447855 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:22:13.461730 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:22:13.478631 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:22:13.478631 [info ] [MainThread]: 
[0m21:22:13.478631 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:22:13.478631 [info ] [MainThread]: 
[0m21:22:13.478631 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m21:22:13.478631 [debug] [MainThread]: Command `dbt run` succeeded at 21:22:13.478631 after 15.70 seconds
[0m21:22:13.484403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBA7C4FE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBA9E672B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DBB78EA4C0>]}
[0m21:22:13.484403 [debug] [MainThread]: Flushing usage events
[0m21:22:14.693473 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:52:05.356359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001359D28FEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001359F531F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001359F5311F0>]}


============================== 12:52:05.364833 | f3c27e64-ac25-4ed1-8160-db31ffdf42dd ==============================
[0m12:52:05.364833 [info ] [MainThread]: Running with dbt=1.10.11
[0m12:52:05.365833 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'invocation_command': 'dbt run', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'empty': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m12:52:12.415991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f3c27e64-ac25-4ed1-8160-db31ffdf42dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000135AC5F3C40>]}
[0m12:52:12.516059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f3c27e64-ac25-4ed1-8160-db31ffdf42dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000135AC66D460>]}
[0m12:52:12.517062 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m12:52:13.619539 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m12:52:14.089012 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:52:14.091161 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m12:52:14.490209 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt_project.example
[0m12:52:14.516193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f3c27e64-ac25-4ed1-8160-db31ffdf42dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000135ACEE1E80>]}
[0m12:52:14.650349 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m12:52:14.656123 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m12:52:14.720689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f3c27e64-ac25-4ed1-8160-db31ffdf42dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000135ACEC3190>]}
[0m12:52:14.721688 [info ] [MainThread]: Found 1 model, 1 source, 495 macros
[0m12:52:14.722687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f3c27e64-ac25-4ed1-8160-db31ffdf42dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000135ACEE11C0>]}
[0m12:52:14.725691 [info ] [MainThread]: 
[0m12:52:14.725691 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:52:14.726695 [info ] [MainThread]: 
[0m12:52:14.728753 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:52:14.730767 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m12:52:14.730767 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:52:22.669161 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m12:52:22.670175 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:52:23.382988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f3c27e64-ac25-4ed1-8160-db31ffdf42dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000135ACF21FA0>]}
[0m12:52:23.383988 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:52:23.400095 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m12:52:23.401097 [info ] [Thread-1  ]: 1 of 1 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m12:52:23.403365 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_transactions'
[0m12:52:23.403872 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m12:52:23.419885 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m12:52:23.423880 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m12:52:23.472446 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m12:52:23.476937 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

WITH source AS (
    -- „Éá„Éº„Çø„ÇΩ„Éº„Çπ„Å®„Åó„Å¶raw_land„ÉÜ„Éº„Éñ„É´„ÇíÊåáÂÆö„Åó„ÄÅÊûóÂú∞„Å®Ëæ≤Âú∞„ÇíÈô§Â§ñ„Åô„Çã
    SELECT
        *
    FROM
        `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE
        type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    -- „Éá„Éº„ÇøÂûãÂ§âÊèõ„ÄÅÂü∫Êú¨ÁöÑ„Å™Ë®àÁÆó„ÄÅ„É™„Éç„Éº„É†„ÇíË°å„ÅÜ
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        SAFE_CAST(distance_to_station_min AS INT64) AS distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,

        -- Ë•øÊö¶„ÅÆÂª∫ÁØâÂπ¥„ÇíË®àÁÆó (Âæå„Åß„É™„Éç„Éº„É†)
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,

        -- ÈñìÂèñ„Çä„ÅÆ„Ç´„ÉÜ„Ç¥„É™ÂàÜÈ°û„ÇíË®àÁÆó
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,

        -- ‚òÖ‚òÖ‚òÖ „Åì„Åì„ÅåÂëΩÂêç„ÇíÊúÄÁµÇË™øÊï¥„Åó„Åü„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
        CASE
            -- „Åæ„Åö„ÄåÁ¥îÁ≤ã„Å™„ÄçÊßãÈÄ†„ÇíÂÆåÂÖ®‰∏ÄËá¥„ÅßÂÆöÁæ©
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            -- Ê¨°„Å´„ÄåË§áÂêàÊßãÈÄ†„Äç„ÇíÂÑ™ÂÖàÂ∫¶È†Ü„Å´ÈÉ®ÂàÜ‰∏ÄËá¥„ÅßÂÆöÁæ©
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            -- „Åù„Çå‰ª•Â§ñ
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category
        -- ‚òÖ‚òÖ‚òÖ „Åì„Åì„Åæ„Åß ‚òÖ‚òÖ‚òÖ

    FROM
        source
)

-- ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„Å®È†ÜÁï™„ÅÆÂÆöÁæ©
SELECT
    transaction_type,
    price_info_type,
    prefecture,
    city_name,
    district_name,
    station_name,
    distance_to_station_min,
    total_price_jpy,
    price_per_tsubo_jpy,
    floor_plan,
    floor_plan_category,
    area_sq_m,
    price_per_sq_m,
    land_shape,
    frontage_m,
    total_floor_area_sq_m,
    built_year_ad AS built_year,
    EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
    building_structure,
    building_structure_category, -- Âª∫Áâ©„ÅÆÊßãÈÄ†„ÅÆÈö£„Å´„Ç´„ÉÜ„Ç¥„É™„ÇíÈÖçÁΩÆ
    purpose,
    future_purpose,
    road_direction,
    road_type,
    road_width_m,
    city_planning,
    building_coverage_ratio_pct,
    floor_area_ratio_pct,
    transaction_date,
    renovation,
    special_notes
FROM
    interim;


[0m12:52:23.478936 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m12:52:24.588752 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:f5c58f32-c82d-4f62-8ff3-afea2f4cbf90&page=queryresults
[0m12:52:25.334219 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f3c27e64-ac25-4ed1-8160-db31ffdf42dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000135ACFFE760>]}
[0m12:52:25.336486 [info ] [Thread-1  ]: 1 of 1 OK created sql view model real_estate_silver.stg_transactions ........... [[32mCREATE VIEW (0 processed)[0m in 1.93s]
[0m12:52:25.336486 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m12:52:25.338964 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:52:25.340446 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:52:25.341581 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m12:52:25.341581 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m12:52:25.342581 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m12:52:25.342581 [info ] [MainThread]: 
[0m12:52:25.345035 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 10.61 seconds (10.61s).
[0m12:52:25.347286 [debug] [MainThread]: Command end result
[0m12:52:25.385884 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m12:52:25.391361 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m12:52:25.402793 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m12:52:25.404010 [info ] [MainThread]: 
[0m12:52:25.405014 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:52:25.406012 [info ] [MainThread]: 
[0m12:52:25.407010 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:52:25.409079 [debug] [MainThread]: Command `dbt run` succeeded at 12:52:25.409079 after 20.27 seconds
[0m12:52:25.410450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001359D28FEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001359B826EB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000135ACD08B80>]}
[0m12:52:25.411755 [debug] [MainThread]: Flushing usage events
[0m12:52:26.692861 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:18:50.250826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000263EE43FDF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000263EF84F250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000263EFE4A100>]}


============================== 14:18:50.259343 | b7da06b6-9571-4b1c-b0d3-8b044c7ec1f5 ==============================
[0m14:18:50.259343 [info ] [MainThread]: Running with dbt=1.10.11
[0m14:18:50.260350 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'warn_error': 'None', 'quiet': 'False', 'invocation_command': 'dbt run', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m14:18:56.918289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b7da06b6-9571-4b1c-b0d3-8b044c7ec1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000263FD8499D0>]}
[0m14:18:57.016792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b7da06b6-9571-4b1c-b0d3-8b044c7ec1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000263FD7B03D0>]}
[0m14:18:57.017793 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m14:18:58.342857 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m14:18:58.870369 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 1 files changed.
[0m14:18:58.871370 [debug] [MainThread]: Partial parsing: added file: realestate_analytics://models\stg_zipcodes.sql
[0m14:18:58.872372 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m14:18:59.185776 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.realestate_analytics.stg_zipcodes' (models\stg_zipcodes.sql) depends on a source named 'real_estate_bronze.raw_zipcode' which was not found
[0m14:18:59.188373 [debug] [MainThread]: Command `dbt run` failed at 14:18:59.188373 after 9.08 seconds
[0m14:18:59.189373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000263EE43FDF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000263EE76F550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000263EDDF5220>]}
[0m14:18:59.189373 [debug] [MainThread]: Flushing usage events
[0m14:19:00.501305 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:21:01.581479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234D43FFEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234D66A2F70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234D66A21C0>]}


============================== 14:21:01.588014 | 4faaed91-2f1e-43f2-bb41-bf28a6b9c203 ==============================
[0m14:21:01.588014 [info ] [MainThread]: Running with dbt=1.10.11
[0m14:21:01.590016 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'quiet': 'False', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m14:21:07.010688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4faaed91-2f1e-43f2-bb41-bf28a6b9c203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234E37DC9A0>]}
[0m14:21:07.109625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4faaed91-2f1e-43f2-bb41-bf28a6b9c203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234D66167F0>]}
[0m14:21:07.111625 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m14:21:08.235044 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m14:21:08.622715 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 2 files added, 1 files changed.
[0m14:21:08.623720 [debug] [MainThread]: Partial parsing: added file: realestate_analytics://models\stg_zipcodes.sql
[0m14:21:08.624824 [debug] [MainThread]: Partial parsing: added file: realestate_analytics://models\sources.yml
[0m14:21:08.626045 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m14:21:09.222951 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.dbt_project.example
[0m14:21:09.242413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4faaed91-2f1e-43f2-bb41-bf28a6b9c203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234E4254130>]}
[0m14:21:09.385763 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m14:21:09.390763 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m14:21:09.446259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4faaed91-2f1e-43f2-bb41-bf28a6b9c203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234E3E796A0>]}
[0m14:21:09.447744 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m14:21:09.448745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4faaed91-2f1e-43f2-bb41-bf28a6b9c203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234D665FC70>]}
[0m14:21:09.451736 [info ] [MainThread]: 
[0m14:21:09.452742 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:21:09.454160 [info ] [MainThread]: 
[0m14:21:09.454160 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:21:09.462583 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m14:21:09.463723 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:21:15.323779 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m14:21:15.325164 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:21:16.006766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4faaed91-2f1e-43f2-bb41-bf28a6b9c203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234D2A55FA0>]}
[0m14:21:16.008767 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:21:16.018821 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m14:21:16.019814 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m14:21:16.021816 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m14:21:16.022814 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m14:21:16.036202 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m14:21:16.039220 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m14:21:16.083672 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m14:21:16.087797 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
    -- JOIN„Åô„Çã„Åü„ÇÅ„ÅÆÁµêÂêà„Ç≠„Éº„Çí‰ΩúÊàê
    prefecture || city_name || district_name AS address_key
FROM
    source;


[0m14:21:16.088800 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:21:17.115725 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:1c3348d5-6bfc-4e61-8dd2-e69cbcca1ada&page=queryresults
[0m14:21:17.847309 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4faaed91-2f1e-43f2-bb41-bf28a6b9c203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234E531BA30>]}
[0m14:21:17.849309 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.82s]
[0m14:21:17.850307 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m14:21:17.851703 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m14:21:17.853158 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m14:21:17.854163 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m14:21:17.855160 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m14:21:17.862526 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m14:21:17.865772 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m14:21:17.870774 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m14:21:17.875228 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

-- JOINÂØæË±°„ÅÆÈÉµ‰æøÁï™Âè∑„É¢„Éá„É´„ÇíÂÖà„Å´CTE„Å®„Åó„Å¶ÂÆöÁæ©
WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        SAFE_CAST(distance_to_station_min AS INT64) AS distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,

        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,

        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,

        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        
        prefecture || city_name || district_name AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
)

-- ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„Å®È†ÜÁï™„ÅÆÂÆöÁæ©
SELECT
    transaction_type,
    price_info_type,
    zipcode, -- ‚òÖ È†ÜÁï™„Çí„Åì„Åì„Å´ÁßªÂãï
    prefecture,
    city_name,
    district_name,
    station_name,
    distance_to_station_min,
    total_price_jpy,
    price_per_tsubo_jpy,
    floor_plan,
    floor_plan_category,
    area_sq_m,
    price_per_sq_m,
    land_shape,
    frontage_m,
    total_floor_area_sq_m,
    built_year_ad AS built_year,
    EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
    building_structure,
    building_structure_category,
    purpose,
    future_purpose,
    road_direction,
    road_type,
    road_width_m,
    city_planning,
    building_coverage_ratio_pct,
    floor_area_ratio_pct,
    transaction_date,
    renovation,
    special_notes
FROM
    joined;


[0m14:21:17.877228 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:21:18.955083 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:713e00b2-0e6c-4d33-9a96-84509ccb1a72&page=queryresults
[0m14:21:19.028761 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:713e00b2-0e6c-4d33-9a96-84509ccb1a72&page=queryresults
[0m14:21:19.056671 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Unrecognized name: type at [15:11]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m14:21:19.057671 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4faaed91-2f1e-43f2-bb41-bf28a6b9c203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234E57069A0>]}
[0m14:21:19.059675 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 1.20s]
[0m14:21:19.061675 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m14:21:19.062674 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Unrecognized name: type at [15:11]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m14:21:19.065672 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:21:19.066672 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:21:19.066672 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m14:21:19.067670 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m14:21:19.068672 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m14:21:19.069179 [info ] [MainThread]: 
[0m14:21:19.070551 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 9.62 seconds (9.62s).
[0m14:21:19.072024 [debug] [MainThread]: Command end result
[0m14:21:19.341142 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m14:21:19.346137 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m14:21:19.357280 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m14:21:19.358444 [info ] [MainThread]: 
[0m14:21:19.359441 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:21:19.360825 [info ] [MainThread]: 
[0m14:21:19.361826 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m14:21:19.361826 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Unrecognized name: type at [15:11]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m14:21:19.363252 [info ] [MainThread]: 
[0m14:21:19.364252 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m14:21:19.365382 [info ] [MainThread]: 
[0m14:21:19.366885 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m14:21:19.368297 [debug] [MainThread]: Command `dbt run` failed at 14:21:19.368297 after 17.97 seconds
[0m14:21:19.369297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234D43FFEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234E41824F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234E36697F0>]}
[0m14:21:19.370298 [debug] [MainThread]: Flushing usage events
[0m14:21:20.641840 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:28:26.706855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002786B88FEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002786DB32F70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002786DB321C0>]}


============================== 14:28:26.714854 | b5402a6e-b5a5-4f70-ad22-7d80c3603416 ==============================
[0m14:28:26.714854 [info ] [MainThread]: Running with dbt=1.10.11
[0m14:28:26.715854 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'empty': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m14:28:33.345912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b5402a6e-b5a5-4f70-ad22-7d80c3603416', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027874B69070>]}
[0m14:28:33.454956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b5402a6e-b5a5-4f70-ad22-7d80c3603416', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002787ABC6880>]}
[0m14:28:33.456957 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m14:28:34.915853 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m14:28:35.175252 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m14:28:35.176257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'b5402a6e-b5a5-4f70-ad22-7d80c3603416', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002786D2675B0>]}
[0m14:28:37.379692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b5402a6e-b5a5-4f70-ad22-7d80c3603416', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002787B68A9A0>]}
[0m14:28:37.521035 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m14:28:37.527059 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m14:28:37.579147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b5402a6e-b5a5-4f70-ad22-7d80c3603416', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002786B2B34C0>]}
[0m14:28:37.581425 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m14:28:37.582426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b5402a6e-b5a5-4f70-ad22-7d80c3603416', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002787B5FC970>]}
[0m14:28:37.585784 [info ] [MainThread]: 
[0m14:28:37.586807 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:28:37.587820 [info ] [MainThread]: 
[0m14:28:37.589182 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:28:37.597177 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m14:28:37.599447 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:28:41.813296 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m14:28:41.814678 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:28:42.493336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b5402a6e-b5a5-4f70-ad22-7d80c3603416', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002787B5B24C0>]}
[0m14:28:42.494334 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:28:42.502758 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m14:28:42.504847 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m14:28:42.506055 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m14:28:42.507317 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m14:28:42.520379 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m14:28:42.523797 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m14:28:42.571838 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m14:28:42.575193 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
    -- JOIN„Åô„Çã„Åü„ÇÅ„ÅÆÁµêÂêà„Ç≠„Éº„Çí‰ΩúÊàê
    prefecture || city_name || district_name AS address_key
FROM
    source;


[0m14:28:42.576209 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:28:43.435583 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:ed6b03ad-7258-4db4-93ad-e77d3dbb4703&page=queryresults
[0m14:28:44.607665 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b5402a6e-b5a5-4f70-ad22-7d80c3603416', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002787B441430>]}
[0m14:28:44.608972 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 2.10s]
[0m14:28:44.609988 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m14:28:44.611457 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m14:28:44.613914 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m14:28:44.615916 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m14:28:44.617233 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m14:28:44.626488 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m14:28:44.629981 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m14:28:44.635978 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m14:28:44.637979 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

-- JOINÂØæË±°„ÅÆÈÉµ‰æøÁï™Âè∑„É¢„Éá„É´„ÇíÂÖà„Å´CTE„Å®„Åó„Å¶ÂÆöÁæ©
WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        SAFE_CAST(distance_to_station_min AS INT64) AS distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,

        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,

        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,

        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        
        prefecture || city_name || district_name AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
)

-- ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„Å®È†ÜÁï™„ÅÆÂÆöÁæ©
SELECT
    transaction_type,
    price_info_type,
    zipcode, -- ‚òÖ È†ÜÁï™„Çí„Åì„Åì„Å´ÁßªÂãï
    prefecture,
    city_name,
    district_name,
    station_name,
    distance_to_station_min,
    total_price_jpy,
    price_per_tsubo_jpy,
    floor_plan,
    floor_plan_category,
    area_sq_m,
    price_per_sq_m,
    land_shape,
    frontage_m,
    total_floor_area_sq_m,
    built_year_ad AS built_year,
    EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
    building_structure,
    building_structure_category,
    purpose,
    future_purpose,
    road_direction,
    road_type,
    road_width_m,
    city_planning,
    building_coverage_ratio_pct,
    floor_area_ratio_pct,
    transaction_date,
    renovation,
    special_notes
FROM
    joined;


[0m14:28:44.639010 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:28:45.772280 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:2af7846f-eca3-463c-b561-fcaf0e832d11&page=queryresults
[0m14:28:46.265677 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b5402a6e-b5a5-4f70-ad22-7d80c3603416', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002787B59DA00>]}
[0m14:28:46.267728 [info ] [Thread-1  ]: 2 of 2 OK created sql view model real_estate_silver.stg_transactions ........... [[32mCREATE VIEW (0 processed)[0m in 1.65s]
[0m14:28:46.268721 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m14:28:46.271408 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:28:46.272408 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:28:46.273495 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m14:28:46.274728 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m14:28:46.275897 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m14:28:46.277056 [info ] [MainThread]: 
[0m14:28:46.278058 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 8.69 seconds (8.69s).
[0m14:28:46.280289 [debug] [MainThread]: Command end result
[0m14:28:46.322343 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m14:28:46.329534 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m14:28:46.342073 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m14:28:46.343069 [info ] [MainThread]: 
[0m14:28:46.344067 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:28:46.345069 [info ] [MainThread]: 
[0m14:28:46.346068 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m14:28:46.347066 [debug] [MainThread]: Command `dbt run` succeeded at 14:28:46.347066 after 19.79 seconds
[0m14:28:46.349005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002786B88FEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027869C407C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002787B4D2940>]}
[0m14:28:46.350118 [debug] [MainThread]: Flushing usage events
[0m14:28:47.563228 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:13:49.120039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F3F9CFEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F41C72F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F41C72220>]}


============================== 20:13:49.129626 | 1753eb3d-38e9-468c-8e80-7011b4bb8059 ==============================
[0m20:13:49.129626 [info ] [MainThread]: Running with dbt=1.10.11
[0m20:13:49.132061 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'use_experimental_parser': 'False', 'empty': 'False', 'no_print': 'None', 'invocation_command': 'dbt run', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m20:13:56.409554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1753eb3d-38e9-468c-8e80-7011b4bb8059', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F4ED7BFD0>]}
[0m20:13:56.520950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1753eb3d-38e9-468c-8e80-7011b4bb8059', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F41C3F580>]}
[0m20:13:56.521954 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m20:13:57.647741 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m20:13:58.121563 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:13:58.122563 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m20:13:58.561880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1753eb3d-38e9-468c-8e80-7011b4bb8059', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F4F5F2130>]}
[0m20:13:58.709129 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m20:13:58.714679 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m20:13:58.780143 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1753eb3d-38e9-468c-8e80-7011b4bb8059', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F4F597610>]}
[0m20:13:58.781145 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m20:13:58.782146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1753eb3d-38e9-468c-8e80-7011b4bb8059', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F4F538B20>]}
[0m20:13:58.785447 [info ] [MainThread]: 
[0m20:13:58.787804 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:13:58.788797 [info ] [MainThread]: 
[0m20:13:58.790500 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:13:58.799511 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m20:13:58.800545 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:14:06.841009 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m20:14:06.842351 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:14:07.609943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1753eb3d-38e9-468c-8e80-7011b4bb8059', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F4ED40670>]}
[0m20:14:07.610945 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:14:07.618293 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m20:14:07.619673 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m20:14:07.622743 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m20:14:07.623736 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m20:14:07.637998 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m20:14:07.640373 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m20:14:07.688336 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m20:14:07.691335 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
    -- JOIN„Åô„Çã„Åü„ÇÅ„ÅÆÁµêÂêà„Ç≠„Éº„Çí‰ΩúÊàê
    prefecture || city_name || district_name AS address_key
FROM
    source;


[0m20:14:07.693339 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m20:14:08.600555 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:d9fb21ea-b3f7-4a30-8393-56eb37b13ec7&page=queryresults
[0m20:14:09.404484 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1753eb3d-38e9-468c-8e80-7011b4bb8059', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F4F745790>]}
[0m20:14:09.406516 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.78s]
[0m20:14:09.407515 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m20:14:09.409521 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m20:14:09.411341 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m20:14:09.413350 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m20:14:09.414356 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m20:14:09.422470 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m20:14:09.424464 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m20:14:09.430496 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m20:14:09.433497 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        SAFE_CAST(distance_to_station_min AS INT64) AS distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        
        -- ‚òÖ‚òÖ‚òÖ JOIN„Ç≠„Éº„ÅÆ‰ΩúÊàê„É≠„Ç∏„ÉÉ„ÇØ„Çí‰øÆÊ≠£ ‚òÖ‚òÖ‚òÖ
        -- 'Â§ßÂ≠ó'„Å®„ÅÑ„ÅÜÊé•È†≠Ëæû„ÇíÂâäÈô§„Åó„Å¶„Åã„ÇâÁµêÂêà„Ç≠„Éº„Çí‰ΩúÊàê
        prefecture || city_name || TRIM(district_name, 'Â§ßÂ≠ó') AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    -- ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„Å®È†ÜÁï™„ÅÆÂÆöÁæ©
    SELECT
        transaction_type,
        price_info_type,
        zipcode,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        total_price_jpy,
        price_per_tsubo_jpy,
        floor_plan,
        floor_plan_category,
        area_sq_m,
        price_per_sq_m,
        land_shape,
        frontage_m,
        total_floor_area_sq_m,
        built_year_ad AS built_year,
        EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
        building_structure,
        building_structure_category,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        road_width_m,
        city_planning,
        building_coverage_ratio_pct,
        floor_area_ratio_pct,
        transaction_date,
        renovation,
        special_notes
    FROM
        joined
)

-- ÊúÄÁµÇÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
SELECT *
FROM final
WHERE
    -- ÈÉµ‰æøÁï™Âè∑„Åå'100'„ÅßÂßã„Åæ„ÇãÂ≥∂Â∂ºÈÉ®„ÇíÈô§Â§ñ
    (zipcode IS NULL OR NOT STARTS_with(zipcode, '100'))
    
    -- ‚òÖ‚òÖ‚òÖ „Åì„Åì„Åã„Çâ„ÅåËøΩË®ò„Åô„Çã„Ç≥„É°„É≥„Éà ‚òÖ‚òÖ‚òÖ
    -- Âú∞Âå∫Âêç(district_name)„ÅåÁ©∫„ÄÅ„Åæ„Åü„ÅØ '(Â§ßÂ≠ó„Å™„Åó)' „ÅÆ„Éá„Éº„Çø„ÇíÈô§Â§ñ„Åô„Çã„ÄÇ
    -- „Åì„Çå„Å´„Çà„Çä‰∏ÄÈÉ®„ÅÆ23Âå∫„Éá„Éº„Çø„ÇÇÈô§Â§ñ„Åï„Çå„Çã„Åå„ÄÅË™øÊüª„ÅÆÁµêÊûú„ÄÅ
    -- „ÅÑ„Åö„Çå„ÇÇ2016Âπ¥‰ª•Ââç„ÅÆÂè§„ÅÑ„Éá„Éº„Çø„ÅÆ„Åü„ÇÅ„ÄÅÂàÜÊûêÂØæË±°Â§ñ„Å®„Åó„Å¶Ë®±ÂÆπ„Åô„Çã„ÄÇ
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m20:14:09.434498 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m20:14:10.559676 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:df656f16-8e11-4dcb-a64f-720742a8936b&page=queryresults
[0m20:14:10.858565 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1753eb3d-38e9-468c-8e80-7011b4bb8059', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F4F4D7550>]}
[0m20:14:10.859565 [info ] [Thread-1  ]: 2 of 2 OK created sql view model real_estate_silver.stg_transactions ........... [[32mCREATE VIEW (0 processed)[0m in 1.45s]
[0m20:14:10.860995 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m20:14:10.863011 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:14:10.864979 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:14:10.865489 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m20:14:10.866547 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m20:14:10.866547 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m20:14:10.868049 [info ] [MainThread]: 
[0m20:14:10.868936 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 12.08 seconds (12.08s).
[0m20:14:10.870943 [debug] [MainThread]: Command end result
[0m20:14:10.909438 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m20:14:10.915366 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m20:14:10.926826 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m20:14:10.928167 [info ] [MainThread]: 
[0m20:14:10.929443 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:14:10.929950 [info ] [MainThread]: 
[0m20:14:10.930967 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m20:14:10.932969 [debug] [MainThread]: Command `dbt run` succeeded at 20:14:10.931969 after 22.03 seconds
[0m20:14:10.932969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F3F9CFEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F3F3FD8E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F41C3F580>]}
[0m20:14:10.933970 [debug] [MainThread]: Flushing usage events
[0m20:14:12.193864 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:22:35.525461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF53D3FF10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF55FE3310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF55FE31C0>]}


============================== 20:22:35.533700 | 2153fc65-9695-4047-8e68-f17779be7542 ==============================
[0m20:22:35.533700 [info ] [MainThread]: Running with dbt=1.10.11
[0m20:22:35.534708 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'empty': 'False', 'invocation_command': 'dbt run', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m20:22:41.805654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2153fc65-9695-4047-8e68-f17779be7542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF630FD160>]}
[0m20:22:41.913674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2153fc65-9695-4047-8e68-f17779be7542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF631B1AC0>]}
[0m20:22:41.915675 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m20:22:43.358866 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m20:22:43.852566 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:22:43.854629 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m20:22:44.304899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2153fc65-9695-4047-8e68-f17779be7542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF6395F130>]}
[0m20:22:44.450595 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m20:22:44.455960 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m20:22:44.506895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2153fc65-9695-4047-8e68-f17779be7542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF632CCD90>]}
[0m20:22:44.509151 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m20:22:44.511152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2153fc65-9695-4047-8e68-f17779be7542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF637C3250>]}
[0m20:22:44.514595 [info ] [MainThread]: 
[0m20:22:44.515617 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:22:44.516611 [info ] [MainThread]: 
[0m20:22:44.518028 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:22:44.526244 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m20:22:44.527570 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:22:48.731523 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m20:22:48.732278 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:22:49.400297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2153fc65-9695-4047-8e68-f17779be7542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF6383A2E0>]}
[0m20:22:49.401302 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:22:49.419009 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m20:22:49.420008 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m20:22:49.422009 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m20:22:49.423016 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m20:22:49.436512 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m20:22:49.438480 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m20:22:49.488466 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m20:22:49.490479 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
    -- JOIN„Åô„Çã„Åü„ÇÅ„ÅÆÁµêÂêà„Ç≠„Éº„Çí‰ΩúÊàê
    prefecture || city_name || district_name AS address_key
FROM
    source;


[0m20:22:49.491523 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m20:22:50.426339 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:94c947f9-190c-4822-a271-08c05b5e16b4&page=queryresults
[0m20:22:51.349485 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2153fc65-9695-4047-8e68-f17779be7542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF64A84850>]}
[0m20:22:51.351677 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.93s]
[0m20:22:51.352757 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m20:22:51.354757 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m20:22:51.356193 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m20:22:51.357434 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m20:22:51.358582 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m20:22:51.368246 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m20:22:51.371244 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m20:22:51.375245 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m20:22:51.378244 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        SAFE_CAST(distance_to_station_min AS INT64) AS distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        
        -- ‚òÖ‚òÖ‚òÖ JOIN„Ç≠„Éº„ÅÆ‰ΩúÊàê„É≠„Ç∏„ÉÉ„ÇØ„Çí TRIM „Åã„Çâ REGEXP_REPLACE „Å´‰øÆÊ≠£ ‚òÖ‚òÖ‚òÖ
        prefecture || city_name || REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', '') AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    -- ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„Å®È†ÜÁï™„ÅÆÂÆöÁæ©
    SELECT
        transaction_type,
        price_info_type,
        zipcode,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        total_price_jpy,
        price_per_tsubo_jpy,
        floor_plan,
        floor_plan_category,
        area_sq_m,
        price_per_sq_m,
        land_shape,
        frontage_m,
        total_floor_area_sq_m,
        built_year_ad AS built_year,
        EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
        building_structure,
        building_structure_category,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        road_width_m,
        city_planning,
        building_coverage_ratio_pct,
        floor_area_ratio_pct,
        transaction_date,
        renovation,
        special_notes
    FROM
        joined
)

-- ÊúÄÁµÇÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
SELECT *
FROM final
WHERE
    -- ÈÉµ‰æøÁï™Âè∑„Åå'100'„ÅßÂßã„Åæ„ÇãÂ≥∂Â∂ºÈÉ®„ÇíÈô§Â§ñ
    (zipcode IS NULL OR NOT STARTS_WITH(zipcode, '100'))
    -- JOIN„Ç≠„Éº„Å®„Åó„Å¶Ê©üËÉΩ„Åó„Å™„ÅÑÂú∞Âå∫Âêç„ÅÆ„Éá„Éº„Çø„ÇíÈô§Â§ñ
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m20:22:51.379243 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m20:22:52.544831 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:9b42c500-c114-40c0-858e-9ce58df6f906&page=queryresults
[0m20:22:53.014900 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2153fc65-9695-4047-8e68-f17779be7542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF63848F70>]}
[0m20:22:53.016932 [info ] [Thread-1  ]: 2 of 2 OK created sql view model real_estate_silver.stg_transactions ........... [[32mCREATE VIEW (0 processed)[0m in 1.66s]
[0m20:22:53.017960 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m20:22:53.019961 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:22:53.021026 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:22:53.022042 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m20:22:53.023481 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m20:22:53.023481 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m20:22:53.024575 [info ] [MainThread]: 
[0m20:22:53.025575 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 8.51 seconds (8.51s).
[0m20:22:53.028144 [debug] [MainThread]: Command end result
[0m20:22:53.080422 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m20:22:53.085923 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m20:22:53.097628 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m20:22:53.098629 [info ] [MainThread]: 
[0m20:22:53.099627 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:22:53.100628 [info ] [MainThread]: 
[0m20:22:53.101761 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m20:22:53.104461 [debug] [MainThread]: Command `dbt run` succeeded at 20:22:53.104461 after 17.72 seconds
[0m20:22:53.104461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF53D3FF10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF632CCD90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EF631B1AC0>]}
[0m20:22:53.105781 [debug] [MainThread]: Flushing usage events
[0m20:22:54.452390 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:38:47.347004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021ABF80FE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021AC1AB2F40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021AC1AB21C0>]}


============================== 20:38:47.354433 | d729ab09-473d-48ad-9b03-53ecbc88277e ==============================
[0m20:38:47.354433 [info ] [MainThread]: Running with dbt=1.10.11
[0m20:38:47.356745 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'quiet': 'False', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m20:38:53.272755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd729ab09-473d-48ad-9b03-53ecbc88277e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021ABDBE8BB0>]}
[0m20:38:53.372322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd729ab09-473d-48ad-9b03-53ecbc88277e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021ACEB7F2E0>]}
[0m20:38:53.374330 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m20:38:54.494453 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m20:38:54.946463 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:38:54.947505 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m20:38:55.395485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd729ab09-473d-48ad-9b03-53ecbc88277e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021ACF437100>]}
[0m20:38:55.533972 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m20:38:55.539212 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m20:38:55.584598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd729ab09-473d-48ad-9b03-53ecbc88277e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021ABEB16D30>]}
[0m20:38:55.585777 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m20:38:55.586810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd729ab09-473d-48ad-9b03-53ecbc88277e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021ACF112100>]}
[0m20:38:55.591439 [info ] [MainThread]: 
[0m20:38:55.592771 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:38:55.593793 [info ] [MainThread]: 
[0m20:38:55.594965 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:38:55.603616 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m20:38:55.605144 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:39:01.420041 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m20:39:01.422062 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:39:02.117181 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd729ab09-473d-48ad-9b03-53ecbc88277e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021ACEB7F160>]}
[0m20:39:02.118521 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:39:02.127165 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m20:39:02.128352 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m20:39:02.130401 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m20:39:02.131404 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m20:39:02.146669 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m20:39:02.149668 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m20:39:02.201001 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m20:39:02.203266 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
    -- JOIN„Åô„Çã„Åü„ÇÅ„ÅÆÁµêÂêà„Ç≠„Éº„Çí‰ΩúÊàê
    prefecture || city_name || district_name AS address_key
FROM
    source;


[0m20:39:02.204355 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m20:39:03.402753 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:68ff3f66-13c6-447f-8b61-2361de5da6cf&page=queryresults
[0m20:39:04.050755 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd729ab09-473d-48ad-9b03-53ecbc88277e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021ACF582FD0>]}
[0m20:39:04.052763 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.92s]
[0m20:39:04.053757 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m20:39:04.055758 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m20:39:04.057247 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m20:39:04.059393 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m20:39:04.060388 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m20:39:04.068011 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m20:39:04.068992 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m20:39:04.074993 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m20:39:04.076991 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        SAFE_CAST(distance_to_station_min AS INT64) AS distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        
        -- ‚òÖ‚òÖ‚òÖ JOIN„Ç≠„Éº„ÅÆ‰ΩúÊàê„É≠„Ç∏„ÉÉ„ÇØ„Å´„Äå„Ç±„Äç„Å®„Äå„É∂„Äç„ÅÆË°®Ë®òÊè∫„Çå„ÇíÂê∏Âèé„Åô„ÇãÂá¶ÁêÜ„ÇíËøΩÂä† ‚òÖ‚òÖ‚òÖ
        prefecture || city_name || REPLACE(REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''), '„Ç±', '„É∂') AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    -- ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„Å®È†ÜÁï™„ÅÆÂÆöÁæ©
    SELECT
        transaction_type,
        price_info_type,
        zipcode,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        total_price_jpy,
        price_per_tsubo_jpy,
        floor_plan,
        floor_plan_category,
        area_sq_m,
        price_per_sq_m,
        land_shape,
        frontage_m,
        total_floor_area_sq_m,
        built_year_ad AS built_year,
        EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
        building_structure,
        building_structure_category,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        road_width_m,
        city_planning,
        building_coverage_ratio_pct,
        floor_area_ratio_pct,
        transaction_date,
        renovation,
        special_notes
    FROM
        joined
)

-- ÊúÄÁµÇÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
SELECT *
FROM final
WHERE
    -- ÈÉµ‰æøÁï™Âè∑„Åå'100'„ÅßÂßã„Åæ„ÇãÂ≥∂Â∂ºÈÉ®„ÇíÈô§Â§ñ
    (zipcode IS NULL OR NOT STARTS_WITH(zipcode, '100'))
    -- JOIN„Ç≠„Éº„Å®„Åó„Å¶Ê©üËÉΩ„Åó„Å™„ÅÑÂú∞Âå∫Âêç„ÅÆ„Éá„Éº„Çø„ÇíÈô§Â§ñ
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m20:39:04.078999 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m20:39:05.200509 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:af0ce9c7-d0a1-432d-87ed-332ba88eaa57&page=queryresults
[0m20:39:05.492607 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd729ab09-473d-48ad-9b03-53ecbc88277e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021AD092F100>]}
[0m20:39:05.493608 [info ] [Thread-1  ]: 2 of 2 OK created sql view model real_estate_silver.stg_transactions ........... [[32mCREATE VIEW (0 processed)[0m in 1.43s]
[0m20:39:05.494992 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m20:39:05.497499 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:39:05.498498 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:39:05.499498 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m20:39:05.500500 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m20:39:05.501499 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m20:39:05.502499 [info ] [MainThread]: 
[0m20:39:05.503567 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 9.91 seconds (9.91s).
[0m20:39:05.505619 [debug] [MainThread]: Command end result
[0m20:39:05.543828 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m20:39:05.549148 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m20:39:05.560142 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m20:39:05.561585 [info ] [MainThread]: 
[0m20:39:05.562581 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:39:05.563580 [info ] [MainThread]: 
[0m20:39:05.564587 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m20:39:05.567012 [debug] [MainThread]: Command `dbt run` succeeded at 20:39:05.567012 after 18.36 seconds
[0m20:39:05.568241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021ABF80FE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021ABF1CC730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021ACEB7F2E0>]}
[0m20:39:05.569738 [debug] [MainThread]: Flushing usage events
[0m20:39:06.832810 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:40:51.470542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015EDDF50E80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015EE01F2EB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015EE01F2220>]}


============================== 20:40:51.477202 | da53b31b-dff2-4769-b6eb-cfb82ae3a37c ==============================
[0m20:40:51.477202 [info ] [MainThread]: Running with dbt=1.10.11
[0m20:40:51.478647 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'use_experimental_parser': 'False', 'quiet': 'False', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m20:40:56.394191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'da53b31b-dff2-4769-b6eb-cfb82ae3a37c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015EED2DF460>]}
[0m20:40:56.494192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'da53b31b-dff2-4769-b6eb-cfb82ae3a37c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015EE71D1DF0>]}
[0m20:40:56.496301 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m20:40:57.582598 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m20:40:57.995849 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:40:57.996853 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m20:40:58.430946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'da53b31b-dff2-4769-b6eb-cfb82ae3a37c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015EEDB63A00>]}
[0m20:40:58.563285 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m20:40:58.568285 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m20:40:58.602902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'da53b31b-dff2-4769-b6eb-cfb82ae3a37c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015EEDB631C0>]}
[0m20:40:58.603903 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m20:40:58.604906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da53b31b-dff2-4769-b6eb-cfb82ae3a37c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015EEDBA4190>]}
[0m20:40:58.607362 [info ] [MainThread]: 
[0m20:40:58.609366 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:40:58.610366 [info ] [MainThread]: 
[0m20:40:58.611617 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:40:58.619615 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m20:40:58.620614 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:41:01.896994 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m20:41:01.898365 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:41:02.554849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da53b31b-dff2-4769-b6eb-cfb82ae3a37c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015EED4C7580>]}
[0m20:41:02.555850 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:41:02.562845 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m20:41:02.563844 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m20:41:02.565850 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m20:41:02.567861 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m20:41:02.581848 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m20:41:02.584850 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m20:41:02.631668 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m20:41:02.633723 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
    -- JOIN„Åô„Çã„Åü„ÇÅ„ÅÆÁµêÂêà„Ç≠„Éº„Çí‰ΩúÊàê
    prefecture || city_name || district_name AS address_key
FROM
    source;


[0m20:41:02.634720 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m20:41:03.443064 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:0c283823-872d-4d18-8963-a7682f8838e1&page=queryresults
[0m20:41:04.099145 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da53b31b-dff2-4769-b6eb-cfb82ae3a37c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015EEDCC2F40>]}
[0m20:41:04.100240 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.53s]
[0m20:41:04.102239 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m20:41:04.103238 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m20:41:04.104240 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m20:41:04.105616 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m20:41:04.106908 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m20:41:04.117538 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m20:41:04.119534 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m20:41:04.124714 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m20:41:04.127712 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        SAFE_CAST(distance_to_station_min AS INT64) AS distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        
        -- ‚òÖ‚òÖ‚òÖ JOIN„Ç≠„Éº„ÅÆ‰ΩúÊàê„É≠„Ç∏„ÉÉ„ÇØ„Å´„Äå„Ç±„Äç„Å®„Äå„É∂„Äç„ÅÆË°®Ë®òÊè∫„ÇåÂê∏Âèé„ÇíËøΩÂä† ‚òÖ‚òÖ‚òÖ
        prefecture || city_name || REPLACE(REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''), '„Ç±', '„É∂') AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    -- ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„Å®È†ÜÁï™„ÅÆÂÆöÁæ©
    SELECT *
    FROM joined
)

-- ÊúÄÁµÇÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
SELECT
    transaction_type,
    price_info_type,
    zipcode,
    prefecture,
    city_name,
    district_name,
    station_name,
    distance_to_station_min,
    total_price_jpy,
    price_per_tsubo_jpy,
    floor_plan,
    floor_plan_category,
    area_sq_m,
    price_per_sq_m,
    land_shape,
    frontage_m,
    total_floor_area_sq_m,
    built_year_ad AS built_year,
    EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
    building_structure,
    building_structure_category,
    purpose,
    future_purpose,
    road_direction,
    road_type,
    road_width_m,
    city_planning,
    building_coverage_ratio_pct,
    floor_area_ratio_pct,
    transaction_date,
    renovation,
    special_notes
FROM final
WHERE
    -- ‚òÖ‚òÖ‚òÖ Â≥∂Â∂ºÈÉ®„ÅÆÂ∏ÇÁî∫Êùë„ÇíÂàÜÊûêÂØæË±°„Åã„ÇâÈô§Â§ñ ‚òÖ‚òÖ‚òÖ
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    
    -- JOIN„Ç≠„Éº„Å®„Åó„Å¶Ê©üËÉΩ„Åó„Å™„ÅÑÂú∞Âå∫Âêç„ÅÆ„Éá„Éº„Çø„ÇíÈô§Â§ñ
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m20:41:04.128720 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m20:41:05.157426 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:3334143f-44ff-4213-872a-a3594b51d5ac&page=queryresults
[0m20:41:05.673343 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da53b31b-dff2-4769-b6eb-cfb82ae3a37c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015EED447820>]}
[0m20:41:05.675345 [info ] [Thread-1  ]: 2 of 2 OK created sql view model real_estate_silver.stg_transactions ........... [[32mCREATE VIEW (0 processed)[0m in 1.57s]
[0m20:41:05.675345 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m20:41:05.678177 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:41:05.680690 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:41:05.681689 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m20:41:05.682718 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m20:41:05.683813 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m20:41:05.684812 [info ] [MainThread]: 
[0m20:41:05.684812 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 7.07 seconds (7.07s).
[0m20:41:05.687295 [debug] [MainThread]: Command end result
[0m20:41:05.729521 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m20:41:05.737081 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m20:41:05.751717 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m20:41:05.752997 [info ] [MainThread]: 
[0m20:41:05.754408 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:41:05.755407 [info ] [MainThread]: 
[0m20:41:05.756600 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m20:41:05.759243 [debug] [MainThread]: Command `dbt run` succeeded at 20:41:05.759243 after 14.42 seconds
[0m20:41:05.760291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015EDDF50E80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015EDD920D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015EE71D1DF0>]}
[0m20:41:05.761634 [debug] [MainThread]: Flushing usage events
[0m20:41:07.043512 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:50:19.511648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A3A757FEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A3A9823F70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A3A98231C0>]}


============================== 20:50:19.518970 | f00a2072-ac7d-4d9b-a283-fce9833a39bb ==============================
[0m20:50:19.518970 [info ] [MainThread]: Running with dbt=1.10.11
[0m20:50:19.520974 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'quiet': 'False', 'use_experimental_parser': 'False', 'empty': 'False', 'invocation_command': 'dbt run', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m20:50:25.583013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f00a2072-ac7d-4d9b-a283-fce9833a39bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A3B68F50A0>]}
[0m20:50:25.690825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f00a2072-ac7d-4d9b-a283-fce9833a39bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A3B083C2B0>]}
[0m20:50:25.691827 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m20:50:26.950420 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m20:50:27.453449 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m20:50:27.454454 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m20:50:27.454454 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_zipcodes.sql
[0m20:50:27.900994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f00a2072-ac7d-4d9b-a283-fce9833a39bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A3B719F100>]}
[0m20:50:28.038105 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m20:50:28.058404 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m20:50:28.107808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f00a2072-ac7d-4d9b-a283-fce9833a39bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A3A742A8E0>]}
[0m20:50:28.108811 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m20:50:28.109811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f00a2072-ac7d-4d9b-a283-fce9833a39bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A3B7003250>]}
[0m20:50:28.113810 [info ] [MainThread]: 
[0m20:50:28.115172 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:50:28.116275 [info ] [MainThread]: 
[0m20:50:28.118274 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:50:28.125272 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m20:50:28.126550 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:50:33.893207 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m20:50:33.894426 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:50:34.539671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f00a2072-ac7d-4d9b-a283-fce9833a39bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A3A63D4FA0>]}
[0m20:50:34.540660 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:50:34.547344 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m20:50:34.548802 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m20:50:34.551086 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m20:50:34.552166 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m20:50:34.566155 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m20:50:34.568153 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m20:50:34.616288 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m20:50:34.618421 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
    -- ‚òÖ‚òÖ‚òÖ JOIN„Ç≠„Éº‰ΩúÊàêÂâç„Å´Êã¨Âºß„Å®„Åù„ÅÆ‰∏≠Ë∫´„ÇíÈô§Âéª ‚òÖ‚òÖ‚òÖ
    prefecture || city_name || REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', '') AS address_key
FROM
    source;


[0m20:50:34.619645 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m20:50:35.557250 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:870f1bb7-b6ab-4383-b1da-16158ee5bdd2&page=queryresults
[0m20:50:36.152465 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f00a2072-ac7d-4d9b-a283-fce9833a39bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A3B72F1700>]}
[0m20:50:36.154468 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.60s]
[0m20:50:36.156597 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m20:50:36.158071 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m20:50:36.159071 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m20:50:36.161072 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m20:50:36.162123 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m20:50:36.169123 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m20:50:36.172122 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m20:50:36.177730 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m20:50:36.179738 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        SAFE_CAST(distance_to_station_min AS INT64) AS distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        
        -- ‚òÖ‚òÖ‚òÖ „Åì„Å°„Çâ„ÇÇÂêåÊßò„Å´„ÄÅJOIN„Ç≠„Éº‰ΩúÊàêÂâç„Å´Êã¨Âºß„Å®„Åù„ÅÆ‰∏≠Ë∫´„ÇíÈô§Âéª ‚òÖ‚òÖ‚òÖ
        prefecture || city_name || REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''), '„Ç±', '„É∂'), r'Ôºà.*?Ôºâ', '') AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    -- ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„Å®È†ÜÁï™„ÅÆÂÆöÁæ©
    SELECT *
    FROM joined
)

-- ÊúÄÁµÇÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
SELECT
    transaction_type,
    price_info_type,
    zipcode,
    prefecture,
    city_name,
    district_name,
    station_name,
    distance_to_station_min,
    total_price_jpy,
    price_per_tsubo_jpy,
    floor_plan,
    floor_plan_category,
    area_sq_m,
    price_per_sq_m,
    land_shape,
    frontage_m,
    total_floor_area_sq_m,
    built_year_ad AS built_year,
    EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
    building_structure,
    building_structure_category,
    purpose,
    future_purpose,
    road_direction,
    road_type,
    road_width_m,
    city_planning,
    building_coverage_ratio_pct,
    floor_area_ratio_pct,
    transaction_date,
    renovation,
    special_notes
FROM final
WHERE
    -- ‚òÖ‚òÖ‚òÖ Â≥∂Â∂ºÈÉ®„ÅÆÂ∏ÇÁî∫Êùë„ÇíÂàÜÊûêÂØæË±°„Åã„ÇâÈô§Â§ñ ‚òÖ‚òÖ‚òÖ
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    
    -- JOIN„Ç≠„Éº„Å®„Åó„Å¶Ê©üËÉΩ„Åó„Å™„ÅÑÂú∞Âå∫Âêç„ÅÆ„Éá„Éº„Çø„ÇíÈô§Â§ñ
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m20:50:36.181748 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m20:50:37.387542 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:4cc1b23c-96a4-4a9f-ab3e-a9357d2fbf8f&page=queryresults
[0m20:50:37.934015 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f00a2072-ac7d-4d9b-a283-fce9833a39bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A3B86971C0>]}
[0m20:50:37.935021 [info ] [Thread-1  ]: 2 of 2 OK created sql view model real_estate_silver.stg_transactions ........... [[32mCREATE VIEW (0 processed)[0m in 1.77s]
[0m20:50:37.936162 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m20:50:37.938431 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:50:37.940585 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:50:37.940585 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m20:50:37.941601 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m20:50:37.942662 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m20:50:37.943663 [info ] [MainThread]: 
[0m20:50:37.944690 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 9.83 seconds (9.83s).
[0m20:50:37.945908 [debug] [MainThread]: Command end result
[0m20:50:37.984197 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m20:50:37.990167 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m20:50:38.002184 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m20:50:38.003556 [info ] [MainThread]: 
[0m20:50:38.004558 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:50:38.006056 [info ] [MainThread]: 
[0m20:50:38.007085 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m20:50:38.009083 [debug] [MainThread]: Command `dbt run` succeeded at 20:50:38.009083 after 18.64 seconds
[0m20:50:38.010083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A3A757FEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A3A742A8E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A3B083C2B0>]}
[0m20:50:38.011084 [debug] [MainThread]: Flushing usage events
[0m20:50:39.344146 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:01:32.027278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022121CA0EB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022123F43F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022123F43220>]}


============================== 21:01:32.035037 | 9f872808-585c-4d7f-8aca-8fd58c0b96c0 ==============================
[0m21:01:32.035037 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:01:32.036037 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'quiet': 'False', 'invocation_command': 'dbt run', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:01:38.185303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9f872808-585c-4d7f-8aca-8fd58c0b96c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221310157F0>]}
[0m21:01:38.287381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9f872808-585c-4d7f-8aca-8fd58c0b96c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022131028040>]}
[0m21:01:38.288530 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:01:39.556733 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:01:40.136818 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m21:01:40.137818 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m21:01:40.139818 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_zipcodes.sql
[0m21:01:40.573539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9f872808-585c-4d7f-8aca-8fd58c0b96c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221318C9130>]}
[0m21:01:40.710584 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:01:40.717083 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:01:40.766770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9f872808-585c-4d7f-8aca-8fd58c0b96c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022121B39940>]}
[0m21:01:40.768114 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m21:01:40.769132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9f872808-585c-4d7f-8aca-8fd58c0b96c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022131722F70>]}
[0m21:01:40.772135 [info ] [MainThread]: 
[0m21:01:40.773135 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:01:40.775161 [info ] [MainThread]: 
[0m21:01:40.777282 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:01:40.786280 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:01:40.787277 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:01:46.652090 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:01:46.653338 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:01:47.346893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9f872808-585c-4d7f-8aca-8fd58c0b96c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022120AF6F70>]}
[0m21:01:47.348893 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:01:47.356860 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m21:01:47.357863 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m21:01:47.359860 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m21:01:47.362694 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m21:01:47.377373 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m21:01:47.379518 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m21:01:47.423798 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m21:01:47.426095 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
     -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m21:01:47.427441 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:01:48.434458 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:27869d0d-f406-42a5-bc2a-643acea3c477&page=queryresults
[0m21:01:49.191468 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f872808-585c-4d7f-8aca-8fd58c0b96c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022131A107C0>]}
[0m21:01:49.193492 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.83s]
[0m21:01:49.194004 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m21:01:49.195169 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:01:49.197130 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:01:49.198270 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m21:01:49.198270 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:01:49.204656 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:01:49.207123 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:01:49.211576 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m21:01:49.213573 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        SAFE_CAST(distance_to_station_min AS INT64) AS distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        
        -- ‚òÖ‚òÖ‚òÖ „Åì„Å°„Çâ„ÇÇÂÖ®„ÅèÂêå„ÅòÊúÄÁµÇÁâà„ÅÆ„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ„Å´‰øÆÊ≠£ ‚òÖ‚òÖ‚òÖ
        prefecture || city_name || 
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''), -- 1. Â§ßÂ≠ó„ÇíÈô§Âéª
                    r'Ôºà.*?Ôºâ', ''), -- 2. Êã¨Âºß„ÇíÈô§Âéª
                '„Ç±', '„É∂'), -- 3. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
            'Êæ§', 'Ê≤¢') -- 4. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
        AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    -- ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„Å®È†ÜÁï™„ÅÆÂÆöÁæ©
    SELECT *
    FROM joined
)

-- ÊúÄÁµÇÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
SELECT
    transaction_type,
    price_info_type,
    zipcode,
    prefecture,
    city_name,
    district_name,
    station_name,
    distance_to_station_min,
    total_price_jpy,
    price_per_tsubo_jpy,
    floor_plan,
    floor_plan_category,
    area_sq_m,
    price_per_sq_m,
    land_shape,
    frontage_m,
    total_floor_area_sq_m,
    built_year_ad AS built_year,
    EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
    building_structure,
    building_structure_category,
    purpose,
    future_purpose,
    road_direction,
    road_type,
    road_width_m,
    city_planning,
    building_coverage_ratio_pct,
    floor_area_ratio_pct,
    transaction_date,
    renovation,
    special_notes
FROM final
WHERE
    -- ‚òÖ‚òÖ‚òÖ Â≥∂Â∂ºÈÉ®„ÅÆÂ∏ÇÁî∫Êùë„ÇíÂàÜÊûêÂØæË±°„Åã„ÇâÈô§Â§ñ ‚òÖ‚òÖ‚òÖ
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    
    -- JOIN„Ç≠„Éº„Å®„Åó„Å¶Ê©üËÉΩ„Åó„Å™„ÅÑÂú∞Âå∫Âêç„ÅÆ„Éá„Éº„Çø„ÇíÈô§Â§ñ
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m21:01:49.215603 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:01:50.304521 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:aa49b000-2ccc-4d5b-9bad-71a316ed8019&page=queryresults
[0m21:01:50.751530 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f872808-585c-4d7f-8aca-8fd58c0b96c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022132DBD040>]}
[0m21:01:50.752529 [info ] [Thread-1  ]: 2 of 2 OK created sql view model real_estate_silver.stg_transactions ........... [[32mCREATE VIEW (0 processed)[0m in 1.55s]
[0m21:01:50.754986 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:01:50.756486 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:01:50.757866 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:01:50.758880 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:01:50.759883 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:01:50.760883 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:01:50.762880 [info ] [MainThread]: 
[0m21:01:50.763882 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 9.99 seconds (9.99s).
[0m21:01:50.765176 [debug] [MainThread]: Command end result
[0m21:01:50.804845 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:01:50.812991 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:01:50.825426 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:01:50.826427 [info ] [MainThread]: 
[0m21:01:50.827840 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:01:50.828840 [info ] [MainThread]: 
[0m21:01:50.829838 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m21:01:50.830836 [debug] [MainThread]: Command `dbt run` succeeded at 21:01:50.830836 after 18.94 seconds
[0m21:01:50.831841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022121CA0EB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221318E1790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022131028040>]}
[0m21:01:50.832835 [debug] [MainThread]: Flushing usage events
[0m21:01:52.107064 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:23:36.645986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013B7A07FEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013B7C322F70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013B7C3221C0>]}


============================== 21:23:36.654939 | 326617ce-8ba1-4a24-9eed-f87864c33d59 ==============================
[0m21:23:36.654939 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:23:36.656531 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'warn_error': 'None', 'invocation_command': 'dbt run', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:23:45.638058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '326617ce-8ba1-4a24-9eed-f87864c33d59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013B0941D280>]}
[0m21:23:45.747714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '326617ce-8ba1-4a24-9eed-f87864c33d59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013B7C296250>]}
[0m21:23:45.751138 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:23:47.096129 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:23:47.711945 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:23:47.713609 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m21:23:48.225492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '326617ce-8ba1-4a24-9eed-f87864c33d59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013B09CD3130>]}
[0m21:23:48.415262 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:23:48.426608 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:23:48.526477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '326617ce-8ba1-4a24-9eed-f87864c33d59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013B09CD3190>]}
[0m21:23:48.526477 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m21:23:48.526477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '326617ce-8ba1-4a24-9eed-f87864c33d59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013B09B338B0>]}
[0m21:23:48.531103 [info ] [MainThread]: 
[0m21:23:48.534515 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:23:48.536531 [info ] [MainThread]: 
[0m21:23:48.537602 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:23:48.550343 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:23:48.553360 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:23:59.683165 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:23:59.683165 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:24:00.462545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '326617ce-8ba1-4a24-9eed-f87864c33d59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013B786D6FA0>]}
[0m21:24:00.462545 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:24:00.471556 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m21:24:00.471556 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m21:24:00.471556 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m21:24:00.471556 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m21:24:00.491073 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m21:24:00.491073 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m21:24:00.540215 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m21:24:00.544513 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
     -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m21:24:00.545867 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:24:01.854010 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:9debd8ef-e2b1-4a05-8873-62b23ba036b7&page=queryresults
[0m21:24:02.605658 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '326617ce-8ba1-4a24-9eed-f87864c33d59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013B09E281F0>]}
[0m21:24:02.607068 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 2.13s]
[0m21:24:02.609415 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m21:24:02.611737 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:24:02.612725 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:24:02.614404 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m21:24:02.615421 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:24:02.622264 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:24:02.625208 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:24:02.632638 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m21:24:02.635822 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        
        -- ‚òÖ‚òÖ‚òÖ „Åì„Åì„Åã„Çâ„Åådistance_to_station_min„ÅÆÊñ∞„Åó„ÅÑÂ§âÊèõ„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
        CASE
            -- 'H'„ÇíÂê´„ÇÄÁâπÊÆä„Å™ÁØÑÂõ≤Ë°®Ë®ò„ÇíÂÖà„Å´Âá¶ÁêÜ
            WHEN distance_to_station_min = '1H30ÔΩû2H' THEN 105  -- (90 + 120) / 2
            WHEN distance_to_station_min = '1HÔΩû1H30' THEN 75   -- (60 + 90) / 2
            WHEN distance_to_station_min = '2HÔΩû' THEN 120
            
            -- 'ÔΩû' „ÇíÂê´„ÇÄ‰∏ÄËà¨ÁöÑ„Å™ÁØÑÂõ≤Ë°®Ë®ò„ÇíÂá¶ÁêÜÔºà'ÂàÜ'„Å™„Å©„ÅÆÊñáÂ≠ó„ÅØÁÑ°Ë¶ñ„Åï„Çå„ÇãÔºâ
            WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                SAFE_CAST(
                    (
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'^(\d+)') AS INT64) +
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(?:ÔΩû|~)(\d+)') AS INT64)
                    ) / 2 
                AS INT64)
            
            -- ‰∏äË®ò‰ª•Â§ñÔºàÂçòÁ¥î„Å™Êï∞ÂÄ§„ÇÑ'5ÂàÜ'„ÅÆ„Çà„ÅÜ„Å™Ë°®Ë®òÔºâ„Åã„ÇâÊï∞ÂÄ§„ÇíÊäΩÂá∫
            ELSE SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)'), INT64)
        END AS distance_to_station_min,
        -- ‚òÖ‚òÖ‚òÖ „Åì„Åì„Åæ„Åß ‚òÖ‚òÖ‚òÖ

        SAFE_CAST(REGEXP_EXTRACT(total_price, r'(\d+)'), INT64) AS total_price_jpy,
        SAFE_CAST(REGEXP_EXTRACT(price_per_tsubo, r'(\d+)'), INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(REGEXP_EXTRACT(area_sq_m, r'(\d+)'), INT64) AS area_sq_m,
        SAFE_CAST(REGEXP_EXTRACT(price_per_sq_m, r'(\d+)'), INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(REGEXP_EXTRACT(frontage, r'(\d+\.?\d*)'), FLOAT64) AS frontage_m,
        SAFE_CAST(REGEXP_EXTRACT(total_floor_area_sq_m, r'(\d+)'), INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(REGEXP_EXTRACT(road_width_m, r'(\d+\.?\d*)'), FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(REGEXP_EXTRACT(building_coverage_ratio_pct, r'(\d+)'), INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(REGEXP_EXTRACT(floor_area_ratio_pct, r'(\d+)'), INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        
        prefecture || city_name || 
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''),
                    r'Ôºà.*?Ôºâ', ''),
                '„Ç±', '„É∂'),
            'Êæ§', 'Ê≤¢')
        AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    SELECT
        transaction_type,
        price_info_type,
        zipcode,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        total_price_jpy,
        price_per_tsubo_jpy,
        floor_plan,
        floor_plan_category,
        area_sq_m,
        price_per_sq_m,
        land_shape,
        frontage_m,
        total_floor_area_sq_m,
        built_year_ad AS built_year,
        EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
        building_structure,
        building_structure_category,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        road_width_m,
        city_planning,
        building_coverage_ratio_pct,
        floor_area_ratio_pct,
        transaction_date,
        renovation,
        special_notes
    FROM
        joined
)

SELECT *
FROM final
WHERE
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m21:24:02.636835 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:24:03.392524 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:d1957343-993c-4175-ad6c-04a7cee2f95b&page=queryresults
[0m21:24:03.393998 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:d1957343-993c-4175-ad6c-04a7cee2f95b&page=queryresults
[0m21:24:03.414628 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [43:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:24:03.416659 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '326617ce-8ba1-4a24-9eed-f87864c33d59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013B0B194DF0>]}
[0m21:24:03.417667 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 0.80s]
[0m21:24:03.418676 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:24:03.419665 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [43:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m21:24:03.421662 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:24:03.423077 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:24:03.424094 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:24:03.424094 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:24:03.425119 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:24:03.426666 [info ] [MainThread]: 
[0m21:24:03.427879 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 14.89 seconds (14.89s).
[0m21:24:03.429566 [debug] [MainThread]: Command end result
[0m21:24:03.470252 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:24:03.475581 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:24:03.480631 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:24:03.489187 [info ] [MainThread]: 
[0m21:24:03.489187 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:24:03.489187 [info ] [MainThread]: 
[0m21:24:03.492722 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m21:24:03.492722 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [43:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:24:03.492722 [info ] [MainThread]: 
[0m21:24:03.492722 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m21:24:03.498147 [info ] [MainThread]: 
[0m21:24:03.498147 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m21:24:03.498147 [debug] [MainThread]: Command `dbt run` failed at 21:24:03.498147 after 27.11 seconds
[0m21:24:03.502013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013B7A07FEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013B7C296250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013B09D29340>]}
[0m21:24:03.503240 [debug] [MainThread]: Flushing usage events
[0m21:24:04.761136 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:25:39.589771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000273BE17FE20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000273BFB96520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000273C0422F70>]}


============================== 21:25:39.596811 | 65968b0c-aa9c-4e58-88a6-0c5c3b822949 ==============================
[0m21:25:39.596811 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:25:39.600167 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'partial_parse': 'True', 'empty': 'False', 'warn_error': 'None', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:25:45.945994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '65968b0c-aa9c-4e58-88a6-0c5c3b822949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000273CD4CDE20>]}
[0m21:25:46.048774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '65968b0c-aa9c-4e58-88a6-0c5c3b822949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000273C03F9E80>]}
[0m21:25:46.050783 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:25:47.195356 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:25:47.657926 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:25:47.659935 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m21:25:48.093775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '65968b0c-aa9c-4e58-88a6-0c5c3b822949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000273CDD9A100>]}
[0m21:25:48.242849 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:25:48.248612 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:25:48.291546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '65968b0c-aa9c-4e58-88a6-0c5c3b822949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000273CDD9AD90>]}
[0m21:25:48.296854 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m21:25:48.297863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '65968b0c-aa9c-4e58-88a6-0c5c3b822949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000273CDA82A90>]}
[0m21:25:48.298955 [info ] [MainThread]: 
[0m21:25:48.298955 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:25:48.298955 [info ] [MainThread]: 
[0m21:25:48.305783 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:25:48.313862 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:25:48.313862 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:25:52.416536 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:25:52.416536 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:25:53.101071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '65968b0c-aa9c-4e58-88a6-0c5c3b822949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000273BC7D9970>]}
[0m21:25:53.101071 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:25:53.115356 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m21:25:53.117338 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m21:25:53.117338 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m21:25:53.121184 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m21:25:53.136617 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m21:25:53.138125 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m21:25:53.182542 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m21:25:53.182542 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
     -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m21:25:53.182542 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:25:54.292426 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:c0437639-7b6c-454c-98ad-87a2969291a4&page=queryresults
[0m21:25:54.931735 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65968b0c-aa9c-4e58-88a6-0c5c3b822949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000273CDEF5490>]}
[0m21:25:54.931735 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.81s]
[0m21:25:54.931735 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m21:25:54.939668 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:25:54.941419 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:25:54.943104 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m21:25:54.943104 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:25:54.952726 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:25:54.953973 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:25:54.960921 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m21:25:54.960921 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        SAFE_CAST(distance_to_station_min AS INT64) AS distance_to_station_min,
        SAFE_CAST(REGEXP_EXTRACT(total_price, r'(\d+)'), INT64) AS total_price_jpy,
        SAFE_CAST(REGEXP_EXTRACT(price_per_tsubo, r'(\d+)'), INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(REGEXP_EXTRACT(area_sq_m, r'(\d+)'), INT64) AS area_sq_m,
        SAFE_CAST(REGEXP_EXTRACT(price_per_sq_m, r'(\d+)'), INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(REGEXP_EXTRACT(frontage, r'(\d+\.?\d*)'), FLOAT64) AS frontage_m,
        SAFE_CAST(REGEXP_EXTRACT(total_floor_area_sq_m, r'(\d+)'), INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(REGEXP_EXTRACT(road_width_m, r'(\d+\.?\d*)'), FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(REGEXP_EXTRACT(building_coverage_ratio_pct, r'(\d+)'), INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(REGEXP_EXTRACT(floor_area_ratio_pct, r'(\d+)'), INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        
        -- ‚òÖ‚òÖ‚òÖ „Åì„Åì„ÅÆÊúÄÂæå„ÅÆREPLACE„ÇíREGEXP_REPLACE„Å´‰øÆÊ≠£„Åó„Åæ„Åó„Åü ‚òÖ‚òÖ‚òÖ
        prefecture || city_name || 
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''), -- 1. Â§ßÂ≠ó„ÇíÈô§Âéª
                    r'Ôºà.*?Ôºâ', ''), -- 2. Êã¨Âºß„ÇíÈô§Âéª
                '„Ç±', '„É∂'), -- 3. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
            'Êæ§', 'Ê≤¢') -- 4. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
        AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    -- ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„Å®È†ÜÁï™„ÅÆÂÆöÁæ©
    SELECT
        transaction_type,
        price_info_type,
        zipcode,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        total_price_jpy,
        price_per_tsubo_jpy,
        floor_plan,
        floor_plan_category,
        area_sq_m,
        price_per_sq_m,
        land_shape,
        frontage_m,
        total_floor_area_sq_m,
        built_year_ad AS built_year,
        EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
        building_structure,
        building_structure_category;


[0m21:25:54.960921 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:25:55.640262 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:4f5ecaaf-2334-4a44-9e76-c0fbecbd7915&page=queryresults
[0m21:25:55.644043 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:4f5ecaaf-2334-4a44-9e76-c0fbecbd7915&page=queryresults
[0m21:25:55.664768 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [26:56]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:25:55.664768 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65968b0c-aa9c-4e58-88a6-0c5c3b822949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000273CF267F10>]}
[0m21:25:55.664768 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 0.72s]
[0m21:25:55.669967 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:25:55.669967 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [26:56]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m21:25:55.669967 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:25:55.675083 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:25:55.675083 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:25:55.675083 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:25:55.675083 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:25:55.678266 [info ] [MainThread]: 
[0m21:25:55.679285 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 7.38 seconds (7.38s).
[0m21:25:55.683632 [debug] [MainThread]: Command end result
[0m21:25:55.715418 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:25:55.730427 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:25:55.737099 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:25:55.743121 [info ] [MainThread]: 
[0m21:25:55.743121 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:25:55.745275 [info ] [MainThread]: 
[0m21:25:55.747966 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m21:25:55.747966 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [26:56]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:25:55.750007 [info ] [MainThread]: 
[0m21:25:55.750007 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m21:25:55.750007 [info ] [MainThread]: 
[0m21:25:55.750007 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m21:25:55.753544 [debug] [MainThread]: Command `dbt run` failed at 21:25:55.753544 after 16.31 seconds
[0m21:25:55.753544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000273BE17FE20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000273BC716E20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000273CDCB5DC0>]}
[0m21:25:55.753544 [debug] [MainThread]: Flushing usage events
[0m21:25:56.999276 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:28:37.234135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F3239AFF10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F325C53310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F325C531C0>]}


============================== 21:28:37.239615 | fdf161ec-fcfa-420d-9ed8-b2e314c011a5 ==============================
[0m21:28:37.239615 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:28:37.239615 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'quiet': 'False', 'empty': 'False', 'partial_parse': 'True', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:28:42.194498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fdf161ec-fcfa-420d-9ed8-b2e314c011a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F332D67AF0>]}
[0m21:28:42.299748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fdf161ec-fcfa-420d-9ed8-b2e314c011a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F332ED4220>]}
[0m21:28:42.301760 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:28:43.377849 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:28:43.806075 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m21:28:43.815515 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m21:28:43.815515 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_zipcodes.sql
[0m21:28:44.242762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fdf161ec-fcfa-420d-9ed8-b2e314c011a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F3335D3100>]}
[0m21:28:44.374379 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:28:44.374379 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:28:44.418862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fdf161ec-fcfa-420d-9ed8-b2e314c011a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F3335D7610>]}
[0m21:28:44.420510 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m21:28:44.420510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fdf161ec-fcfa-420d-9ed8-b2e314c011a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F333400A00>]}
[0m21:28:44.422125 [info ] [MainThread]: 
[0m21:28:44.422125 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:28:44.422125 [info ] [MainThread]: 
[0m21:28:44.422125 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:28:44.434838 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:28:44.436208 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:28:47.947176 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:28:47.947176 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:28:48.651204 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fdf161ec-fcfa-420d-9ed8-b2e314c011a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F32541DE20>]}
[0m21:28:48.651204 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:28:48.655660 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m21:28:48.655660 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m21:28:48.661475 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m21:28:48.663487 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m21:28:48.675691 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m21:28:48.679900 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m21:28:48.729101 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m21:28:48.729101 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
    -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m21:28:48.729101 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:28:49.779864 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:adcd2c39-5fc9-4e02-94cf-0d673be50ac0&page=queryresults
[0m21:28:50.634166 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdf161ec-fcfa-420d-9ed8-b2e314c011a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F3346F73D0>]}
[0m21:28:50.634166 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.97s]
[0m21:28:50.634166 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m21:28:50.634166 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:28:50.647592 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:28:50.648808 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m21:28:50.648808 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:28:50.653135 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:28:50.653135 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:28:50.665311 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m21:28:50.667320 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        SAFE_CAST(distance_to_station_min AS INT64) AS distance_to_station_min,
        SAFE_CAST(REGEXP_EXTRACT(total_price, r'(\d+)'), INT64) AS total_price_jpy,
        SAFE_CAST(REGEXP_EXTRACT(price_per_tsubo, r'(\d+)'), INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(REGEXP_EXTRACT(area_sq_m, r'(\d+)'), INT64) AS area_sq_m,
        SAFE_CAST(REGEXP_EXTRACT(price_per_sq_m, r'(\d+)'), INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(REGEXP_EXTRACT(frontage, r'(\d+\.?\d*)'), FLOAT64) AS frontage_m,
        SAFE_CAST(REGEXP_EXTRACT(total_floor_area_sq_m, r'(\d+)'), INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(REGEXP_EXTRACT(road_width_m, r'(\d+\.?\d*)'), FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(REGEXP_EXTRACT(building_coverage_ratio_pct, r'(\d+)'), INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(REGEXP_EXTRACT(floor_area_ratio_pct, r'(\d+)'), INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        
        -- ‚òÖ‚òÖ‚òÖ „Åì„Å°„Çâ„ÇÇÂÖ®„ÅèÂêå„ÅòÊúÄÁµÇÁâà„ÅÆ„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ„Å´‰øÆÊ≠£ ‚òÖ‚òÖ‚òÖ
        prefecture || city_name || 
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''), -- 1. Â§ßÂ≠ó„ÇíÈô§Âéª
                    r'Ôºà.*?Ôºâ', ''), -- 2. Êã¨Âºß„ÇíÈô§Âéª
                '„Ç±', '„É∂'), -- 3. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
            'Êæ§', 'Ê≤¢') -- 4. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
        AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    -- ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„Å®È†ÜÁï™„ÅÆÂÆöÁæ©
    SELECT
        transaction_type,
        price_info_type,
        zipcode,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        total_price_jpy,
        price_per_tsubo_jpy,
        floor_plan,
        floor_plan_category,
        area_sq_m,
        price_per_sq_m,
        land_shape,
        frontage_m,
        total_floor_area_sq_m,
        built_year_ad AS built_year,
        EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
        building_structure,
        building_structure_category;


[0m21:28:50.669329 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:28:51.414523 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:39302a45-f716-45c6-8907-300be78f9add&page=queryresults
[0m21:28:51.416635 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:39302a45-f716-45c6-8907-300be78f9add&page=queryresults
[0m21:28:51.428874 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [26:56]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:28:51.430234 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdf161ec-fcfa-420d-9ed8-b2e314c011a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F334A92F40>]}
[0m21:28:51.431234 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 0.78s]
[0m21:28:51.432233 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:28:51.434235 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [26:56]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m21:28:51.436233 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:28:51.437233 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:28:51.437233 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:28:51.438232 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:28:51.439234 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:28:51.440234 [info ] [MainThread]: 
[0m21:28:51.440234 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 7.02 seconds (7.02s).
[0m21:28:51.442348 [debug] [MainThread]: Command end result
[0m21:28:51.489496 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:28:51.493958 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:28:51.496147 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:28:51.496147 [info ] [MainThread]: 
[0m21:28:51.507912 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:28:51.507912 [info ] [MainThread]: 
[0m21:28:51.509716 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m21:28:51.509716 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [26:56]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:28:51.509716 [info ] [MainThread]: 
[0m21:28:51.509716 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m21:28:51.509716 [info ] [MainThread]: 
[0m21:28:51.516403 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m21:28:51.518023 [debug] [MainThread]: Command `dbt run` failed at 21:28:51.518023 after 14.41 seconds
[0m21:28:51.518023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F3239AFF10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F321D88190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F332F40EE0>]}
[0m21:28:51.518023 [debug] [MainThread]: Flushing usage events
[0m21:28:52.742233 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:31:39.015150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E63AEFEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E65D92F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E65D92220>]}


============================== 21:31:39.015150 | be6efe22-a51e-4af4-8ced-071f6a6e3e19 ==============================
[0m21:31:39.015150 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:31:39.024948 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'quiet': 'False', 'partial_parse': 'True', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:31:44.710931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'be6efe22-a51e-4af4-8ced-071f6a6e3e19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E62087EB0>]}
[0m21:31:44.815215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'be6efe22-a51e-4af4-8ced-071f6a6e3e19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E72EADA00>]}
[0m21:31:44.815215 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:31:45.893189 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:31:46.361815 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:31:46.361815 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m21:31:46.797830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'be6efe22-a51e-4af4-8ced-071f6a6e3e19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E73711100>]}
[0m21:31:46.940990 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:31:46.952922 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:31:46.990857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'be6efe22-a51e-4af4-8ced-071f6a6e3e19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E7376B280>]}
[0m21:31:46.990857 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m21:31:46.990857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be6efe22-a51e-4af4-8ced-071f6a6e3e19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E73711B80>]}
[0m21:31:46.996719 [info ] [MainThread]: 
[0m21:31:46.996719 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:31:46.996719 [info ] [MainThread]: 
[0m21:31:46.996719 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:31:47.004678 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:31:47.011367 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:31:50.473479 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:31:50.473479 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:31:51.148039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be6efe22-a51e-4af4-8ced-071f6a6e3e19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E72E605E0>]}
[0m21:31:51.148039 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:31:51.154631 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m21:31:51.154631 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m21:31:51.154631 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m21:31:51.160895 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m21:31:51.171844 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m21:31:51.173854 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m21:31:51.218095 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m21:31:51.218095 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
    -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m21:31:51.221879 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:31:52.051727 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:47bcdfb9-1a89-40e2-83b3-e2e70986bfe7&page=queryresults
[0m21:31:53.608591 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be6efe22-a51e-4af4-8ced-071f6a6e3e19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E738665B0>]}
[0m21:31:53.608591 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 2.45s]
[0m21:31:53.608591 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m21:31:53.615029 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:31:53.615029 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:31:53.615029 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m21:31:53.615029 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:31:53.624205 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:31:53.624205 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:31:53.631304 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m21:31:53.631304 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        
        -- ‚òÖ‚òÖ‚òÖ BUG FIX 1: distance_to_station_min „ÅÆÂ§âÊèõ„É≠„Ç∏„ÉÉ„ÇØ„Çí‰øÆÊ≠£ ‚òÖ‚òÖ‚òÖ
        CASE
            WHEN distance_to_station_min = '1H30ÔΩû2H' THEN 105
            WHEN distance_to_station_min = '1HÔΩû1H30' THEN 75
            WHEN distance_to_station_min = '2HÔΩû' THEN 120
            WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                CAST(
                    (
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'^(\d+)') AS INT64) +
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(?:ÔΩû|~)(\d+)') AS INT64)
                    ) / 2
                AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)'), INT64)
        END AS distance_to_station_min,

        SAFE_CAST(REGEXP_EXTRACT(total_price, r'(\d+)'), INT64) AS total_price_jpy,
        SAFE_CAST(REGEXP_EXTRACT(price_per_tsubo, r'(\d+)'), INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(REGEXP_EXTRACT(area_sq_m, r'(\d+)'), INT64) AS area_sq_m,
        SAFE_CAST(REGEXP_EXTRACT(price_per_sq_m, r'(\d+)'), INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(REGEXP_EXTRACT(frontage, r'(\d+\.?\d*)'), FLOAT64) AS frontage_m,
        SAFE_CAST(REGEXP_EXTRACT(total_floor_area_sq_m, r'(\d+)'), INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(REGEXP_EXTRACT(road_width_m, r'(\d+\.?\d*)'), FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(REGEXP_EXTRACT(building_coverage_ratio_pct, r'(\d+)'), INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(REGEXP_EXTRACT(floor_area_ratio_pct, r'(\d+)'), INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        
        -- ‚òÖ‚òÖ‚òÖ BUG FIX 2: address_key „ÅÆ‰ΩúÊàê„É≠„Ç∏„ÉÉ„ÇØ„Çí‰øÆÊ≠£ ‚òÖ‚òÖ‚òÖ
        prefecture || city_name || 
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''), -- 1. Â§ßÂ≠ó
                    r'Ôºà.*?Ôºâ', ''), -- 2. Êã¨Âºß
                '„Ç±', '„É∂'), -- 3. „Ç±
            'Êæ§', 'Ê≤¢') -- 4. Êæ§
        AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    -- ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„Å®È†ÜÁï™„ÅÆÂÆöÁæ©
    SELECT
        transaction_type,
        price_info_type,
        zipcode,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        total_price_jpy,
        price_per_tsubo_jpy,
        floor_plan,
        floor_plan_category,
        area_sq_m,
        price_per_sq_m,
        land_shape,
        frontage_m,
        total_floor_area_sq_m,
        built_year_ad AS built_year,
        EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
        building_structure,
        building_structure_category,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        road_width_m,
        city_planning,
        building_coverage_ratio_pct,
        floor_area_ratio_pct,
        transaction_date,
        renovation,
        special_notes
    FROM
        joined
)

SELECT *
FROM final
WHERE
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m21:31:53.631304 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:31:54.294064 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:46fccac0-e5be-459b-8da3-18434eec4b0a&page=queryresults
[0m21:31:54.295118 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:46fccac0-e5be-459b-8da3-18434eec4b0a&page=queryresults
[0m21:31:54.305800 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [38:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:31:54.309346 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be6efe22-a51e-4af4-8ced-071f6a6e3e19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E73866370>]}
[0m21:31:54.309346 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 0.69s]
[0m21:31:54.309346 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:31:54.309346 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [38:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m21:31:54.315768 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:31:54.317778 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:31:54.317778 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:31:54.317778 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:31:54.319787 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:31:54.319787 [info ] [MainThread]: 
[0m21:31:54.319787 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 7.32 seconds (7.32s).
[0m21:31:54.321540 [debug] [MainThread]: Command end result
[0m21:31:54.353639 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:31:54.368514 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:31:54.370709 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:31:54.370709 [info ] [MainThread]: 
[0m21:31:54.370709 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:31:54.384383 [info ] [MainThread]: 
[0m21:31:54.384383 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m21:31:54.384383 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [38:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:31:54.384383 [info ] [MainThread]: 
[0m21:31:54.384383 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m21:31:54.384383 [info ] [MainThread]: 
[0m21:31:54.384383 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m21:31:54.392617 [debug] [MainThread]: Command `dbt run` failed at 21:31:54.392617 after 15.51 seconds
[0m21:31:54.392617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E63AEFEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E72E7CDF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E74878100>]}
[0m21:31:54.394914 [debug] [MainThread]: Flushing usage events
[0m21:31:55.673240 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:34:42.161718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D3194EFEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D31B793F70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D31B7931C0>]}


============================== 21:34:42.168914 | dd9bd30c-ba1f-41e9-9ca0-4be5ac7550fe ==============================
[0m21:34:42.168914 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:34:42.171141 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'no_print': 'None', 'empty': 'False', 'warn_error': 'None', 'invocation_command': 'dbt run', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:34:48.055847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dd9bd30c-ba1f-41e9-9ca0-4be5ac7550fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D322794D90>]}
[0m21:34:48.164346 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dd9bd30c-ba1f-41e9-9ca0-4be5ac7550fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D31AF3D910>]}
[0m21:34:48.166446 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:34:49.533439 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:34:50.092875 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:34:50.094875 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m21:34:50.591366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dd9bd30c-ba1f-41e9-9ca0-4be5ac7550fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D329112130>]}
[0m21:34:50.767429 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:34:50.775534 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:34:50.851630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dd9bd30c-ba1f-41e9-9ca0-4be5ac7550fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D328F73040>]}
[0m21:34:50.858844 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m21:34:50.866747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dd9bd30c-ba1f-41e9-9ca0-4be5ac7550fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D328F50EE0>]}
[0m21:34:50.868758 [info ] [MainThread]: 
[0m21:34:50.870768 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:34:50.873481 [info ] [MainThread]: 
[0m21:34:50.874494 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:34:50.881789 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:34:50.881789 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:34:57.069997 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:34:57.069997 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:34:57.841888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dd9bd30c-ba1f-41e9-9ca0-4be5ac7550fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D329141310>]}
[0m21:34:57.850016 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:34:57.854128 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m21:34:57.854128 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m21:34:57.854128 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m21:34:57.854128 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m21:34:57.871491 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m21:34:57.871491 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m21:34:57.935822 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m21:34:57.939171 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
    -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m21:34:57.939171 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:34:59.409019 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:f42bd4e1-4317-4efb-b593-b38bfc0f04a1&page=queryresults
[0m21:35:00.098774 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd9bd30c-ba1f-41e9-9ca0-4be5ac7550fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D329265640>]}
[0m21:35:00.099774 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 2.24s]
[0m21:35:00.101774 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m21:35:00.103363 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:35:00.106520 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:35:00.107539 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m21:35:00.108518 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:35:00.116729 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:35:00.118729 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:35:00.125327 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m21:35:00.128329 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,

        -- ‚òÖ‚òÖ‚òÖ BUG FIX 1: distance_to_station_min „ÅÆÂ§âÊèõ„É≠„Ç∏„ÉÉ„ÇØ„ÇíÂÆåÂÖ®‰øÆÊ≠£ ‚òÖ‚òÖ‚òÖ
        CASE
            WHEN distance_to_station_min = '1H30ÔΩû2H' THEN 105
            WHEN distance_to_station_min = '1HÔΩû1H30' THEN 75
            WHEN distance_to_station_min = '2HÔΩû' THEN 120
            WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                CAST(
                    (
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'^(\d+)') AS INT64)
                        +
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(?:ÔΩû|~)(\d+)') AS INT64)
                    ) / 2
                AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)'), INT64)
        END AS distance_to_station_min,

        SAFE_CAST(REGEXP_EXTRACT(total_price, r'(\d+)'), INT64) AS total_price_jpy,
        SAFE_CAST(REGEXP_EXTRACT(price_per_tsubo, r'(\d+)'), INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(REGEXP_EXTRACT(area_sq_m, r'(\d+)'), INT64) AS area_sq_m,
        SAFE_CAST(REGEXP_EXTRACT(price_per_sq_m, r'(\d+)'), INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(REGEXP_EXTRACT(frontage, r'(\d+\.?\d*)'), FLOAT64) AS frontage_m,
        SAFE_CAST(REGEXP_EXTRACT(total_floor_area_sq_m, r'(\d+)'), INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(REGEXP_EXTRACT(road_width_m, r'(\d+\.?\d*)'), FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(REGEXP_EXTRACT(building_coverage_ratio_pct, r'(\d+)'), INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(REGEXP_EXTRACT(floor_area_ratio_pct, r'(\d+)'), INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,

        -- ‚òÖ‚òÖ‚òÖ BUG FIX 2: address_key „ÅÆ‰ΩúÊàê„É≠„Ç∏„ÉÉ„ÇØ„ÇíÂÆåÂÖ®‰øÆÊ≠£ ‚òÖ‚òÖ‚òÖ
        prefecture || city_name ||
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''),
                        r'Ôºà.*?Ôºâ', ''
                    ),
                '„Ç±', '„É∂'),
            'Êæ§', 'Ê≤¢')
        AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    -- ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„Å®È†ÜÁï™„ÅÆÂÆöÁæ©
    SELECT
        transaction_type,
        price_info_type,
        zipcode,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        total_price_jpy,
        price_per_tsubo_jpy,
        floor_plan,
        floor_plan_category,
        area_sq_m,
        price_per_sq_m,
        land_shape,
        frontage_m,
        total_floor_area_sq_m,
        built_year_ad AS built_year,
        EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
        building_structure,
        building_structure_category,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        road_width_m,
        city_planning,
        building_coverage_ratio_pct,
        floor_area_ratio_pct,
        transaction_date,
        renovation,
        special_notes
    FROM
        joined
)

SELECT *
FROM final
WHERE
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m21:35:00.129327 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:35:00.844963 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:b7a7f5d3-4963-4329-9ec0-bc4743936023&page=queryresults
[0m21:35:00.844963 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:b7a7f5d3-4963-4329-9ec0-bc4743936023&page=queryresults
[0m21:35:00.860641 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [39:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:35:00.860641 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd9bd30c-ba1f-41e9-9ca0-4be5ac7550fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D32A5D4CD0>]}
[0m21:35:00.860641 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 0.75s]
[0m21:35:00.871050 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:35:00.871459 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [39:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m21:35:00.875469 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:35:00.876488 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:35:00.876488 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:35:00.878499 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:35:00.878499 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:35:00.878499 [info ] [MainThread]: 
[0m21:35:00.878499 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 10.00 seconds (10.00s).
[0m21:35:00.878499 [debug] [MainThread]: Command end result
[0m21:35:00.925912 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:35:00.930218 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:35:00.945251 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:35:00.945251 [info ] [MainThread]: 
[0m21:35:00.945251 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:35:00.945251 [info ] [MainThread]: 
[0m21:35:00.945251 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m21:35:00.945251 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [39:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:35:00.945251 [info ] [MainThread]: 
[0m21:35:00.954460 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m21:35:00.955638 [info ] [MainThread]: 
[0m21:35:00.957651 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m21:35:00.959661 [debug] [MainThread]: Command `dbt run` failed at 21:35:00.959661 after 18.93 seconds
[0m21:35:00.959661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D3194EFEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D3288ACE50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D32A2AEA00>]}
[0m21:35:00.959661 [debug] [MainThread]: Flushing usage events
[0m21:35:02.325163 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:39:53.468904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A377DFE50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A39A83F40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A39A83190>]}


============================== 21:39:53.474441 | 973e684b-d8b6-41e1-9836-308931d47389 ==============================
[0m21:39:53.474441 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:39:53.474441 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'partial_parse': 'True', 'quiet': 'False', 'empty': 'False', 'invocation_command': 'dbt run', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:40:00.031013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '973e684b-d8b6-41e1-9836-308931d47389', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A35D76250>]}
[0m21:40:00.144049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '973e684b-d8b6-41e1-9836-308931d47389', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A46BA4670>]}
[0m21:40:00.146049 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:40:01.832252 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:40:02.721271 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:40:02.723419 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m21:40:03.179346 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '973e684b-d8b6-41e1-9836-308931d47389', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A473FA130>]}
[0m21:40:03.331908 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:40:03.338286 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:40:03.391527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '973e684b-d8b6-41e1-9836-308931d47389', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A4723ED30>]}
[0m21:40:03.392545 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m21:40:03.393546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '973e684b-d8b6-41e1-9836-308931d47389', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A47263D30>]}
[0m21:40:03.395547 [info ] [MainThread]: 
[0m21:40:03.396589 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:40:03.397587 [info ] [MainThread]: 
[0m21:40:03.399645 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:40:03.408109 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:40:03.409105 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:40:08.736690 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:40:08.737690 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:40:09.600071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '973e684b-d8b6-41e1-9836-308931d47389', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A46B55AF0>]}
[0m21:40:09.601072 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:40:09.610070 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m21:40:09.611070 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m21:40:09.614072 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m21:40:09.615071 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m21:40:09.630076 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m21:40:09.633079 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m21:40:09.681589 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m21:40:09.684591 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
    -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m21:40:09.685589 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:40:10.603249 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:c781db4d-b99d-401d-8f23-d215e1032bfc&page=queryresults
[0m21:40:11.382842 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '973e684b-d8b6-41e1-9836-308931d47389', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A47554940>]}
[0m21:40:11.384847 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.77s]
[0m21:40:11.385847 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m21:40:11.386842 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:40:11.388153 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:40:11.390399 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m21:40:11.391398 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:40:11.397589 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:40:11.402351 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:40:11.407786 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m21:40:11.414828 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

-- CTE Step 1: BronzeÂ±§„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„ÄÅÂü∫Êú¨ÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞„ÇíË°å„ÅÜ
WITH source AS (
    SELECT *
    FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

-- CTE Step 2: ÂÄãÂà•„ÅÆ„Ç´„É©„É†„ÅÆ„Éá„Éº„ÇøÂûãÂ§âÊèõ„Å®Âü∫Êú¨ÁöÑ„Å™„ÇØ„É™„Éº„Éã„É≥„Ç∞„ÇíË°å„ÅÜ
cleaned_source AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        -- Ë§áÈõë„Å™Ë∑ùÈõ¢Ë°®Ë®ò„Çí„É´„Éº„É´„Éô„Éº„Çπ„ÅßINT„Å´Â§âÊèõ
        CASE
            WHEN distance_to_station_min = '1H30ÔΩû2H' THEN 105
            WHEN distance_to_station_min = '1HÔΩû1H30' THEN 75
            WHEN distance_to_station_min = '2HÔΩû' THEN 120
            WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                CAST( (SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'^(\d+)') AS INT64) + SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(?:ÔΩû|~)(\d+)') AS INT64)) / 2 AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)'), INT64)
        END AS distance_to_station_min,
        SAFE_CAST(REGEXP_EXTRACT(total_price, r'(\d+)'), INT64) AS total_price_jpy,
        SAFE_CAST(REGEXP_EXTRACT(price_per_tsubo, r'(\d+)'), INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(REGEXP_EXTRACT(area_sq_m, r'(\d+)'), INT64) AS area_sq_m,
        SAFE_CAST(REGEXP_EXTRACT(price_per_sq_m, r'(\d+)'), INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(REGEXP_EXTRACT(frontage, r'(\d+\.?\d*)'), FLOAT64) AS frontage_m,
        SAFE_CAST(REGEXP_EXTRACT(total_floor_area_sq_m, r'(\d+)'), INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(REGEXP_EXTRACT(road_width_m, r'(\d+\.?\d*)'), FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(REGEXP_EXTRACT(building_coverage_ratio_pct, r'(\d+)'), INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(REGEXP_EXTRACT(floor_area_ratio_pct, r'(\d+)'), INT64) AS floor_area_ratio_pct,
        CAST( REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01') AS DATE) AS transaction_date,
        renovation,
        special_notes,
        built_year AS original_built_year
    FROM source
),

-- CTE Step 3: Êñ∞„Åó„ÅÑ„Ç´„ÉÜ„Ç¥„É™Âàó„ÇÑË®àÁÆóÂàóÔºàÁâπÂæ¥ÈáèÔºâ„Çí‰ΩúÊàê„Åô„Çã
feature_engineered AS (
    SELECT
        *,
        -- ÂíåÊö¶„ÇíË•øÊö¶„Å´Â§âÊèõ
        CASE
            WHEN STARTS_WITH(original_built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(original_built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(original_built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        -- ÈñìÂèñ„Çä„ÇíÂàÜÈ°û
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        -- Âª∫Áâ©„ÅÆÊßãÈÄ†„ÇíÂàÜÈ°û
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category
    FROM cleaned_source
),

-- CTE Step 4: JOIN„ÅÆ„Åü„ÇÅ„ÅÆÁµêÂêà„Ç≠„Éº„Çí‰ΩúÊàê„Åô„Çã
transactions_with_key AS (
    SELECT
        *,
        -- Ë§áÊï∞„ÅÆË°®Ë®òÊè∫„Çå„ÇíÂê∏Âèé„Åô„ÇãÁµêÂêà„Ç≠„Éº
        prefecture || city_name ||
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''),
                        r'Ôºà.*?Ôºâ', ''
                    ),
                '„Ç±', '„É∂'),
            'Êæ§', 'Ê≤¢')
        AS address_key
    FROM feature_engineered
),

zipcodes_with_key AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

-- CTE Step 5: ÂèñÂºï„Éá„Éº„Çø„Å®ÈÉµ‰æøÁï™Âè∑„ÇíJOIN„Åô„Çã
joined AS (
    SELECT
        transactions_with_key.*,
        zipcodes_with_key.zipcode
    FROM
        transactions_with_key
    LEFT JOIN zipcodes_with_key
        ON transactions_with_key.address_key = zipcodes_with_key.address_key
),

-- CTE Step 6: ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„ÄÅ„É™„Éç„Éº„É†„ÄÅË®àÁÆó„ÇíË°å„ÅÜ
final_model AS (
    SELECT
        transaction_type,
        price_info_type,
        zipcode,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        total_price_jpy,
        price_per_tsubo_jpy,
        floor_plan,
        floor_plan_category,
        area_sq_m,
        price_per_sq_m,
        land_shape,
        frontage_m,
        total_floor_area_sq_m,
        built_year_ad AS built_year,
        EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
        building_structure,
        building_structure_category,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        road_width_m,
        city_planning,
        building_coverage_ratio_pct,
        floor_area_ratio_pct,
        transaction_date,
        renovation,
        special_notes
    FROM
        joined
)

-- ÊúÄÁµÇÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
SELECT *
FROM final_model
WHERE
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m21:40:11.416831 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:40:12.154963 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:373b08cc-0d4a-43c3-a959-5325a60e7bd3&page=queryresults
[0m21:40:12.155469 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:373b08cc-0d4a-43c3-a959-5325a60e7bd3&page=queryresults
[0m21:40:12.204424 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [31:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:40:12.205425 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '973e684b-d8b6-41e1-9836-308931d47389', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A47554700>]}
[0m21:40:12.206834 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 0.82s]
[0m21:40:12.209170 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:40:12.210283 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [31:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m21:40:12.212299 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:40:12.213305 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:40:12.214772 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:40:12.215772 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:40:12.215772 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:40:12.217224 [info ] [MainThread]: 
[0m21:40:12.218243 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 8.82 seconds (8.82s).
[0m21:40:12.220256 [debug] [MainThread]: Command end result
[0m21:40:12.270384 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:40:12.277812 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:40:12.295628 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:40:12.296628 [info ] [MainThread]: 
[0m21:40:12.297782 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:40:12.298797 [info ] [MainThread]: 
[0m21:40:12.300796 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m21:40:12.301795 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [31:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:40:12.302794 [info ] [MainThread]: 
[0m21:40:12.304065 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m21:40:12.305077 [info ] [MainThread]: 
[0m21:40:12.306069 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m21:40:12.308574 [debug] [MainThread]: Command `dbt run` failed at 21:40:12.308574 after 18.99 seconds
[0m21:40:12.310203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A377DFE50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A46BA4670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A46D64A00>]}
[0m21:40:12.311212 [debug] [MainThread]: Flushing usage events
[0m21:40:13.640074 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:45:24.053817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025D7042FF10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025D726D3310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025D726D31C0>]}


============================== 21:45:24.062900 | 3b8d9830-f572-48b8-b6dd-973f135b362a ==============================
[0m21:45:24.062900 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:45:24.064153 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'quiet': 'False', 'warn_error': 'None', 'empty': 'False', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:45:31.615089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3b8d9830-f572-48b8-b6dd-973f135b362a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025D7F7F6070>]}
[0m21:45:31.707449 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3b8d9830-f572-48b8-b6dd-973f135b362a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025D71EA3F40>]}
[0m21:45:31.707449 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:45:33.137165 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:45:33.775899 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:45:33.775899 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m21:45:34.234395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3b8d9830-f572-48b8-b6dd-973f135b362a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025D00051100>]}
[0m21:45:34.375301 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:45:34.375301 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:45:34.439308 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3b8d9830-f572-48b8-b6dd-973f135b362a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025D6F74FAF0>]}
[0m21:45:34.439308 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m21:45:34.439308 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3b8d9830-f572-48b8-b6dd-973f135b362a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025D7FD2BCA0>]}
[0m21:45:34.439308 [info ] [MainThread]: 
[0m21:45:34.439308 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:45:34.439308 [info ] [MainThread]: 
[0m21:45:34.439308 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:45:34.455141 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:45:34.455141 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:45:40.574612 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:45:40.579026 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:45:41.246539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3b8d9830-f572-48b8-b6dd-973f135b362a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025D6F288850>]}
[0m21:45:41.246539 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:45:41.255363 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m21:45:41.255363 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m21:45:41.255363 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m21:45:41.255363 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m21:45:41.274371 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m21:45:41.274371 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m21:45:41.316129 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m21:45:41.316129 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
    -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m21:45:41.328124 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:45:42.345379 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:15097702-3544-4799-95d1-e05882dad4cd&page=queryresults
[0m21:45:42.965330 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3b8d9830-f572-48b8-b6dd-973f135b362a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025D001A5430>]}
[0m21:45:42.965330 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.71s]
[0m21:45:42.965330 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m21:45:42.970225 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:45:42.972113 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:45:42.973264 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m21:45:42.974652 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:45:42.981080 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:45:42.985731 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:45:42.987819 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m21:45:42.992356 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

-- CTE Step 1: BronzeÂ±§„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„ÄÅÂü∫Êú¨ÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞„ÇíË°å„ÅÜ
WITH source AS (
    SELECT *
    FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

-- CTE Step 2: ÂÄãÂà•„ÅÆ„Ç´„É©„É†„ÅÆ„Éá„Éº„ÇøÂûãÂ§âÊèõ„Å®Âü∫Êú¨ÁöÑ„Å™„ÇØ„É™„Éº„Éã„É≥„Ç∞„ÇíË°å„ÅÜ
cleaned_source AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        -- Ë§áÈõë„Å™Ë∑ùÈõ¢Ë°®Ë®ò„Çí„É´„Éº„É´„Éô„Éº„Çπ„ÅßINT„Å´Â§âÊèõ
        CASE
            WHEN distance_to_station_min = '1H30ÔΩû2H' THEN 105
            WHEN distance_to_station_min = '1HÔΩû1H30' THEN 75
            WHEN distance_to_station_min = '2HÔΩû' THEN 120
            WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                CAST( (SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'^(\d+)') AS INT64) + SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(?:ÔΩû|~)(\d+)') AS INT64)) / 2 AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)'), INT64)
        END AS distance_to_station_min,
        SAFE_CAST(REGEXP_EXTRACT(total_price, r'(\d+)'), INT64) AS total_price_jpy,
        SAFE_CAST(REGEXP_EXTRACT(price_per_tsubo, r'(\d+)'), INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(REGEXP_EXTRACT(area_sq_m, r'(\d+)'), INT64) AS area_sq_m,
        SAFE_CAST(REGEXP_EXTRACT(price_per_sq_m, r'(\d+)'), INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(REGEXP_EXTRACT(frontage, r'(\d+\.?\d*)'), FLOAT64) AS frontage_m,
        SAFE_CAST(REGEXP_EXTRACT(total_floor_area_sq_m, r'(\d+)'), INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(REGEXP_EXTRACT(road_width_m, r'(\d+\.?\d*)'), FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(REGEXP_EXTRACT(building_coverage_ratio_pct, r'(\d+)'), INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(REGEXP_EXTRACT(floor_area_ratio_pct, r'(\d+)'), INT64) AS floor_area_ratio_pct,
        CAST( REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01') AS DATE) AS transaction_date,
        renovation,
        special_notes,
        built_year AS original_built_year
    FROM source
),

-- CTE Step 3: Êñ∞„Åó„ÅÑ„Ç´„ÉÜ„Ç¥„É™Âàó„ÇÑË®àÁÆóÂàóÔºàÁâπÂæ¥ÈáèÔºâ„Çí‰ΩúÊàê„Åô„Çã
feature_engineered AS (
    SELECT
        *,
        -- ÂíåÊö¶„ÇíË•øÊö¶„Å´Â§âÊèõ
        CASE
            WHEN STARTS_WITH(original_built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(original_built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(original_built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        -- ÈñìÂèñ„Çä„ÇíÂàÜÈ°û
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        -- Âª∫Áâ©„ÅÆÊßãÈÄ†„ÇíÂàÜÈ°û
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category
    FROM cleaned_source
),

-- CTE Step 4: JOIN„ÅÆ„Åü„ÇÅ„ÅÆÁµêÂêà„Ç≠„Éº„Çí‰ΩúÊàê„Åô„Çã
transactions_with_key AS (
    SELECT
        *,
        -- Ë§áÊï∞„ÅÆË°®Ë®òÊè∫„Çå„ÇíÂê∏Âèé„Åô„ÇãÁµêÂêà„Ç≠„Éº
        prefecture || city_name ||
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', '') -- ‚òÖ‚òÖ‚òÖ BUG FIX: „Åì„Åì„Å´„ÅÇ„Å£„Åü‰∏çË¶Å„Å™„Ç≥„É≥„Éû„ÇíÂâäÈô§ ‚òÖ‚òÖ‚òÖ
                        , r'Ôºà.*?Ôºâ', ''
                    ),
                '„Ç±', '„É∂'),
            'Êæ§', 'Ê≤¢')
        AS address_key
    FROM feature_engineered
),

zipcodes_with_key AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

-- CTE Step 5: ÂèñÂºï„Éá„Éº„Çø„Å®ÈÉµ‰æøÁï™Âè∑„ÇíJOIN„Åô„Çã
joined AS (
    SELECT
        transactions_with_key.*,
        zipcodes_with_key.zipcode
    FROM
        transactions_with_key
    LEFT JOIN zipcodes_with_key
        ON transactions_with_key.address_key = zipcodes_with_key.address_key
),

-- CTE Step 6: ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„ÄÅ„É™„Éç„Éº„É†„ÄÅË®àÁÆó„ÇíË°å„ÅÜ
final_model AS (
    SELECT
        transaction_type,
        price_info_type,
        zipcode,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        total_price_jpy,
        price_per_tsubo_jpy,
        floor_plan,
        floor_plan_category,
        area_sq_m,
        price_per_sq_m,
        land_shape,
        frontage_m,
        total_floor_area_sq_m,
        built_year_ad AS built_year,
        EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
        building_structure,
        building_structure_category,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        road_width_m,
        city_planning,
        building_coverage_ratio_pct,
        floor_area_ratio_pct,
        transaction_date,
        renovation,
        special_notes
    FROM
        joined
)

-- ÊúÄÁµÇÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
SELECT *
FROM final_model
WHERE
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m21:45:42.992356 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:45:43.616184 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:366bc939-7dcb-4b58-a0f1-553acfc769b4&page=queryresults
[0m21:45:43.616184 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:366bc939-7dcb-4b58-a0f1-553acfc769b4&page=queryresults
[0m21:45:43.638063 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [31:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:45:43.638063 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3b8d9830-f572-48b8-b6dd-973f135b362a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025D01514FA0>]}
[0m21:45:43.638063 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 0.66s]
[0m21:45:43.638063 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:45:43.638063 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [31:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m21:45:43.647805 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:45:43.649873 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:45:43.649873 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:45:43.649873 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:45:43.649873 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:45:43.649873 [info ] [MainThread]: 
[0m21:45:43.649873 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 9.21 seconds (9.21s).
[0m21:45:43.655033 [debug] [MainThread]: Command end result
[0m21:45:43.695374 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:45:43.698321 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:45:43.711697 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:45:43.714720 [info ] [MainThread]: 
[0m21:45:43.714720 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:45:43.716907 [info ] [MainThread]: 
[0m21:45:43.716907 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m21:45:43.716907 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [31:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:45:43.720293 [info ] [MainThread]: 
[0m21:45:43.721316 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m21:45:43.721316 [info ] [MainThread]: 
[0m21:45:43.721316 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m21:45:43.721316 [debug] [MainThread]: Command `dbt run` failed at 21:45:43.721316 after 19.85 seconds
[0m21:45:43.725321 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025D7042FF10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025D7F77D2E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025D000A94C0>]}
[0m21:45:43.725321 [debug] [MainThread]: Flushing usage events
[0m21:45:45.003826 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:45:49.280328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151DF7FFEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151E1AA3F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151E1AA3220>]}


============================== 21:45:49.288486 | 01787ab0-da6c-4946-91b4-7e48cb250a25 ==============================
[0m21:45:49.288486 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:45:49.291773 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'warn_error': 'None', 'partial_parse': 'True', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:45:54.296399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '01787ab0-da6c-4946-91b4-7e48cb250a25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151EEB88490>]}
[0m21:45:54.394283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '01787ab0-da6c-4946-91b4-7e48cb250a25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151E126DF40>]}
[0m21:45:54.402634 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:45:55.538742 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:45:55.925665 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:45:55.925665 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:45:55.997923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '01787ab0-da6c-4946-91b4-7e48cb250a25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151EF2B9130>]}
[0m21:45:56.146409 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:45:56.154438 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:45:56.196280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '01787ab0-da6c-4946-91b4-7e48cb250a25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151DF6988E0>]}
[0m21:45:56.196280 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m21:45:56.198703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '01787ab0-da6c-4946-91b4-7e48cb250a25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151EF2D8FD0>]}
[0m21:45:56.201674 [info ] [MainThread]: 
[0m21:45:56.203683 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:45:56.203683 [info ] [MainThread]: 
[0m21:45:56.203683 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:45:56.208279 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:45:56.208279 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:45:59.501849 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:45:59.502849 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:46:00.236011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '01787ab0-da6c-4946-91b4-7e48cb250a25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151EF282280>]}
[0m21:46:00.238012 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:46:00.244316 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m21:46:00.246071 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m21:46:00.248187 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m21:46:00.249613 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m21:46:00.266480 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m21:46:00.268545 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m21:46:00.316708 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m21:46:00.320227 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
    -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m21:46:00.321320 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:46:02.366664 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:d7450150-3161-4fd4-b771-909383608a6f&page=queryresults
[0m21:46:02.893072 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01787ab0-da6c-4946-91b4-7e48cb250a25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151EF3B7A60>]}
[0m21:46:02.895493 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 2.64s]
[0m21:46:02.897783 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m21:46:02.898804 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:46:02.900142 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:46:02.900994 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m21:46:02.903539 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:46:02.905957 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:46:02.905957 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:46:02.916636 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m21:46:02.918635 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

-- CTE Step 1: BronzeÂ±§„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„ÄÅÂü∫Êú¨ÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞„ÇíË°å„ÅÜ
WITH source AS (
    SELECT *
    FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

-- CTE Step 2: ÂÄãÂà•„ÅÆ„Ç´„É©„É†„ÅÆ„Éá„Éº„ÇøÂûãÂ§âÊèõ„Å®Âü∫Êú¨ÁöÑ„Å™„ÇØ„É™„Éº„Éã„É≥„Ç∞„ÇíË°å„ÅÜ
cleaned_source AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        -- Ë§áÈõë„Å™Ë∑ùÈõ¢Ë°®Ë®ò„Çí„É´„Éº„É´„Éô„Éº„Çπ„ÅßINT„Å´Â§âÊèõ
        CASE
            WHEN distance_to_station_min = '1H30ÔΩû2H' THEN 105
            WHEN distance_to_station_min = '1HÔΩû1H30' THEN 75
            WHEN distance_to_station_min = '2HÔΩû' THEN 120
            WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                CAST( (SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'^(\d+)') AS INT64) + SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(?:ÔΩû|~)(\d+)') AS INT64)) / 2 AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)'), INT64)
        END AS distance_to_station_min,
        SAFE_CAST(REGEXP_EXTRACT(total_price, r'(\d+)'), INT64) AS total_price_jpy,
        SAFE_CAST(REGEXP_EXTRACT(price_per_tsubo, r'(\d+)'), INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(REGEXP_EXTRACT(area_sq_m, r'(\d+)'), INT64) AS area_sq_m,
        SAFE_CAST(REGEXP_EXTRACT(price_per_sq_m, r'(\d+)'), INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(REGEXP_EXTRACT(frontage, r'(\d+\.?\d*)'), FLOAT64) AS frontage_m,
        SAFE_CAST(REGEXP_EXTRACT(total_floor_area_sq_m, r'(\d+)'), INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(REGEXP_EXTRACT(road_width_m, r'(\d+\.?\d*)'), FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(REGEXP_EXTRACT(building_coverage_ratio_pct, r'(\d+)'), INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(REGEXP_EXTRACT(floor_area_ratio_pct, r'(\d+)'), INT64) AS floor_area_ratio_pct,
        CAST( REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01') AS DATE) AS transaction_date,
        renovation,
        special_notes,
        built_year AS original_built_year
    FROM source
),

-- CTE Step 3: Êñ∞„Åó„ÅÑ„Ç´„ÉÜ„Ç¥„É™Âàó„ÇÑË®àÁÆóÂàóÔºàÁâπÂæ¥ÈáèÔºâ„Çí‰ΩúÊàê„Åô„Çã
feature_engineered AS (
    SELECT
        *,
        -- ÂíåÊö¶„ÇíË•øÊö¶„Å´Â§âÊèõ
        CASE
            WHEN STARTS_WITH(original_built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(original_built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(original_built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        -- ÈñìÂèñ„Çä„ÇíÂàÜÈ°û
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        -- Âª∫Áâ©„ÅÆÊßãÈÄ†„ÇíÂàÜÈ°û
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category
    FROM cleaned_source
),

-- CTE Step 4: JOIN„ÅÆ„Åü„ÇÅ„ÅÆÁµêÂêà„Ç≠„Éº„Çí‰ΩúÊàê„Åô„Çã
transactions_with_key AS (
    SELECT
        *,
        -- Ë§áÊï∞„ÅÆË°®Ë®òÊè∫„Çå„ÇíÂê∏Âèé„Åô„ÇãÁµêÂêà„Ç≠„Éº
        prefecture || city_name ||
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', '') -- ‚òÖ‚òÖ‚òÖ BUG FIX: „Åì„Åì„Å´„ÅÇ„Å£„Åü‰∏çË¶Å„Å™„Ç≥„É≥„Éû„ÇíÂâäÈô§ ‚òÖ‚òÖ‚òÖ
                        , r'Ôºà.*?Ôºâ', ''
                    ),
                '„Ç±', '„É∂'),
            'Êæ§', 'Ê≤¢')
        AS address_key
    FROM feature_engineered
),

zipcodes_with_key AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

-- CTE Step 5: ÂèñÂºï„Éá„Éº„Çø„Å®ÈÉµ‰æøÁï™Âè∑„ÇíJOIN„Åô„Çã
joined AS (
    SELECT
        transactions_with_key.*,
        zipcodes_with_key.zipcode
    FROM
        transactions_with_key
    LEFT JOIN zipcodes_with_key
        ON transactions_with_key.address_key = zipcodes_with_key.address_key
),

-- CTE Step 6: ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„ÄÅ„É™„Éç„Éº„É†„ÄÅË®àÁÆó„ÇíË°å„ÅÜ
final_model AS (
    SELECT
        transaction_type,
        price_info_type,
        zipcode,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        total_price_jpy,
        price_per_tsubo_jpy,
        floor_plan,
        floor_plan_category,
        area_sq_m,
        price_per_sq_m,
        land_shape,
        frontage_m,
        total_floor_area_sq_m,
        built_year_ad AS built_year,
        EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
        building_structure,
        building_structure_category,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        road_width_m,
        city_planning,
        building_coverage_ratio_pct,
        floor_area_ratio_pct,
        transaction_date,
        renovation,
        special_notes
    FROM
        joined
)

-- ÊúÄÁµÇÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
SELECT *
FROM final_model
WHERE
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m21:46:02.921641 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:46:03.616352 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:8e5b52c5-ce0d-4da0-aa20-4a8a5e785164&page=queryresults
[0m21:46:03.627083 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:8e5b52c5-ce0d-4da0-aa20-4a8a5e785164&page=queryresults
[0m21:46:03.640896 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [31:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:46:03.640896 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01787ab0-da6c-4946-91b4-7e48cb250a25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151EF7C7D60>]}
[0m21:46:03.643491 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 0.74s]
[0m21:46:03.645003 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:46:03.645003 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [31:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m21:46:03.649736 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:46:03.649736 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:46:03.651744 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:46:03.651744 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:46:03.653074 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:46:03.654264 [info ] [MainThread]: 
[0m21:46:03.654264 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 7.45 seconds (7.45s).
[0m21:46:03.656589 [debug] [MainThread]: Command end result
[0m21:46:03.695001 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:46:03.699510 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:46:03.711846 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:46:03.711846 [info ] [MainThread]: 
[0m21:46:03.711846 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:46:03.711846 [info ] [MainThread]: 
[0m21:46:03.711846 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m21:46:03.711846 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [31:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:46:03.711846 [info ] [MainThread]: 
[0m21:46:03.711846 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m21:46:03.720057 [info ] [MainThread]: 
[0m21:46:03.720057 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m21:46:03.723249 [debug] [MainThread]: Command `dbt run` failed at 21:46:03.722238 after 14.58 seconds
[0m21:46:03.724383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151DF7FFEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151E126DF40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151EF2DD040>]}
[0m21:46:03.724383 [debug] [MainThread]: Flushing usage events
[0m21:46:04.990952 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:48:16.432185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202E98B0E50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202EBB53F40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202EBB53190>]}


============================== 21:48:16.440814 | 9176b8ab-df30-4bc6-b630-2e7b2d689007 ==============================
[0m21:48:16.440814 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:48:16.440814 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'no_print': 'None', 'partial_parse': 'True', 'invocation_command': 'dbt run', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:48:22.818414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9176b8ab-df30-4bc6-b630-2e7b2d689007', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202E8646E50>]}
[0m21:48:22.934087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9176b8ab-df30-4bc6-b630-2e7b2d689007', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202EAC2FB50>]}
[0m21:48:22.935611 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:48:24.061726 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:48:24.489392 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:48:24.489392 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m21:48:24.930577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9176b8ab-df30-4bc6-b630-2e7b2d689007', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202F94D1100>]}
[0m21:48:25.069372 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:48:25.074629 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:48:25.123148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9176b8ab-df30-4bc6-b630-2e7b2d689007', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202F93E40D0>]}
[0m21:48:25.123148 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m21:48:25.123148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9176b8ab-df30-4bc6-b630-2e7b2d689007', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202F94D1970>]}
[0m21:48:25.126715 [info ] [MainThread]: 
[0m21:48:25.126715 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:48:25.130300 [info ] [MainThread]: 
[0m21:48:25.130300 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:48:25.141221 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:48:25.142383 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:48:29.655695 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:48:29.655695 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:48:30.462888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9176b8ab-df30-4bc6-b630-2e7b2d689007', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202F93E4280>]}
[0m21:48:30.462888 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:48:30.469727 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m21:48:30.469727 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m21:48:30.469727 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m21:48:30.475805 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m21:48:30.485896 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m21:48:30.485896 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m21:48:30.531789 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m21:48:30.543811 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
    -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m21:48:30.546170 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:48:31.863618 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:8dcc6dc6-3a49-47cd-9a6b-79ae87b8efca&page=queryresults
[0m21:48:32.409760 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9176b8ab-df30-4bc6-b630-2e7b2d689007', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202F96254F0>]}
[0m21:48:32.409760 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.93s]
[0m21:48:32.409760 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m21:48:32.409760 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:48:32.415646 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:48:32.415646 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m21:48:32.415646 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:48:32.422837 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:48:32.422837 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:48:32.431974 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m21:48:32.434493 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

-- CTE Step 1: BronzeÂ±§„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„ÄÅÂü∫Êú¨ÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞„ÇíË°å„ÅÜ
WITH source AS (
    SELECT *
    FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

-- CTE Step 2: ÂÄãÂà•„ÅÆ„Ç´„É©„É†„ÅÆ„Éá„Éº„ÇøÂûãÂ§âÊèõ„Å®Âü∫Êú¨ÁöÑ„Å™„ÇØ„É™„Éº„Éã„É≥„Ç∞„ÇíË°å„ÅÜ
cleaned_source AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        -- Ë§áÈõë„Å™Ë∑ùÈõ¢Ë°®Ë®ò„Çí„É´„Éº„É´„Éô„Éº„Çπ„ÅßINT„Å´Â§âÊèõ
        CASE
            WHEN distance_to_station_min = '1H30ÔΩû2H' THEN 105
            WHEN distance_to_station_min = '1HÔΩû1H30' THEN 75
            WHEN distance_to_station_min = '2HÔΩû' THEN 120
            WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                CAST(
                    (
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'^(\d+)') AS INT64)
                        +
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(?:ÔΩû|~)(\d+)') AS INT64)
                    ) / 2
                AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)'), INT64)
        END AS distance_to_station_min,
        SAFE_CAST(REGEXP_EXTRACT(total_price, r'(\d+)'), INT64) AS total_price_jpy,
        SAFE_CAST(REGEXP_EXTRACT(price_per_tsubo, r'(\d+)'), INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(REGEXP_EXTRACT(area_sq_m, r'(\d+)'), INT64) AS area_sq_m,
        SAFE_CAST(REGEXP_EXTRACT(price_per_sq_m, r'(\d+)'), INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(REGEXP_EXTRACT(frontage, r'(\d+\.?\d*)'), FLOAT64) AS frontage_m,
        SAFE_CAST(REGEXP_EXTRACT(total_floor_area_sq_m, r'(\d+)'), INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(REGEXP_EXTRACT(road_width_m, r'(\d+\.?\d*)'), FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(REGEXP_EXTRACT(building_coverage_ratio_pct, r'(\d+)'), INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(REGEXP_EXTRACT(floor_area_ratio_pct, r'(\d+)'), INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        built_year AS original_built_year -- ÂÖÉ„ÅÆÂª∫ÁØâÂπ¥„ÇíÂæå„ÅÆË®àÁÆó„ÅÆ„Åü„ÇÅ„Å´‰øùÊåÅ
    FROM source
),

-- CTE Step 3: Êñ∞„Åó„ÅÑ„Ç´„ÉÜ„Ç¥„É™Âàó„ÇÑË®àÁÆóÂàóÔºàÁâπÂæ¥ÈáèÔºâ„Çí‰ΩúÊàê„Åô„Çã
feature_engineered AS (
    SELECT
        *,
        -- ÂíåÊö¶„ÇíË•øÊö¶„Å´Â§âÊèõ
        CASE
            WHEN STARTS_WITH(original_built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(original_built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(original_built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        -- ÈñìÂèñ„Çä„ÇíÂàÜÈ°û
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        -- Âª∫Áâ©„ÅÆÊßãÈÄ†„ÇíÂàÜÈ°û
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category
    FROM cleaned_source
),

-- CTE Step 4: JOIN„ÅÆ„Åü„ÇÅ„ÅÆÁµêÂêà„Ç≠„Éº„Çí‰ΩúÊàê„Åô„Çã
transactions_with_key AS (
    SELECT
        *,
        -- Ë§áÊï∞„ÅÆË°®Ë®òÊè∫„Çå„ÇíÂê∏Âèé„Åô„ÇãÁµêÂêà„Ç≠„Éº
        prefecture || city_name ||
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''),
                        r'Ôºà.*?Ôºâ', ''
                    ),
                '„Ç±', '„É∂'),
            'Êæ§', 'Ê≤¢')
        AS address_key
    FROM feature_engineered
),

zipcodes_with_key AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

-- CTE Step 5: ÂèñÂºï„Éá„Éº„Çø„Å®ÈÉµ‰æøÁï™Âè∑„ÇíJOIN„Åô„Çã
joined AS (
    SELECT
        transactions_with_key.*,
        zipcodes_with_key.zipcode
    FROM
        transactions_with_key
    LEFT JOIN zipcodes_with_key
        ON transactions_with_key.address_key = zipcodes_with_key.address_key
),

-- CTE Step 6: ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„ÄÅ„É™„Éç„Éº„É†„ÄÅË®àÁÆó„ÇíË°å„ÅÜ
final_model AS (
    SELECT
        transaction_type,
        price_info_type,
        zipcode,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        total_price_jpy,
        price_per_tsubo_jpy,
        floor_plan,
        floor_plan_category,
        area_sq_m,
        price_per_sq_m,
        land_shape,
        frontage_m,
        total_floor_area_sq_m,
        built_year_ad AS built_year,
        EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
        building_structure,
        building_structure_category,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        road_width_m,
        city_planning,
        building_coverage_ratio_pct,
        floor_area_ratio_pct,
        transaction_date,
        renovation,
        special_notes
    FROM
        joined
)

-- ÊúÄÁµÇÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
SELECT *
FROM final_model
WHERE
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m21:48:32.436503 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:48:33.148918 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:c573bc42-a8e6-4d3a-826c-9eb966bfe7f5&page=queryresults
[0m21:48:33.148918 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:c573bc42-a8e6-4d3a-826c-9eb966bfe7f5&page=queryresults
[0m21:48:33.179881 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [37:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:48:33.181192 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9176b8ab-df30-4bc6-b630-2e7b2d689007', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202FA994BE0>]}
[0m21:48:33.181192 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 0.77s]
[0m21:48:33.181192 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:48:33.181192 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [37:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m21:48:33.181192 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:48:33.189045 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:48:33.189045 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:48:33.189045 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:48:33.189045 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:48:33.189045 [info ] [MainThread]: 
[0m21:48:33.189045 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 8.06 seconds (8.06s).
[0m21:48:33.195678 [debug] [MainThread]: Command end result
[0m21:48:33.230419 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:48:33.230419 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:48:33.251438 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:48:33.251438 [info ] [MainThread]: 
[0m21:48:33.251438 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:48:33.255066 [info ] [MainThread]: 
[0m21:48:33.255066 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m21:48:33.256815 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [37:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:48:33.256815 [info ] [MainThread]: 
[0m21:48:33.256815 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m21:48:33.259523 [info ] [MainThread]: 
[0m21:48:33.260955 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m21:48:33.262821 [debug] [MainThread]: Command `dbt run` failed at 21:48:33.262821 after 16.98 seconds
[0m21:48:33.264005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202E98B0E50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202F8C20520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000202EAC68820>]}
[0m21:48:33.265111 [debug] [MainThread]: Flushing usage events
[0m21:48:34.628284 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:54:12.810190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B399E5FEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B39C103F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B39C103220>]}


============================== 21:54:12.826068 | e17dccee-5675-46e5-8507-9fe57faf4adc ==============================
[0m21:54:12.826068 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:54:12.828734 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'warn_error': 'None', 'no_print': 'None', 'empty': 'False', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:54:19.269752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e17dccee-5675-46e5-8507-9fe57faf4adc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B3983F62B0>]}
[0m21:54:19.370723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e17dccee-5675-46e5-8507-9fe57faf4adc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B3A9235BB0>]}
[0m21:54:19.372732 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:54:21.205845 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:54:21.876659 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:54:21.878668 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m21:54:22.305280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e17dccee-5675-46e5-8507-9fe57faf4adc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B3A9A76EB0>]}
[0m21:54:22.438012 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:54:22.452039 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:54:22.502807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e17dccee-5675-46e5-8507-9fe57faf4adc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B3A9A87160>]}
[0m21:54:22.502807 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m21:54:22.502807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e17dccee-5675-46e5-8507-9fe57faf4adc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B3A938FAC0>]}
[0m21:54:22.508491 [info ] [MainThread]: 
[0m21:54:22.508491 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:54:22.510660 [info ] [MainThread]: 
[0m21:54:22.510660 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:54:22.520178 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:54:22.520178 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:54:26.838309 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:54:26.838309 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:54:27.549474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e17dccee-5675-46e5-8507-9fe57faf4adc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B3A993B1F0>]}
[0m21:54:27.558399 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:54:27.565057 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m21:54:27.568496 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m21:54:27.568496 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m21:54:27.568496 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m21:54:27.583869 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m21:54:27.583869 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m21:54:27.633620 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m21:54:27.636662 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
    -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m21:54:27.636662 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:54:28.632918 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:4b964ba8-4178-4446-a3f2-5a37cdcaef53&page=queryresults
[0m21:54:29.235822 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e17dccee-5675-46e5-8507-9fe57faf4adc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B3A9BD2C40>]}
[0m21:54:29.235822 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.67s]
[0m21:54:29.235822 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m21:54:29.235822 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:54:29.235822 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:54:29.244532 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m21:54:29.246030 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:54:29.252284 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:54:29.254110 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:54:29.260308 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m21:54:29.264922 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

-- CTE Step 1: BronzeÂ±§„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„ÄÅÂü∫Êú¨ÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞„ÇíË°å„ÅÜ
WITH source AS (
    SELECT *
    FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

-- CTE Step 2: ÂÄãÂà•„ÅÆ„Ç´„É©„É†„ÅÆ„Éá„Éº„ÇøÂûãÂ§âÊèõ„Å®Âü∫Êú¨ÁöÑ„Å™„ÇØ„É™„Éº„Éã„É≥„Ç∞„ÇíË°å„ÅÜ
cleaned_source AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        -- Ë§áÈõë„Å™Ë∑ùÈõ¢Ë°®Ë®ò„Çí„É´„Éº„É´„Éô„Éº„Çπ„ÅßINT„Å´Â§âÊèõ
        CASE
            WHEN distance_to_station_min = '1H30ÔΩû2H' THEN 105
            WHEN distance_to_station_min = '1HÔΩû1H30' THEN 75
            WHEN distance_to_station_min = '2HÔΩû' THEN 120
            WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                CAST(
                    (
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'^(\d+)') AS INT64)
                        +
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(?:ÔΩû|~)(\d+)') AS INT64)
                    ) / 2
                AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)'), INT64)
        END AS distance_to_station_min,
        SAFE_CAST(REGEXP_EXTRACT(total_price, r'(\d+)'), INT64) AS total_price_jpy,
        SAFE_CAST(REGEXP_EXTRACT(price_per_tsubo, r'(\d+)'), INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(REGEXP_EXTRACT(area_sq_m, r'(\d+)'), INT64) AS area_sq_m,
        SAFE_CAST(REGEXP_EXTRACT(price_per_sq_m, r'(\d+)'), INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(REGEXP_EXTRACT(frontage, r'(\d+\.?\d*)'), FLOAT64) AS frontage_m,
        SAFE_CAST(REGEXP_EXTRACT(total_floor_area_sq_m, r'(\d+)'), INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(REGEXP_EXTRACT(road_width_m, r'(\d+\.?\d*)'), FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(REGEXP_EXTRACT(building_coverage_ratio_pct, r'(\d+)'), INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(REGEXP_EXTRACT(floor_area_ratio_pct, r'(\d+)'), INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        built_year AS original_built_year -- ÂÖÉ„ÅÆÂª∫ÁØâÂπ¥„ÇíÂæå„ÅÆË®àÁÆó„ÅÆ„Åü„ÇÅ„Å´‰øùÊåÅ
    FROM source
),

-- CTE Step 3: Êñ∞„Åó„ÅÑ„Ç´„ÉÜ„Ç¥„É™Âàó„ÇÑË®àÁÆóÂàóÔºàÁâπÂæ¥ÈáèÔºâ„Çí‰ΩúÊàê„Åô„Çã
feature_engineered AS (
    SELECT
        *,
        -- ÂíåÊö¶„ÇíË•øÊö¶„Å´Â§âÊèõ
        CASE
            WHEN STARTS_WITH(original_built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(original_built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(original_built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        -- ÈñìÂèñ„Çä„ÇíÂàÜÈ°û
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        -- Âª∫Áâ©„ÅÆÊßãÈÄ†„ÇíÂàÜÈ°û
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category
    FROM cleaned_source
),

-- CTE Step 4: JOIN„ÅÆ„Åü„ÇÅ„ÅÆÁµêÂêà„Ç≠„Éº„Çí‰ΩúÊàê„Åô„Çã
transactions_with_key AS (
    SELECT
        *,
        -- Ë§áÊï∞„ÅÆË°®Ë®òÊè∫„Çå„ÇíÂê∏Âèé„Åô„ÇãÁµêÂêà„Ç≠„Éº
        prefecture || city_name ||
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', '')
                        , r'Ôºà.*?Ôºâ', ''
                    ),
                '„Ç±', '„É∂'),
            'Êæ§', 'Ê≤¢')
        AS address_key
    FROM feature_engineered
),

zipcodes_with_key AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

-- CTE Step 5: ÂèñÂºï„Éá„Éº„Çø„Å®ÈÉµ‰æøÁï™Âè∑„ÇíJOIN„Åô„Çã
joined AS (
    SELECT
        transactions_with_key.*,
        zipcodes_with_key.zipcode
    FROM
        transactions_with_key
    LEFT JOIN zipcodes_with_key
        ON transactions_with_key.address_key = zipcodes_with_key.address_key
),

-- CTE Step 6: ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„ÄÅ„É™„Éç„Éº„É†„ÄÅË®àÁÆó„ÇíË°å„ÅÜ
final_model AS (
    SELECT
        transaction_type,
        price_info_type,
        zipcode,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        total_price_jpy,
        price_per_tsubo_jpy,
        floor_plan,
        floor_plan_category,
        area_sq_m,
        price_per_sq_m,
        land_shape,
        frontage_m,
        total_floor_area_sq_m,
        built_year_ad AS built_year,
        EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
        building_structure,
        building_structure_category,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        road_width_m,
        city_planning,
        building_coverage_ratio_pct,
        floor_area_ratio_pct,
        transaction_date,
        renovation,
        special_notes
    FROM
        joined
)

-- ÊúÄÁµÇÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
SELECT *
FROM final_model
WHERE
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m21:54:29.264922 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:54:29.964153 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:ab1b8494-b352-43f3-ab14-62132f5d4ec0&page=queryresults
[0m21:54:29.964153 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:ab1b8494-b352-43f3-ab14-62132f5d4ec0&page=queryresults
[0m21:54:29.989263 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [37:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:54:29.995740 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e17dccee-5675-46e5-8507-9fe57faf4adc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B3A9BD2340>]}
[0m21:54:29.997750 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 0.75s]
[0m21:54:29.999765 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:54:29.999765 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [37:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m21:54:30.002726 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:54:30.005187 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:54:30.007092 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:54:30.007092 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:54:30.007092 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:54:30.007092 [info ] [MainThread]: 
[0m21:54:30.007092 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 7.50 seconds (7.50s).
[0m21:54:30.010904 [debug] [MainThread]: Command end result
[0m21:54:30.042575 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:54:30.055867 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:54:30.070237 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:54:30.072129 [info ] [MainThread]: 
[0m21:54:30.072129 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:54:30.073879 [info ] [MainThread]: 
[0m21:54:30.073879 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m21:54:30.073879 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [37:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:54:30.073879 [info ] [MainThread]: 
[0m21:54:30.073879 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m21:54:30.073879 [info ] [MainThread]: 
[0m21:54:30.073879 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m21:54:30.073879 [debug] [MainThread]: Command `dbt run` failed at 21:54:30.073879 after 17.43 seconds
[0m21:54:30.083632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B399E5FEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B3A9235BB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B3A9AD9520>]}
[0m21:54:30.083632 [debug] [MainThread]: Flushing usage events
[0m21:54:31.305417 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:03:37.031010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000218EF88FE50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000218F1B33F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000218F1B330A0>]}


============================== 22:03:37.034017 | bb4500f2-fd37-4c15-bb05-edb3e213701d ==============================
[0m22:03:37.034017 [info ] [MainThread]: Running with dbt=1.10.11
[0m22:03:37.034017 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'invocation_command': 'dbt clean', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m22:03:37.316909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bb4500f2-fd37-4c15-bb05-edb3e213701d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000218F0C0FB50>]}
[0m22:03:37.381055 [debug] [MainThread]: Command `dbt clean` succeeded at 22:03:37.381055 after 0.49 seconds
[0m22:03:37.381055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000218EF88FE50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000218EB15FA90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000218F1BDB820>]}
[0m22:03:37.381055 [debug] [MainThread]: Flushing usage events
[0m22:03:38.704689 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:04:02.353859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025AB948FE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025ABB735F40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025ABB735220>]}


============================== 22:04:02.358754 | 9d31a3bb-a23a-4b77-b8c6-5315aa0f48ee ==============================
[0m22:04:02.358754 [info ] [MainThread]: Running with dbt=1.10.11
[0m22:04:02.361788 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run --select stg_transactions', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m22:04:08.908791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9d31a3bb-a23a-4b77-b8c6-5315aa0f48ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025AC8810910>]}
[0m22:04:09.020872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9d31a3bb-a23a-4b77-b8c6-5315aa0f48ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025AC8849970>]}
[0m22:04:09.024234 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m22:04:10.488812 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m22:04:10.488812 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:04:10.488812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '9d31a3bb-a23a-4b77-b8c6-5315aa0f48ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025AC8A10460>]}
[0m22:04:12.691305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9d31a3bb-a23a-4b77-b8c6-5315aa0f48ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025AC929F130>]}
[0m22:04:12.817540 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m22:04:12.829011 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m22:04:12.872376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9d31a3bb-a23a-4b77-b8c6-5315aa0f48ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025ACA2C2A60>]}
[0m22:04:12.873788 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m22:04:12.873788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9d31a3bb-a23a-4b77-b8c6-5315aa0f48ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025AC92A4640>]}
[0m22:04:12.876817 [info ] [MainThread]: 
[0m22:04:12.876817 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:04:12.876817 [info ] [MainThread]: 
[0m22:04:12.876817 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:04:12.881342 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m22:04:12.883217 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:04:19.982527 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m22:04:19.982527 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:04:20.726651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9d31a3bb-a23a-4b77-b8c6-5315aa0f48ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025ACA2C5580>]}
[0m22:04:20.726651 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:04:20.729229 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m22:04:20.736885 [info ] [Thread-1  ]: 1 of 1 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m22:04:20.736885 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_transactions'
[0m22:04:20.736885 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m22:04:20.756655 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m22:04:20.760518 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m22:04:20.803585 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m22:04:20.810861 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

-- CTE Step 1: BronzeÂ±§„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„ÄÅÂü∫Êú¨ÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞„ÇíË°å„ÅÜ
WITH source AS (
    SELECT *
    FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

-- CTE Step 2: ÂÄãÂà•„ÅÆ„Ç´„É©„É†„ÅÆ„Éá„Éº„ÇøÂûãÂ§âÊèõ„Å®Âü∫Êú¨ÁöÑ„Å™„ÇØ„É™„Éº„Éã„É≥„Ç∞„ÇíË°å„ÅÜ
cleaned_source AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        -- Ë§áÈõë„Å™Ë∑ùÈõ¢Ë°®Ë®ò„Çí„É´„Éº„É´„Éô„Éº„Çπ„ÅßINT„Å´Â§âÊèõ
        /*
        CASE
            WHEN distance_to_station_min = '1H30ÔΩû2H' THEN 105
            WHEN distance_to_station_min = '1HÔΩû1H30' THEN 75
            WHEN distance_to_station_min = '2HÔΩû' THEN 120
            WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                CAST(
                    (
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'^(\d+)') AS INT64)
                        +
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(?:ÔΩû|~)(\d+)') AS INT64)
                    ) / 2
                AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)'), INT64)
        END AS distance_to_station_min,
        */
        -- Ë§áÈõë„Å™Ë∑ùÈõ¢Ë°®Ë®ò„Çí„É´„Éº„É´„Éô„Éº„Çπ„ÅßINT„Å´Â§âÊèõ
        NULL AS distance_to_station_min, -- ‚òÖ‚òÖ‚òÖ ‰∏ÄÊôÇÁöÑ„Å´ÁÑ°ÂäπÂåñ ‚òÖ‚òÖ‚òÖ
        SAFE_CAST(REGEXP_EXTRACT(total_price, r'(\d+)'), INT64) AS total_price_jpy,
        SAFE_CAST(REGEXP_EXTRACT(price_per_tsubo, r'(\d+)'), INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(REGEXP_EXTRACT(area_sq_m, r'(\d+)'), INT64) AS area_sq_m,
        SAFE_CAST(REGEXP_EXTRACT(price_per_sq_m, r'(\d+)'), INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(REGEXP_EXTRACT(frontage, r'(\d+\.?\d*)'), FLOAT64) AS frontage_m,
        SAFE_CAST(REGEXP_EXTRACT(total_floor_area_sq_m, r'(\d+)'), INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(REGEXP_EXTRACT(road_width_m, r'(\d+\.?\d*)'), FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(REGEXP_EXTRACT(building_coverage_ratio_pct, r'(\d+)'), INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(REGEXP_EXTRACT(floor_area_ratio_pct, r'(\d+)'), INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        built_year AS original_built_year -- ÂÖÉ„ÅÆÂª∫ÁØâÂπ¥„ÇíÂæå„ÅÆË®àÁÆó„ÅÆ„Åü„ÇÅ„Å´‰øùÊåÅ
    FROM source
),

-- CTE Step 3: Êñ∞„Åó„ÅÑ„Ç´„ÉÜ„Ç¥„É™Âàó„ÇÑË®àÁÆóÂàóÔºàÁâπÂæ¥ÈáèÔºâ„Çí‰ΩúÊàê„Åô„Çã
feature_engineered AS (
    SELECT
        *,
        -- ÂíåÊö¶„ÇíË•øÊö¶„Å´Â§âÊèõ
        CASE
            WHEN STARTS_WITH(original_built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(original_built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(original_built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        -- ÈñìÂèñ„Çä„ÇíÂàÜÈ°û
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        -- Âª∫Áâ©„ÅÆÊßãÈÄ†„ÇíÂàÜÈ°û
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category
    FROM cleaned_source
),

-- CTE Step 4: JOIN„ÅÆ„Åü„ÇÅ„ÅÆÁµêÂêà„Ç≠„Éº„Çí‰ΩúÊàê„Åô„Çã
transactions_with_key AS (
    SELECT
        *,
        -- Ë§áÊï∞„ÅÆË°®Ë®òÊè∫„Çå„ÇíÂê∏Âèé„Åô„ÇãÁµêÂêà„Ç≠„Éº
        prefecture || city_name ||
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', '')
                        , r'Ôºà.*?Ôºâ', ''
                    ),
                '„Ç±', '„É∂'),
            'Êæ§', 'Ê≤¢')
        AS address_key
    FROM feature_engineered
),

zipcodes_with_key AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

-- CTE Step 5: ÂèñÂºï„Éá„Éº„Çø„Å®ÈÉµ‰æøÁï™Âè∑„ÇíJOIN„Åô„Çã
joined AS (
    SELECT
        transactions_with_key.*,
        zipcodes_with_key.zipcode
    FROM
        transactions_with_key
    LEFT JOIN zipcodes_with_key
        ON transactions_with_key.address_key = zipcodes_with_key.address_key
),

-- CTE Step 6: ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„ÄÅ„É™„Éç„Éº„É†„ÄÅË®àÁÆó„ÇíË°å„ÅÜ
final_model AS (
    SELECT
        transaction_type,
        price_info_type,
        zipcode,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        total_price_jpy,
        price_per_tsubo_jpy,
        floor_plan,
        floor_plan_category,
        area_sq_m,
        price_per_sq_m,
        land_shape,
        frontage_m,
        total_floor_area_sq_m,
        built_year_ad AS built_year,
        EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
        building_structure,
        building_structure_category,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        road_width_m,
        city_planning,
        building_coverage_ratio_pct,
        floor_area_ratio_pct,
        transaction_date,
        renovation,
        special_notes
    FROM
        joined
)

-- ÊúÄÁµÇÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
SELECT *
FROM final_model
WHERE
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m22:04:20.810861 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m22:04:21.615067 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:9fb75cfd-3579-466e-9eda-1e78763c6e91&page=queryresults
[0m22:04:21.615067 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:9fb75cfd-3579-466e-9eda-1e78763c6e91&page=queryresults
[0m22:04:21.636913 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [43:56]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m22:04:21.644234 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d31a3bb-a23a-4b77-b8c6-5315aa0f48ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025AB9389580>]}
[0m22:04:21.644234 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 0.90s]
[0m22:04:21.647375 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m22:04:21.649282 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [43:56]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m22:04:21.652062 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:04:21.652062 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:04:21.652062 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m22:04:21.652062 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m22:04:21.652062 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m22:04:21.652062 [info ] [MainThread]: 
[0m22:04:21.652062 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 8.78 seconds (8.78s).
[0m22:04:21.652062 [debug] [MainThread]: Command end result
[0m22:04:21.932051 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m22:04:21.932051 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m22:04:21.949131 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m22:04:21.949131 [info ] [MainThread]: 
[0m22:04:21.949131 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:04:21.949131 [info ] [MainThread]: 
[0m22:04:21.953751 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m22:04:21.953751 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [43:56]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m22:04:21.953751 [info ] [MainThread]: 
[0m22:04:21.953751 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m22:04:21.953751 [info ] [MainThread]: 
[0m22:04:21.953751 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m22:04:21.953751 [debug] [MainThread]: Command `dbt run` failed at 22:04:21.953751 after 19.79 seconds
[0m22:04:21.953751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025AB948FE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025AC921E580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025AC921E070>]}
[0m22:04:21.953751 [debug] [MainThread]: Flushing usage events
[0m22:04:23.211502 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:09:09.330331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000282A73AFE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000282A9653DF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000282A9653F40>]}


============================== 22:09:09.345251 | 9a83f954-2e6f-45f7-bb65-df1776f565a1 ==============================
[0m22:09:09.345251 [info ] [MainThread]: Running with dbt=1.10.11
[0m22:09:09.345251 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'use_experimental_parser': 'False', 'invocation_command': 'dbt clean', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'empty': 'None', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m22:09:09.622808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9a83f954-2e6f-45f7-bb65-df1776f565a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000282A5788BB0>]}
[0m22:09:09.672651 [debug] [MainThread]: Command `dbt clean` succeeded at 22:09:09.672651 after 0.53 seconds
[0m22:09:09.672651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000282A73AFE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000282A2C5FB80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000282A9603520>]}
[0m22:09:09.672651 [debug] [MainThread]: Flushing usage events
[0m22:09:11.002827 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:09:17.510603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223D62CFE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223D8572EB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223D8572220>]}


============================== 22:09:17.522342 | ebd1a314-d230-4f12-be05-993a182e8318 ==============================
[0m22:09:17.522342 [info ] [MainThread]: Running with dbt=1.10.11
[0m22:09:17.523968 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m22:09:23.877774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ebd1a314-d230-4f12-be05-993a182e8318', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223D46A8BB0>]}
[0m22:09:23.992086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ebd1a314-d230-4f12-be05-993a182e8318', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223D850F820>]}
[0m22:09:23.994093 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m22:09:25.253345 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m22:09:25.256468 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:09:25.256468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'ebd1a314-d230-4f12-be05-993a182e8318', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223E585B070>]}
[0m22:09:27.360721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ebd1a314-d230-4f12-be05-993a182e8318', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223E60F3130>]}
[0m22:09:27.499376 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m22:09:27.504999 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m22:09:27.548528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ebd1a314-d230-4f12-be05-993a182e8318', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223E60F31C0>]}
[0m22:09:27.549525 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m22:09:27.550525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ebd1a314-d230-4f12-be05-993a182e8318', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223E7111940>]}
[0m22:09:27.552934 [info ] [MainThread]: 
[0m22:09:27.553934 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:09:27.554939 [info ] [MainThread]: 
[0m22:09:27.556586 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:09:27.564776 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m22:09:27.565774 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:09:31.558639 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m22:09:31.560213 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:09:32.232738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ebd1a314-d230-4f12-be05-993a182e8318', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223E5E4D040>]}
[0m22:09:32.232738 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:09:32.250490 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m22:09:32.250490 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m22:09:32.250490 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m22:09:32.250490 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m22:09:32.264302 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m22:09:32.282472 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m22:09:32.328802 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m22:09:32.332178 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
    -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m22:09:32.335031 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m22:09:33.598033 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:a9ef77d1-0175-4c5f-b285-bf5da2bd1bd8&page=queryresults
[0m22:09:34.499665 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ebd1a314-d230-4f12-be05-993a182e8318', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223E5E4DE20>]}
[0m22:09:34.499665 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 2.25s]
[0m22:09:34.499665 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m22:09:34.499665 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m22:09:34.512600 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m22:09:34.515092 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m22:09:34.516122 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m22:09:34.523247 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m22:09:34.525280 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m22:09:34.530922 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m22:09:34.533979 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

-- CTE Step 1: BronzeÂ±§„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„ÄÅÂü∫Êú¨ÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞„ÇíË°å„ÅÜ
WITH source AS (
    SELECT *
    FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),
-- CTE Step 2: ÂÄãÂà•„ÅÆ„Ç´„É©„É†„ÅÆ„Éá„Éº„ÇøÂûãÂ§âÊèõ„Å®Âü∫Êú¨ÁöÑ„Å™„ÇØ„É™„Éº„Éã„É≥„Ç∞„ÇíË°å„ÅÜ
cleaned_source AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        -- Ë§áÈõë„Å™Ë∑ùÈõ¢Ë°®Ë®ò„Çí„É´„Éº„É´„Éô„Éº„Çπ„ÅßINT„Å´Â§âÊèõ
        CASE
            WHEN distance_to_station_min = '1H30ÔΩû2H' THEN 105
            WHEN distance_to_station_min = '1HÔΩû1H30' THEN 75
            WHEN distance_to_station_min = '2HÔΩû' THEN 120
            WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                CAST(
                    (
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'^(\d+)') AS INT64)
                        +
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(?:ÔΩû|~)(\d+)') AS INT64)
                    ) / 2
                AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)'), INT64)
        END AS distance_to_station_min,
        SAFE_CAST(REGEXP_EXTRACT(total_price, r'(\d+)'), INT64) AS total_price_jpy,
        SAFE_CAST(REGEXP_EXTRACT(price_per_tsubo, r'(\d+)'), INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(REGEXP_EXTRACT(area_sq_m, r'(\d+)'), INT64) AS area_sq_m,
        SAFE_CAST(REGEXP_EXTRACT(price_per_sq_m, r'(\d+)'), INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(REGEXP_EXTRACT(frontage, r'(\d+\.?\d*)'), FLOAT64) AS frontage_m,
        SAFE_CAST(REGEXP_EXTRACT(total_floor_area_sq_m, r'(\d+)'), INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(REGEXP_EXTRACT(road_width_m, r'(\d+\.?\d*)'), FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(REGEXP_EXTRACT(building_coverage_ratio_pct, r'(\d+)'), INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(REGEXP_EXTRACT(floor_area_ratio_pct, r'(\d+)'), INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        built_year AS original_built_year
    FROM source
),
-- CTE Step 3: Êñ∞„Åó„ÅÑ„Ç´„ÉÜ„Ç¥„É™Âàó„ÇÑË®àÁÆóÂàóÔºàÁâπÂæ¥ÈáèÔºâ„Çí‰ΩúÊàê„Åô„Çã
feature_engineered AS (
    SELECT
        *,
        -- ÂíåÊö¶„ÇíË•øÊö¶„Å´Â§âÊèõ
        CASE
            WHEN STARTS_WITH(original_built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(original_built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(original_built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        -- ÈñìÂèñ„Çä„ÇíÂàÜÈ°û
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        -- Âª∫Áâ©„ÅÆÊßãÈÄ†„ÇíÂàÜÈ°û
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category
    FROM cleaned_source
),

-- CTE Step 4: JOIN„ÅÆ„Åü„ÇÅ„ÅÆÁµêÂêà„Ç≠„Éº„Çí‰ΩúÊàê„Åô„Çã
transactions_with_key AS (
    SELECT
        *,
        -- Ë§áÊï∞„ÅÆË°®Ë®òÊè∫„Çå„ÇíÂê∏Âèé„Åô„ÇãÁµêÂêà„Ç≠„Éº
        prefecture || city_name ||
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', '')
                        , r'Ôºà.*?Ôºâ', ''
                    ),
                '„Ç±', '„É∂'),
            'Êæ§', 'Ê≤¢')
        AS address_key
    FROM feature_engineered
),

zipcodes_with_key AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

-- CTE Step 5: ÂèñÂºï„Éá„Éº„Çø„Å®ÈÉµ‰æøÁï™Âè∑„ÇíJOIN„Åô„Çã
joined AS (
    SELECT
        transactions_with_key.*,
        zipcodes_with_key.zipcode
    FROM
        transactions_with_key
    LEFT JOIN zipcodes_with_key
        ON transactions_with_key.address_key = zipcodes_with_key.address_key
),

-- CTE Step 6: ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„ÄÅ„É™„Éç„Éº„É†„ÄÅË®àÁÆó„ÇíË°å„ÅÜ
final_model AS (
    SELECT
        transaction_type,
        price_info_type,
        zipcode,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        total_price_jpy,
        price_per_tsubo_jpy,
        floor_plan,
        floor_plan_category,
        area_sq_m,
        price_per_sq_m,
        land_shape,
        frontage_m,
        total_floor_area_sq_m,
        built_year_ad AS built_year,
        EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
        building_structure,
        building_structure_category,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        road_width_m,
        city_planning,
        building_coverage_ratio_pct,
        floor_area_ratio_pct,
        transaction_date,
        renovation,
        special_notes
    FROM
        joined
)

-- ÊúÄÁµÇÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
SELECT *
FROM final_model
WHERE
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m22:09:34.536017 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m22:09:35.196580 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:fb4ff58a-82d7-4492-ba87-802d14753a3a&page=queryresults
[0m22:09:35.212342 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:fb4ff58a-82d7-4492-ba87-802d14753a3a&page=queryresults
[0m22:09:35.232182 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [36:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m22:09:35.233216 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ebd1a314-d230-4f12-be05-993a182e8318', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223E5ED1AF0>]}
[0m22:09:35.234237 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 0.72s]
[0m22:09:35.236283 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m22:09:35.237305 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [36:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m22:09:35.239362 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:09:35.240379 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:09:35.240379 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m22:09:35.241396 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m22:09:35.241396 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m22:09:35.241396 [info ] [MainThread]: 
[0m22:09:35.243405 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 7.69 seconds (7.69s).
[0m22:09:35.244413 [debug] [MainThread]: Command end result
[0m22:09:35.282021 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m22:09:35.288124 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m22:09:35.295538 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m22:09:35.295538 [info ] [MainThread]: 
[0m22:09:35.301330 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:09:35.303027 [info ] [MainThread]: 
[0m22:09:35.303027 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m22:09:35.304629 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [36:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m22:09:35.304629 [info ] [MainThread]: 
[0m22:09:35.306413 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m22:09:35.306413 [info ] [MainThread]: 
[0m22:09:35.307924 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m22:09:35.307924 [debug] [MainThread]: Command `dbt run` failed at 22:09:35.307924 after 17.93 seconds
[0m22:09:35.310575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223D62CFE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223D5C8B730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223D768FBE0>]}
[0m22:09:35.311834 [debug] [MainThread]: Flushing usage events
[0m22:09:36.586563 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:11:05.590900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C4F3D8FEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C4F6034F40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C4F6034220>]}


============================== 22:11:05.590900 | 7a3b1e5f-8453-4bca-8ac4-76e83949696d ==============================
[0m22:11:05.590900 [info ] [MainThread]: Running with dbt=1.10.11
[0m22:11:05.590900 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'no_print': 'None', 'use_experimental_parser': 'False', 'empty': 'False', 'invocation_command': 'dbt run --select test_model', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m22:11:10.565218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7a3b1e5f-8453-4bca-8ac4-76e83949696d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C48318FDF0>]}
[0m22:11:10.674002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7a3b1e5f-8453-4bca-8ac4-76e83949696d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C4F57A6580>]}
[0m22:11:10.674002 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m22:11:11.708784 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m22:11:12.170653 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m22:11:12.170653 [debug] [MainThread]: Partial parsing: added file: realestate_analytics://models\test_model.sql
[0m22:11:12.599006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7a3b1e5f-8453-4bca-8ac4-76e83949696d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C4839D3EE0>]}
[0m22:11:12.739817 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m22:11:12.749774 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m22:11:12.786972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7a3b1e5f-8453-4bca-8ac4-76e83949696d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C483A4D8B0>]}
[0m22:11:12.786972 [info ] [MainThread]: Found 3 models, 2 sources, 495 macros
[0m22:11:12.791822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7a3b1e5f-8453-4bca-8ac4-76e83949696d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C4F30ADAC0>]}
[0m22:11:12.791822 [info ] [MainThread]: 
[0m22:11:12.791822 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:11:12.791822 [info ] [MainThread]: 
[0m22:11:12.791822 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:11:12.791822 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m22:11:12.800909 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:11:16.124763 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m22:11:16.124763 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:11:16.799074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7a3b1e5f-8453-4bca-8ac4-76e83949696d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C4F23E5FA0>]}
[0m22:11:16.799074 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:11:16.804197 [debug] [Thread-1  ]: Began running node model.realestate_analytics.test_model
[0m22:11:16.804197 [info ] [Thread-1  ]: 1 of 1 START sql view model real_estate_silver.test_model ...................... [RUN]
[0m22:11:16.811132 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.test_model'
[0m22:11:16.811132 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.test_model
[0m22:11:16.817681 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.test_model"
[0m22:11:16.825624 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.test_model
[0m22:11:16.873809 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.test_model"
[0m22:11:16.873809 [debug] [Thread-1  ]: On model.realestate_analytics.test_model: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.test_model"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`test_model`
  OPTIONS()
  as -- „Åì„ÅÆ„ÉÜ„Çπ„ÉàÂ∞ÇÁî®„ÅÆ„ÇΩ„Éº„ÇπÂÆöÁæ©
WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land` LIMIT 10
),

-- ÂïèÈ°å„ÇíÂàá„ÇäÂàÜ„Åë„Çã„Åü„ÇÅ„ÅÆCTE
cleaned_source AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        CASE
            WHEN distance_to_station_min = '1H30ÔΩû2H' THEN 105
            WHEN distance_to_station_min = '1HÔΩû1H30' THEN 75
            WHEN distance_to_station_min = '2HÔΩû' THEN 120
            WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                CAST(
                    (
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'^(\d+)') AS INT64)
                        +
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(?:ÔΩû|~)(\d+)') AS INT64)
                    ) / 2
                AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)'), INT64)
        END AS distance_to_station_min,
        SAFE_CAST(REGEXP_EXTRACT(total_price, r'(\d+)'), INT64) AS total_price_jpy,
        SAFE_CAST(REGEXP_EXTRACT(price_per_tsubo, r'(\d+)'), INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(REGEXP_EXTRACT(area_sq_m, r'(\d+)'), INT64) AS area_sq_m,
        SAFE_CAST(REGEXP_EXTRACT(price_per_sq_m, r'(\d+)'), INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(REGEXP_EXTRACT(frontage, r'(\d+\.?\d*)'), FLOAT64) AS frontage_m,
        SAFE_CAST(REGEXP_EXTRACT(total_floor_area_sq_m, r'(\d+)'), INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(REGEXP_EXTRACT(road_width_m, r'(\d+\.?\d*)'), FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(REGEXP_EXTRACT(building_coverage_ratio_pct, r'(\d+)'), INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(REGEXP_EXTRACT(floor_area_ratio_pct, r'(\d+)'), INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        built_year AS original_built_year
    FROM source
)

-- ÊúÄÁµÇÁöÑ„Å™SELECTÊñá
SELECT * FROM cleaned_source;


[0m22:11:16.873809 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m22:11:17.574061 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:38c80420-f03e-42fa-8534-bf1eadb22aa4&page=queryresults
[0m22:11:17.574061 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:38c80420-f03e-42fa-8534-bf1eadb22aa4&page=queryresults
[0m22:11:17.592729 [debug] [Thread-1  ]: Database Error in model test_model (models\test_model.sql)
  Syntax error: Expected keyword AS but got "," at [32:77]
  compiled code at target\run\realestate_analytics\models\test_model.sql
[0m22:11:17.592729 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a3b1e5f-8453-4bca-8ac4-76e83949696d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C4F3C7FD00>]}
[0m22:11:17.592729 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model real_estate_silver.test_model ............. [[31mERROR[0m in 0.78s]
[0m22:11:17.592729 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.test_model
[0m22:11:17.592729 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.test_model' to be skipped because of status 'error'.  Reason: Database Error in model test_model (models\test_model.sql)
  Syntax error: Expected keyword AS but got "," at [32:77]
  compiled code at target\run\realestate_analytics\models\test_model.sql.
[0m22:11:17.602818 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:11:17.604595 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:11:17.604595 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m22:11:17.607068 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m22:11:17.608915 [debug] [MainThread]: Connection 'model.realestate_analytics.test_model' was properly closed.
[0m22:11:17.608915 [info ] [MainThread]: 
[0m22:11:17.610613 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 4.82 seconds (4.82s).
[0m22:11:17.610613 [debug] [MainThread]: Command end result
[0m22:11:17.643538 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m22:11:17.653140 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m22:11:17.660382 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m22:11:17.660382 [info ] [MainThread]: 
[0m22:11:17.667403 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:11:17.669128 [info ] [MainThread]: 
[0m22:11:17.670260 [error] [MainThread]: [31mFailure in model test_model (models\test_model.sql)[0m
[0m22:11:17.671359 [error] [MainThread]:   Database Error in model test_model (models\test_model.sql)
  Syntax error: Expected keyword AS but got "," at [32:77]
  compiled code at target\run\realestate_analytics\models\test_model.sql
[0m22:11:17.671359 [info ] [MainThread]: 
[0m22:11:17.671359 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\test_model.sql
[0m22:11:17.674086 [info ] [MainThread]: 
[0m22:11:17.674086 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m22:11:17.676357 [debug] [MainThread]: Command `dbt run` failed at 22:11:17.676357 after 12.22 seconds
[0m22:11:17.677949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C4F3D8FEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C48313FBB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C4F5125D60>]}
[0m22:11:17.677949 [debug] [MainThread]: Flushing usage events
[0m22:11:18.947923 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:13:13.837852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013E94F1FEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013E9717CFA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013E9717C2B0>]}


============================== 22:13:13.845215 | bf202c5e-2afc-4cf9-88e9-a4184b77c8f0 ==============================
[0m22:13:13.845215 [info ] [MainThread]: Running with dbt=1.10.11
[0m22:13:13.846209 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'partial_parse': 'True', 'quiet': 'False', 'empty': 'None', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt clean', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m22:13:14.085388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bf202c5e-2afc-4cf9-88e9-a4184b77c8f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013E971931C0>]}
[0m22:13:14.143157 [debug] [MainThread]: Command `dbt clean` succeeded at 22:13:14.143157 after 0.45 seconds
[0m22:13:14.143157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013E94F1FEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013E971C36D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013E97182100>]}
[0m22:13:14.145162 [debug] [MainThread]: Flushing usage events
[0m22:13:15.432999 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:13:25.347871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D829CFEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D84C75F40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D84C75220>]}


============================== 22:13:25.354780 | 9aae9e24-3134-41ca-8eba-5d47b66039da ==============================
[0m22:13:25.354780 [info ] [MainThread]: Running with dbt=1.10.11
[0m22:13:25.354780 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'empty': 'False', 'quiet': 'False', 'use_experimental_parser': 'False', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run --select test_model', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m22:13:30.337613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9aae9e24-3134-41ca-8eba-5d47b66039da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D91D89B50>]}
[0m22:13:30.452482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9aae9e24-3134-41ca-8eba-5d47b66039da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D91DDA760>]}
[0m22:13:30.453750 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m22:13:31.575600 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m22:13:31.578061 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:13:31.579846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '9aae9e24-3134-41ca-8eba-5d47b66039da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D91F60610>]}
[0m22:13:33.663330 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9aae9e24-3134-41ca-8eba-5d47b66039da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D927EC130>]}
[0m22:13:33.805201 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m22:13:33.809465 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m22:13:33.836897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9aae9e24-3134-41ca-8eba-5d47b66039da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D937FD040>]}
[0m22:13:33.836897 [info ] [MainThread]: Found 3 models, 2 sources, 495 macros
[0m22:13:33.836897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9aae9e24-3134-41ca-8eba-5d47b66039da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D937F00D0>]}
[0m22:13:33.852187 [info ] [MainThread]: 
[0m22:13:33.853665 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:13:33.855675 [info ] [MainThread]: 
[0m22:13:33.855675 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:13:33.858140 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m22:13:33.859702 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:13:37.221026 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m22:13:37.221026 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:13:37.922663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9aae9e24-3134-41ca-8eba-5d47b66039da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D9387E5E0>]}
[0m22:13:37.922663 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:13:37.929035 [debug] [Thread-1  ]: Began running node model.realestate_analytics.test_model
[0m22:13:37.929035 [info ] [Thread-1  ]: 1 of 1 START sql view model real_estate_silver.test_model ...................... [RUN]
[0m22:13:37.929035 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.test_model'
[0m22:13:37.936458 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.test_model
[0m22:13:37.951837 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.test_model"
[0m22:13:37.954074 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.test_model
[0m22:13:38.000950 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.test_model"
[0m22:13:38.004234 [debug] [Thread-1  ]: On model.realestate_analytics.test_model: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.test_model"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`test_model`
  OPTIONS()
  as -- „Åì„ÅÆ„ÉÜ„Çπ„ÉàÂ∞ÇÁî®„ÅÆ„ÇΩ„Éº„ÇπÂÆöÁæ©
WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land` LIMIT 10
),

-- ÂïèÈ°å„ÇíÂàá„ÇäÂàÜ„Åë„Çã„Åü„ÇÅ„ÅÆCTE
cleaned_source AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        CASE
            WHEN distance_to_station_min = '1H30ÔΩû2H' THEN 105
            WHEN distance_to_station_min = '1HÔΩû1H30' THEN 75
            WHEN distance_to_station_min = '2HÔΩû' THEN 120
            WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                CAST(
                    (
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'^(\d+)') AS INT64)
                        +
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(?:ÔΩû|~)(\d+)') AS INT64)
                    ) / 2
                AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)'), INT64)
        END AS distance_to_station_min,
        SAFE_CAST(REGEXP_EXTRACT(total_price, r'(\d+)'), INT64) AS total_price_jpy,
        SAFE_CAST(REGEXP_EXTRACT(price_per_tsubo, r'(\d+)'), INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(REGEXP_EXTRACT(area_sq_m, r'(\d+)'), INT64) AS area_sq_m,
        SAFE_CAST(REGEXP_EXTRACT(price_per_sq_m, r'(\d+)'), INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(REGEXP_EXTRACT(frontage, r'(\d+\.?\d*)'), FLOAT64) AS frontage_m,
        SAFE_CAST(REGEXP_EXTRACT(total_floor_area_sq_m, r'(\d+)'), INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(REGEXP_EXTRACT(road_width_m, r'(\d+\.?\d*)'), FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(REGEXP_EXTRACT(building_coverage_ratio_pct, r'(\d+)'), INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(REGEXP_EXTRACT(floor_area_ratio_pct, r'(\d+)'), INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        built_year AS original_built_year
    FROM source
)

-- ÊúÄÁµÇÁöÑ„Å™SELECTÊñá
SELECT * FROM cleaned_source;


[0m22:13:38.006218 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m22:13:38.750594 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:292640d8-5d95-4933-931d-589d67ce8557&page=queryresults
[0m22:13:38.752604 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:292640d8-5d95-4933-931d-589d67ce8557&page=queryresults
[0m22:13:38.754612 [debug] [Thread-1  ]: Database Error in model test_model (models\test_model.sql)
  Syntax error: Expected keyword AS but got "," at [32:77]
  compiled code at target\run\realestate_analytics\models\test_model.sql
[0m22:13:38.769027 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9aae9e24-3134-41ca-8eba-5d47b66039da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D93936880>]}
[0m22:13:38.772403 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model real_estate_silver.test_model ............. [[31mERROR[0m in 0.84s]
[0m22:13:38.772403 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.test_model
[0m22:13:38.774413 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.test_model' to be skipped because of status 'error'.  Reason: Database Error in model test_model (models\test_model.sql)
  Syntax error: Expected keyword AS but got "," at [32:77]
  compiled code at target\run\realestate_analytics\models\test_model.sql.
[0m22:13:38.774413 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:13:38.777734 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:13:38.777734 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m22:13:38.779742 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m22:13:38.779742 [debug] [MainThread]: Connection 'model.realestate_analytics.test_model' was properly closed.
[0m22:13:38.779742 [info ] [MainThread]: 
[0m22:13:38.782122 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 4.92 seconds (4.92s).
[0m22:13:38.783639 [debug] [MainThread]: Command end result
[0m22:13:38.829810 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m22:13:38.833452 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m22:13:38.850861 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m22:13:38.852773 [info ] [MainThread]: 
[0m22:13:38.852773 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:13:38.854744 [info ] [MainThread]: 
[0m22:13:38.854744 [error] [MainThread]: [31mFailure in model test_model (models\test_model.sql)[0m
[0m22:13:38.857299 [error] [MainThread]:   Database Error in model test_model (models\test_model.sql)
  Syntax error: Expected keyword AS but got "," at [32:77]
  compiled code at target\run\realestate_analytics\models\test_model.sql
[0m22:13:38.857299 [info ] [MainThread]: 
[0m22:13:38.859344 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\test_model.sql
[0m22:13:38.861099 [info ] [MainThread]: 
[0m22:13:38.861099 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m22:13:38.865488 [debug] [MainThread]: Command `dbt run` failed at 22:13:38.865488 after 13.65 seconds
[0m22:13:38.865488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D829CFEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D80D807C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D83D7B610>]}
[0m22:13:38.867406 [debug] [MainThread]: Flushing usage events
[0m22:13:40.117404 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:16:51.772787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226886EFEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002268A94DFA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002268A94D2B0>]}


============================== 22:16:51.778323 | 6cd126d8-b00e-4472-a32c-6116530aa0e0 ==============================
[0m22:16:51.778323 [info ] [MainThread]: Running with dbt=1.10.11
[0m22:16:51.778323 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'invocation_command': 'dbt clean', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'None', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m22:16:52.038784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6cd126d8-b00e-4472-a32c-6116530aa0e0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002268A9661C0>]}
[0m22:16:52.095465 [debug] [MainThread]: Command `dbt clean` succeeded at 22:16:52.095465 after 0.47 seconds
[0m22:16:52.097986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226886EFEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002268A9936D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002268A952100>]}
[0m22:16:52.099994 [debug] [MainThread]: Flushing usage events
[0m22:16:53.397380 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:17:01.320774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000290A11AFEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000290A3464F40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000290A3464220>]}


============================== 22:17:01.325416 | 127fd0fb-f9c0-48e2-90d2-8d45595e5276 ==============================
[0m22:17:01.325416 [info ] [MainThread]: Running with dbt=1.10.11
[0m22:17:01.325416 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'use_experimental_parser': 'False', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'warn_error': 'None', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run --select test_model', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m22:17:07.356637 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '127fd0fb-f9c0-48e2-90d2-8d45595e5276', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002909F5607C0>]}
[0m22:17:07.461147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '127fd0fb-f9c0-48e2-90d2-8d45595e5276', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000290A3431AF0>]}
[0m22:17:07.463150 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m22:17:08.833673 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m22:17:08.836317 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:17:08.836317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '127fd0fb-f9c0-48e2-90d2-8d45595e5276', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000290B073D490>]}
[0m22:17:10.925720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '127fd0fb-f9c0-48e2-90d2-8d45595e5276', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000290B0FDB9A0>]}
[0m22:17:11.055282 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m22:17:11.061242 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m22:17:11.104695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '127fd0fb-f9c0-48e2-90d2-8d45595e5276', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000290B1FE6370>]}
[0m22:17:11.104695 [info ] [MainThread]: Found 3 models, 2 sources, 495 macros
[0m22:17:11.104695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '127fd0fb-f9c0-48e2-90d2-8d45595e5276', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000290B1FE0190>]}
[0m22:17:11.104695 [info ] [MainThread]: 
[0m22:17:11.104695 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:17:11.104695 [info ] [MainThread]: 
[0m22:17:11.115681 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:17:11.118161 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m22:17:11.120384 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:17:16.918070 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m22:17:16.918070 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:17:17.593566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '127fd0fb-f9c0-48e2-90d2-8d45595e5276', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000290B0C60AF0>]}
[0m22:17:17.593566 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:17:17.599902 [debug] [Thread-1  ]: Began running node model.realestate_analytics.test_model
[0m22:17:17.599902 [info ] [Thread-1  ]: 1 of 1 START sql view model real_estate_silver.test_model ...................... [RUN]
[0m22:17:17.599902 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.test_model'
[0m22:17:17.599902 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.test_model
[0m22:17:17.613848 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.test_model"
[0m22:17:17.625329 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.test_model
[0m22:17:17.657245 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.test_model"
[0m22:17:17.674677 [debug] [Thread-1  ]: On model.realestate_analytics.test_model: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.test_model"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`test_model`
  OPTIONS()
  as -- „Åì„ÅÆ„ÉÜ„Çπ„ÉàÂ∞ÇÁî®„ÅÆ„ÇΩ„Éº„ÇπÂÆöÁæ©
WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land` LIMIT 10
),

-- ÂïèÈ°å„ÇíÂàá„ÇäÂàÜ„Åë„Çã„Åü„ÇÅ„ÅÆCTE
cleaned_source AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        CASE
            WHEN distance_to_station_min = '1H30ÔΩû2H' THEN 105
            WHEN distance_to_station_min = '1HÔΩû1H30' THEN 75
            WHEN distance_to_station_min = '2HÔΩû' THEN 120
            WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                CAST(
                    (
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'^(\d+)') AS INT64)
                        +
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(?:ÔΩû|~)(\d+)') AS INT64)
                    ) / 2
                AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)'), INT64)
        END AS distance_to_station_min,
        SAFE_CAST(REGEXP_EXTRACT(total_price, r'(\d+)'), INT64) AS total_price_jpy,
        SAFE_CAST(REGEXP_EXTRACT(price_per_tsubo, r'(\d+)'), INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(REGEXP_EXTRACT(area_sq_m, r'(\d+)'), INT64) AS area_sq_m,
        SAFE_CAST(REGEXP_EXTRACT(price_per_sq_m, r'(\d+)'), INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(REGEXP_EXTRACT(frontage, r'(\d+\.?\d*)'), FLOAT64) AS frontage_m,
        SAFE_CAST(REGEXP_EXTRACT(total_floor_area_sq_m, r'(\d+)'), INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(REGEXP_EXTRACT(road_width_m, r'(\d+\.?\d*)'), FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(REGEXP_EXTRACT(building_coverage_ratio_pct, r'(\d+)'), INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(REGEXP_EXTRACT(floor_area_ratio_pct, r'(\d+)'), INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        built_year AS original_built_year
    FROM source
)

-- ÊúÄÁµÇÁöÑ„Å™SELECTÊñá
SELECT * FROM cleaned_source;


[0m22:17:17.677585 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m22:17:18.462674 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:987a89a0-a721-4047-960d-fb239ffc3b28&page=queryresults
[0m22:17:18.462674 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:987a89a0-a721-4047-960d-fb239ffc3b28&page=queryresults
[0m22:17:18.481108 [debug] [Thread-1  ]: Database Error in model test_model (models\test_model.sql)
  Syntax error: Expected keyword AS but got "," at [32:77]
  compiled code at target\run\realestate_analytics\models\test_model.sql
[0m22:17:18.481108 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '127fd0fb-f9c0-48e2-90d2-8d45595e5276', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000290B21264F0>]}
[0m22:17:18.481108 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model real_estate_silver.test_model ............. [[31mERROR[0m in 0.88s]
[0m22:17:18.490630 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.test_model
[0m22:17:18.492643 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.test_model' to be skipped because of status 'error'.  Reason: Database Error in model test_model (models\test_model.sql)
  Syntax error: Expected keyword AS but got "," at [32:77]
  compiled code at target\run\realestate_analytics\models\test_model.sql.
[0m22:17:18.494176 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:17:18.496350 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:17:18.496350 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m22:17:18.498405 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m22:17:18.498405 [debug] [MainThread]: Connection 'model.realestate_analytics.test_model' was properly closed.
[0m22:17:18.498405 [info ] [MainThread]: 
[0m22:17:18.498405 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 7.38 seconds (7.38s).
[0m22:17:18.501007 [debug] [MainThread]: Command end result
[0m22:17:18.540288 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m22:17:18.544130 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m22:17:18.556967 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m22:17:18.556967 [info ] [MainThread]: 
[0m22:17:18.556967 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:17:18.556967 [info ] [MainThread]: 
[0m22:17:18.556967 [error] [MainThread]: [31mFailure in model test_model (models\test_model.sql)[0m
[0m22:17:18.563039 [error] [MainThread]:   Database Error in model test_model (models\test_model.sql)
  Syntax error: Expected keyword AS but got "," at [32:77]
  compiled code at target\run\realestate_analytics\models\test_model.sql
[0m22:17:18.564432 [info ] [MainThread]: 
[0m22:17:18.565503 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\test_model.sql
[0m22:17:18.565503 [info ] [MainThread]: 
[0m22:17:18.565503 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m22:17:18.569064 [debug] [MainThread]: Command `dbt run` failed at 22:17:18.569064 after 17.39 seconds
[0m22:17:18.570074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000290A11AFEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000290B0540910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000290A255A610>]}
[0m22:17:18.570074 [debug] [MainThread]: Flushing usage events
[0m22:17:19.807218 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:53:48.918876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151A288FEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151A4B32F70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151A4B321C0>]}


============================== 20:53:48.928487 | 724ba4ce-b1fb-46ba-8bc1-84c2bbd76783 ==============================
[0m20:53:48.928487 [info ] [MainThread]: Running with dbt=1.10.11
[0m20:53:48.929641 [debug] [MainThread]: running dbt with arguments {'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'no_print': 'None', 'partial_parse': 'True', 'warn_error': 'None', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m20:53:57.306950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '724ba4ce-b1fb-46ba-8bc1-84c2bbd76783', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151A0C68850>]}
[0m20:53:57.413401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '724ba4ce-b1fb-46ba-8bc1-84c2bbd76783', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151A1755310>]}
[0m20:53:57.414793 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m20:53:58.549166 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m20:53:59.071236 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 0 files added, 0 files changed.
[0m20:53:59.073240 [debug] [MainThread]: Partial parsing: deleted file: realestate_analytics://models\test_model.sql
[0m20:53:59.228335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '724ba4ce-b1fb-46ba-8bc1-84c2bbd76783', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151B2360130>]}
[0m20:53:59.384963 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m20:53:59.390492 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m20:53:59.460982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '724ba4ce-b1fb-46ba-8bc1-84c2bbd76783', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151B2365310>]}
[0m20:53:59.460982 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m20:53:59.460982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '724ba4ce-b1fb-46ba-8bc1-84c2bbd76783', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151B2316670>]}
[0m20:53:59.465387 [info ] [MainThread]: 
[0m20:53:59.465387 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:53:59.465387 [info ] [MainThread]: 
[0m20:53:59.465387 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:53:59.477544 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m20:53:59.477544 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:54:07.454479 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m20:54:07.454479 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:54:08.164411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '724ba4ce-b1fb-46ba-8bc1-84c2bbd76783', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151B22E4CA0>]}
[0m20:54:08.164411 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:54:08.175382 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m20:54:08.175382 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m20:54:08.175382 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m20:54:08.179256 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m20:54:08.200250 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m20:54:08.202470 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m20:54:08.251468 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m20:54:08.254858 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
    -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m20:54:08.255946 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m20:54:09.428866 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:c16067b7-a576-4c5d-ba47-3bb0a8346d3a&page=queryresults
[0m20:54:10.136835 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '724ba4ce-b1fb-46ba-8bc1-84c2bbd76783', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151B247D850>]}
[0m20:54:10.136835 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.96s]
[0m20:54:10.140522 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m20:54:10.140522 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m20:54:10.140522 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m20:54:10.144841 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m20:54:10.146740 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m20:54:10.152262 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m20:54:10.155276 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m20:54:10.157299 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m20:54:10.167188 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

-- CTE Step 1: BronzeÂ±§„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„ÄÅÂü∫Êú¨ÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞„ÇíË°å„ÅÜ
WITH source AS (
    SELECT *
    FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),
-- CTE Step 2: ÂÄãÂà•„ÅÆ„Ç´„É©„É†„ÅÆ„Éá„Éº„ÇøÂûãÂ§âÊèõ„Å®Âü∫Êú¨ÁöÑ„Å™„ÇØ„É™„Éº„Éã„É≥„Ç∞„ÇíË°å„ÅÜ
cleaned_source AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        -- Ë§áÈõë„Å™Ë∑ùÈõ¢Ë°®Ë®ò„Çí„É´„Éº„É´„Éô„Éº„Çπ„ÅßINT„Å´Â§âÊèõ
        CASE
            WHEN distance_to_station_min = '1H30ÔΩû2H' THEN 105
            WHEN distance_to_station_min = '1HÔΩû1H30' THEN 75
            WHEN distance_to_station_min = '2HÔΩû' THEN 120
            WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                CAST(
                    (
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'^(\d+)') AS INT64)
                        +
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(?:ÔΩû|~)(\d+)') AS INT64)
                    ) / 2
                AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)'), INT64)
        END AS distance_to_station_min,
        SAFE_CAST(REGEXP_EXTRACT(total_price, r'(\d+)'), INT64) AS total_price_jpy,
        SAFE_CAST(REGEXP_EXTRACT(price_per_tsubo, r'(\d+)'), INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(REGEXP_EXTRACT(area_sq_m, r'(\d+)'), INT64) AS area_sq_m,
        SAFE_CAST(REGEXP_EXTRACT(price_per_sq_m, r'(\d+)'), INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(REGEXP_EXTRACT(frontage, r'(\d+\.?\d*)'), FLOAT64) AS frontage_m,
        SAFE_CAST(REGEXP_EXTRACT(total_floor_area_sq_m, r'(\d+)'), INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(REGEXP_EXTRACT(road_width_m, r'(\d+\.?\d*)'), FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(REGEXP_EXTRACT(building_coverage_ratio_pct, r'(\d+)'), INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(REGEXP_EXTRACT(floor_area_ratio_pct, r'(\d+)'), INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        built_year AS original_built_year
    FROM source
),
-- CTE Step 3: Êñ∞„Åó„ÅÑ„Ç´„ÉÜ„Ç¥„É™Âàó„ÇÑË®àÁÆóÂàóÔºàÁâπÂæ¥ÈáèÔºâ„Çí‰ΩúÊàê„Åô„Çã
feature_engineered AS (
    SELECT
        *,
        -- ÂíåÊö¶„ÇíË•øÊö¶„Å´Â§âÊèõ
        CASE
            WHEN STARTS_WITH(original_built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(original_built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(original_built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        -- ÈñìÂèñ„Çä„ÇíÂàÜÈ°û
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        -- Âª∫Áâ©„ÅÆÊßãÈÄ†„ÇíÂàÜÈ°û
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category
    FROM cleaned_source
),

-- CTE Step 4: JOIN„ÅÆ„Åü„ÇÅ„ÅÆÁµêÂêà„Ç≠„Éº„Çí‰ΩúÊàê„Åô„Çã
transactions_with_key AS (
    SELECT
        *,
        -- Ë§áÊï∞„ÅÆË°®Ë®òÊè∫„Çå„ÇíÂê∏Âèé„Åô„ÇãÁµêÂêà„Ç≠„Éº
        prefecture || city_name ||
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', '')
                        , r'Ôºà.*?Ôºâ', ''
                    ),
                '„Ç±', '„É∂'),
            'Êæ§', 'Ê≤¢')
        AS address_key
    FROM feature_engineered
),

zipcodes_with_key AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

-- CTE Step 5: ÂèñÂºï„Éá„Éº„Çø„Å®ÈÉµ‰æøÁï™Âè∑„ÇíJOIN„Åô„Çã
joined AS (
    SELECT
        transactions_with_key.*,
        zipcodes_with_key.zipcode
    FROM
        transactions_with_key
    LEFT JOIN zipcodes_with_key
        ON transactions_with_key.address_key = zipcodes_with_key.address_key
),

-- CTE Step 6: ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„ÄÅ„É™„Éç„Éº„É†„ÄÅË®àÁÆó„ÇíË°å„ÅÜ
final_model AS (
    SELECT
        transaction_type,
        price_info_type,
        zipcode,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        total_price_jpy,
        price_per_tsubo_jpy,
        floor_plan,
        floor_plan_category,
        area_sq_m,
        price_per_sq_m,
        land_shape,
        frontage_m,
        total_floor_area_sq_m,
        built_year_ad AS built_year,
        EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
        building_structure,
        building_structure_category,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        road_width_m,
        city_planning,
        building_coverage_ratio_pct,
        floor_area_ratio_pct,
        transaction_date,
        renovation,
        special_notes
    FROM
        joined
)

-- ÊúÄÁµÇÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
SELECT *
FROM final_model
WHERE
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m20:54:10.167188 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m20:54:10.868538 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:7e06bc38-d99e-4a27-87d0-8eb92f78169a&page=queryresults
[0m20:54:10.869960 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:7e06bc38-d99e-4a27-87d0-8eb92f78169a&page=queryresults
[0m20:54:10.885473 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [36:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m20:54:10.885473 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '724ba4ce-b1fb-46ba-8bc1-84c2bbd76783', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151B247D610>]}
[0m20:54:10.890445 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 0.74s]
[0m20:54:10.890445 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m20:54:10.893587 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [36:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m20:54:10.894740 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:54:10.896845 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:54:10.897961 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m20:54:10.897961 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m20:54:10.897961 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m20:54:10.899989 [info ] [MainThread]: 
[0m20:54:10.899989 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 11.43 seconds (11.43s).
[0m20:54:10.904699 [debug] [MainThread]: Command end result
[0m20:54:10.935571 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m20:54:10.948201 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m20:54:10.960950 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m20:54:10.960950 [info ] [MainThread]: 
[0m20:54:10.963470 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m20:54:10.963470 [info ] [MainThread]: 
[0m20:54:10.963470 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m20:54:10.963470 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [36:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m20:54:10.963470 [info ] [MainThread]: 
[0m20:54:10.963470 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m20:54:10.963470 [info ] [MainThread]: 
[0m20:54:10.963470 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m20:54:10.963470 [debug] [MainThread]: Command `dbt run` failed at 20:54:10.963470 after 22.27 seconds
[0m20:54:10.963470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151A288FEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151A3CFF4C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000151B239E610>]}
[0m20:54:10.963470 [debug] [MainThread]: Flushing usage events
[0m20:54:12.225985 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:14:26.349765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B91D31FEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B91F5C2F70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B91F5C21C0>]}


============================== 21:14:26.357743 | b8bd5ca3-53c7-46cd-a71d-c1368833d322 ==============================
[0m21:14:26.357743 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:14:26.357743 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'no_print': 'None', 'empty': 'False', 'partial_parse': 'True', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:14:32.844622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b8bd5ca3-53c7-46cd-a71d-c1368833d322', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B92C6BCF40>]}
[0m21:14:32.947839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b8bd5ca3-53c7-46cd-a71d-c1368833d322', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B91ED939A0>]}
[0m21:14:32.947839 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:14:34.595552 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:14:35.180952 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:14:35.180952 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:14:35.259641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b8bd5ca3-53c7-46cd-a71d-c1368833d322', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B92CDC8130>]}
[0m21:14:35.425041 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:14:35.432938 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:14:35.486294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b8bd5ca3-53c7-46cd-a71d-c1368833d322', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B91D181EE0>]}
[0m21:14:35.488245 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m21:14:35.488245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8bd5ca3-53c7-46cd-a71d-c1368833d322', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B92CD8DE50>]}
[0m21:14:35.491753 [info ] [MainThread]: 
[0m21:14:35.491753 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:14:35.491753 [info ] [MainThread]: 
[0m21:14:35.491753 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:14:35.498143 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:14:35.504774 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:14:41.719850 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:14:41.719850 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:14:42.486677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8bd5ca3-53c7-46cd-a71d-c1368833d322', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B92C6E1820>]}
[0m21:14:42.486677 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:14:42.496415 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m21:14:42.496415 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m21:14:42.496415 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m21:14:42.500816 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m21:14:42.518610 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m21:14:42.523304 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m21:14:42.570025 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m21:14:42.572885 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
    -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m21:14:42.572885 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:14:43.602805 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:2163475a-06fc-4070-8b46-be94b6cba59c&page=queryresults
[0m21:14:44.286878 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8bd5ca3-53c7-46cd-a71d-c1368833d322', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B92CECD700>]}
[0m21:14:44.296389 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.79s]
[0m21:14:44.297601 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m21:14:44.299611 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:14:44.302123 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:14:44.302123 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m21:14:44.304032 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:14:44.306560 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:14:44.312345 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:14:44.317592 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m21:14:44.320259 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

-- CTE Step 1: BronzeÂ±§„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„ÄÅÂü∫Êú¨ÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞„ÇíË°å„ÅÜ
WITH source AS (
    SELECT *
    FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),
-- CTE Step 2: ÂÄãÂà•„ÅÆ„Ç´„É©„É†„ÅÆ„Éá„Éº„ÇøÂûãÂ§âÊèõ„Å®Âü∫Êú¨ÁöÑ„Å™„ÇØ„É™„Éº„Éã„É≥„Ç∞„ÇíË°å„ÅÜ
cleaned_source AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        -- Ë§áÈõë„Å™Ë∑ùÈõ¢Ë°®Ë®ò„Çí„É´„Éº„É´„Éô„Éº„Çπ„ÅßINT„Å´Â§âÊèõ
        CASE
            WHEN distance_to_station_min = '1H30ÔΩû2H' THEN 105
            WHEN distance_to_station_min = '1HÔΩû1H30' THEN 75
            WHEN distance_to_station_min = '2HÔΩû' THEN 120
            WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                CAST(
                    (
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'^(\d+)') AS INT64)
                        +
                        SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(?:ÔΩû|~)(\d+)') AS INT64)
                    ) / 2
                AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)'), INT64)
        END AS distance_to_station_min,
        SAFE_CAST(REGEXP_EXTRACT(total_price, r'(\d+)'), INT64) AS total_price_jpy,
        SAFE_CAST(REGEXP_EXTRACT(price_per_tsubo, r'(\d+)'), INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(REGEXP_EXTRACT(area_sq_m, r'(\d+)'), INT64) AS area_sq_m,
        SAFE_CAST(REGEXP_EXTRACT(price_per_sq_m, r'(\d+)'), INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(REGEXP_EXTRACT(frontage, r'(\d+\.?\d*)'), FLOAT64) AS frontage_m,
        SAFE_CAST(REGEXP_EXTRACT(total_floor_area_sq_m, r'(\d+)'), INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(REGEXP_EXTRACT(road_width_m, r'(\d+\.?\d*)'), FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(REGEXP_EXTRACT(building_coverage_ratio_pct, r'(\d+)'), INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(REGEXP_EXTRACT(floor_area_ratio_pct, r'(\d+)'), INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        built_year AS original_built_year
    FROM source
),
-- CTE Step 3: Êñ∞„Åó„ÅÑ„Ç´„ÉÜ„Ç¥„É™Âàó„ÇÑË®àÁÆóÂàóÔºàÁâπÂæ¥ÈáèÔºâ„Çí‰ΩúÊàê„Åô„Çã
feature_engineered AS (
    SELECT
        *,
        -- ÂíåÊö¶„ÇíË•øÊö¶„Å´Â§âÊèõ
        CASE
            WHEN STARTS_WITH(original_built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(original_built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(original_built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(original_built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        -- ÈñìÂèñ„Çä„ÇíÂàÜÈ°û
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        -- Âª∫Áâ©„ÅÆÊßãÈÄ†„ÇíÂàÜÈ°û
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category
    FROM cleaned_source
),

-- CTE Step 4: JOIN„ÅÆ„Åü„ÇÅ„ÅÆÁµêÂêà„Ç≠„Éº„Çí‰ΩúÊàê„Åô„Çã
transactions_with_key AS (
    SELECT
        *,
        -- Ë§áÊï∞„ÅÆË°®Ë®òÊè∫„Çå„ÇíÂê∏Âèé„Åô„ÇãÁµêÂêà„Ç≠„Éº
        prefecture || city_name ||
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', '')
                        , r'Ôºà.*?Ôºâ', ''
                    ),
                '„Ç±', '„É∂'),
            'Êæ§', 'Ê≤¢')
        AS address_key
    FROM feature_engineered
),

zipcodes_with_key AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

-- CTE Step 5: ÂèñÂºï„Éá„Éº„Çø„Å®ÈÉµ‰æøÁï™Âè∑„ÇíJOIN„Åô„Çã
joined AS (
    SELECT
        transactions_with_key.*,
        zipcodes_with_key.zipcode
    FROM
        transactions_with_key
    LEFT JOIN zipcodes_with_key
        ON transactions_with_key.address_key = zipcodes_with_key.address_key
),

-- CTE Step 6: ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„ÄÅ„É™„Éç„Éº„É†„ÄÅË®àÁÆó„ÇíË°å„ÅÜ
final_model AS (
    SELECT
        transaction_type,
        price_info_type,
        zipcode,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        total_price_jpy,
        price_per_tsubo_jpy,
        floor_plan,
        floor_plan_category,
        area_sq_m,
        price_per_sq_m,
        land_shape,
        frontage_m,
        total_floor_area_sq_m,
        built_year_ad AS built_year,
        EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
        building_structure,
        building_structure_category,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        road_width_m,
        city_planning,
        building_coverage_ratio_pct,
        floor_area_ratio_pct,
        transaction_date,
        renovation,
        special_notes
    FROM
        joined
)

-- ÊúÄÁµÇÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
SELECT *
FROM final_model
WHERE
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m21:14:44.323100 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:14:45.036159 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:8b9fd3a0-b6e5-4a62-8206-3e886aa1983d&page=queryresults
[0m21:14:45.039353 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:8b9fd3a0-b6e5-4a62-8206-3e886aa1983d&page=queryresults
[0m21:14:45.083585 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [36:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:14:45.084821 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8bd5ca3-53c7-46cd-a71d-c1368833d322', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B92D39F610>]}
[0m21:14:45.084821 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 0.78s]
[0m21:14:45.088623 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:14:45.088623 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [36:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m21:14:45.093230 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:14:45.095242 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:14:45.095242 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:14:45.095242 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:14:45.095242 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:14:45.098820 [info ] [MainThread]: 
[0m21:14:45.098820 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 9.61 seconds (9.61s).
[0m21:14:45.100892 [debug] [MainThread]: Command end result
[0m21:14:45.137214 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:14:45.152981 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:14:45.166562 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:14:45.166562 [info ] [MainThread]: 
[0m21:14:45.166562 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:14:45.169077 [info ] [MainThread]: 
[0m21:14:45.170255 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m21:14:45.170255 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [36:77]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:14:45.170255 [info ] [MainThread]: 
[0m21:14:45.172638 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m21:14:45.172638 [info ] [MainThread]: 
[0m21:14:45.172638 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m21:14:45.172638 [debug] [MainThread]: Command `dbt run` failed at 21:14:45.172638 after 18.97 seconds
[0m21:14:45.172638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B91D31FEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B91ED939A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B92C87A250>]}
[0m21:14:45.172638 [debug] [MainThread]: Flushing usage events
[0m21:14:46.410052 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:36:48.850551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002929DEEFEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000292A01A3F70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000292A01A31C0>]}


============================== 21:36:48.857988 | aa76294d-8e00-4094-8501-93d215280f99 ==============================
[0m21:36:48.857988 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:36:48.857988 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'use_experimental_parser': 'False', 'empty': 'False', 'no_print': 'None', 'invocation_command': 'dbt run', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:36:56.762605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aa76294d-8e00-4094-8501-93d215280f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002929C2A07C0>]}
[0m21:36:56.863616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aa76294d-8e00-4094-8501-93d215280f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000292AD309850>]}
[0m21:36:56.865624 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:36:57.920468 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:36:58.334644 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m21:36:58.347690 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_zipcodes.sql
[0m21:36:58.349699 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m21:36:58.781650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aa76294d-8e00-4094-8501-93d215280f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000292ADB22100>]}
[0m21:36:58.907440 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:36:58.907440 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:36:58.970162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aa76294d-8e00-4094-8501-93d215280f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002929D8E6C40>]}
[0m21:36:58.970162 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m21:36:58.970162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aa76294d-8e00-4094-8501-93d215280f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000292AD982F10>]}
[0m21:36:58.977195 [info ] [MainThread]: 
[0m21:36:58.977195 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:36:58.977195 [info ] [MainThread]: 
[0m21:36:58.977195 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:36:58.986433 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:36:58.988998 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:37:05.210754 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:37:05.213480 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:37:05.891262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aa76294d-8e00-4094-8501-93d215280f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000292AD2C4400>]}
[0m21:37:05.891262 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:37:05.902645 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m21:37:05.905783 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m21:37:05.905783 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m21:37:05.905783 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m21:37:05.918939 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m21:37:05.923552 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m21:37:05.966251 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m21:37:05.966251 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
     -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m21:37:05.966251 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:37:07.062456 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:6e8180b1-0005-41a2-a731-a52685d4c394&page=queryresults
[0m21:37:08.172672 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa76294d-8e00-4094-8501-93d215280f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000292ADC73700>]}
[0m21:37:08.173958 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 2.26s]
[0m21:37:08.173958 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m21:37:08.176612 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:37:08.178255 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:37:08.178255 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m21:37:08.180349 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:37:08.188385 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:37:08.190393 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:37:08.194410 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m21:37:08.196418 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        SAFE_CAST(distance_to_station_min AS INT64) AS distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        
        -- ‚òÖ‚òÖ‚òÖ „Åì„Å°„Çâ„ÇÇÂÖ®„ÅèÂêå„ÅòÊúÄÁµÇÁâà„ÅÆ„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ„Å´‰øÆÊ≠£ ‚òÖ‚òÖ‚òÖ
        prefecture || city_name || 
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''), -- 1. Â§ßÂ≠ó„ÇíÈô§Âéª
                    r'Ôºà.*?Ôºâ', ''), -- 2. Êã¨Âºß„ÇíÈô§Âéª
                '„Ç±', '„É∂'), -- 3. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
            'Êæ§', 'Ê≤¢') -- 4. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
        AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    -- ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„Å®È†ÜÁï™„ÅÆÂÆöÁæ©
    SELECT *
    FROM joined
)

-- ÊúÄÁµÇÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
SELECT
    transaction_type,
    price_info_type,
    zipcode,
    prefecture,
    city_name,
    district_name,
    station_name,
    distance_to_station_min,
    total_price_jpy,
    price_per_tsubo_jpy,
    floor_plan,
    floor_plan_category,
    area_sq_m,
    price_per_sq_m,
    land_shape,
    frontage_m,
    total_floor_area_sq_m,
    built_year_ad AS built_year,
    EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
    building_structure,
    building_structure_category,
    purpose,
    future_purpose,
    road_direction,
    road_type,
    road_width_m,
    city_planning,
    building_coverage_ratio_pct,
    floor_area_ratio_pct,
    transaction_date,
    renovation,
    special_notes
FROM final
WHERE
    -- ‚òÖ‚òÖ‚òÖ Â≥∂Â∂ºÈÉ®„ÅÆÂ∏ÇÁî∫Êùë„ÇíÂàÜÊûêÂØæË±°„Åã„ÇâÈô§Â§ñ ‚òÖ‚òÖ‚òÖ
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    
    -- JOIN„Ç≠„Éº„Å®„Åó„Å¶Ê©üËÉΩ„Åó„Å™„ÅÑÂú∞Âå∫Âêç„ÅÆ„Éá„Éº„Çø„ÇíÈô§Â§ñ
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m21:37:08.198429 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:37:09.582521 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:0eaed03f-9061-4ad1-9b86-4abbb02cec83&page=queryresults
[0m21:37:09.764377 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa76294d-8e00-4094-8501-93d215280f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000292AD9CE250>]}
[0m21:37:09.764377 [info ] [Thread-1  ]: 2 of 2 OK created sql view model real_estate_silver.stg_transactions ........... [[32mCREATE VIEW (0 processed)[0m in 1.58s]
[0m21:37:09.764377 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:37:09.767363 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:37:09.770802 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:37:09.770802 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:37:09.770802 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:37:09.772542 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:37:09.772542 [info ] [MainThread]: 
[0m21:37:09.772542 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 10.80 seconds (10.80s).
[0m21:37:09.772542 [debug] [MainThread]: Command end result
[0m21:37:09.812507 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:37:09.819126 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:37:09.830179 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:37:09.830179 [info ] [MainThread]: 
[0m21:37:09.832187 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:37:09.833387 [info ] [MainThread]: 
[0m21:37:09.833387 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m21:37:09.836220 [debug] [MainThread]: Command `dbt run` succeeded at 21:37:09.836220 after 21.13 seconds
[0m21:37:09.836220 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002929DEEFEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000292AD7BAD60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002929D8E6C40>]}
[0m21:37:09.838857 [debug] [MainThread]: Flushing usage events
[0m21:37:11.059438 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:47:05.037966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000227725DFE50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022774883F40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022774883190>]}


============================== 21:47:05.047517 | 38a7fa1f-ef94-45e0-b466-ac1661152ab2 ==============================
[0m21:47:05.047517 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:47:05.048474 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'warn_error': 'None', 'log_cache_events': 'False', 'partial_parse': 'True', 'invocation_command': 'dbt run', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:47:10.986601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '38a7fa1f-ef94-45e0-b466-ac1661152ab2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000227748592E0>]}
[0m21:47:11.100916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '38a7fa1f-ef94-45e0-b466-ac1661152ab2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022774859BB0>]}
[0m21:47:11.102516 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:47:12.256871 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:47:12.836690 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:47:12.836690 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m21:47:13.277325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '38a7fa1f-ef94-45e0-b466-ac1661152ab2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022702221130>]}
[0m21:47:13.409560 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:47:13.414486 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:47:13.459898 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '38a7fa1f-ef94-45e0-b466-ac1661152ab2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000227020834F0>]}
[0m21:47:13.459898 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m21:47:13.461845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '38a7fa1f-ef94-45e0-b466-ac1661152ab2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022701EE90A0>]}
[0m21:47:13.463854 [info ] [MainThread]: 
[0m21:47:13.463854 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:47:13.463854 [info ] [MainThread]: 
[0m21:47:13.468144 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:47:13.470662 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:47:13.477498 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:47:19.509290 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:47:19.509290 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:47:20.180123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '38a7fa1f-ef94-45e0-b466-ac1661152ab2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022770C36F10>]}
[0m21:47:20.192166 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:47:20.194176 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m21:47:20.201330 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m21:47:20.204561 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m21:47:20.204561 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m21:47:20.222686 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m21:47:20.224202 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m21:47:20.271836 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m21:47:20.275021 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
     -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m21:47:20.275021 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:47:21.693197 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:cab7a432-fe70-4980-b934-17cdf82612cf&page=queryresults
[0m21:47:22.245491 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38a7fa1f-ef94-45e0-b466-ac1661152ab2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000227023755E0>]}
[0m21:47:22.245491 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 2.04s]
[0m21:47:22.245491 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m21:47:22.257886 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:47:22.257886 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:47:22.257886 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m21:47:22.261875 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:47:22.268562 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:47:22.268562 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:47:22.277208 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m21:47:22.280709 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- models/stg_transactions.sql

-- Step 1: Ë§áÈõë„Å™ÊôÇÈñìË°®Ë®òÔºà‰æã: '1H30'Ôºâ„ÇíÂàÜÔºà‰æã: 90Ôºâ„Å´Â§âÊèõ„Åô„ÇãÈñ¢Êï∞„ÇíÂÆöÁæ©
CREATE TEMP FUNCTION parse_time_to_minutes(time_str STRING) AS (
  CAST(
    -- 'H'„ÅÆÂâç„ÅÆÊï∞ÂÄ§ (ÊôÇÈñì) „ÇíÂàÜ„Å´Â§âÊèõ
    COALESCE(SAFE_CAST(REGEXP_EXTRACT(time_str, r'(\d+)H') AS INT64), 0) * 60 +
    -- 'H'„ÅÆÂæå„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
    COALESCE(SAFE_CAST(REGEXP_EXTRACT(time_str, r'H(\d+)') AS INT64), 0) +
    -- 'H'„ÅåÂê´„Åæ„Çå„Å™„ÅÑÂ†¥Âêà„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
    CASE 
        WHEN NOT REGEXP_CONTAINS(time_str, 'H') THEN COALESCE(SAFE_CAST(REGEXP_EXTRACT(time_str, r'(\d+)'), AS INT64), 0) 
        ELSE 0 
    END
  AS INT64)
);

-- Step 2: Êó¢Â≠ò„ÅÆCTE„ÇíÁµÑ„ÅøÁ´ã„Å¶„Çã
WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        
        -- ‚òÖ‚òÖ‚òÖ „Åì„Åì„Çí‰øÆÊ≠£ ‚òÖ‚òÖ‚òÖ
        -- ÂÖÉ„ÅÆÊñáÂ≠óÂàó„ÅÆ„Åæ„Åæ„ÄÅÂæåÁ∂ö„ÅÆÂá¶ÁêÜ„Å´Ê∏°„Åô
        distance_to_station_min,
        
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        
        -- ‚òÖ‚òÖ‚òÖ „Åì„Å°„Çâ„ÇÇÂÖ®„ÅèÂêå„ÅòÊúÄÁµÇÁâà„ÅÆ„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ„Å´‰øÆÊ≠£ ‚òÖ‚òÖ‚òÖ
        prefecture || city_name || 
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''), -- 1. Â§ßÂ≠ó„ÇíÈô§Âéª
                    r'Ôºà.*?Ôºâ', ''), -- 2. Êã¨Âºß„ÇíÈô§Âéª
                '„Ç±', '„É∂'), -- 3. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
            'Êæ§', 'Ê≤¢') -- 4. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
        AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    -- Step 3: UDF„Çí‰Ωø„Å£„Å¶distance_to_station_min„ÅÆ„ÇØ„É¨„É≥„Ç∏„É≥„Ç∞„ÇíË°å„ÅÜ
    SELECT
        * EXCEPT(distance_to_station_min), -- ÂÖÉ„ÅÆÊñáÂ≠óÂàó„Ç´„É©„É†„ÇíÈô§Â§ñ

        -- UDF„ÇíÂëº„Å≥Âá∫„Åó„Å¶„ÄÅ„É´„Éº„É´„Å´Âü∫„Å•„ÅçÂÄ§„ÇíË®àÁÆó„Åô„Çã
        CAST(
            CASE
                -- 'ÔΩû'„Åã'~'„ÇíÂê´„ÇÄÁØÑÂõ≤„ÅÆÂ†¥Âêà
                WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                    (
                        -- ÂâçÂçäÈÉ®ÂàÜ„ÇíUDF„ÅßÂ§âÊèõ
                        parse_time_to_minutes(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)])
                        +
                        -- ÂæåÂçäÈÉ®ÂàÜ„ÇíUDF„ÅßÂ§âÊèõ„ÄÇ„Åü„Å†„Åó'2HÔΩû'„ÅÆ„Çà„ÅÜ„Å´ÂæåÂçä„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄÅÂâçÂçä„Å®Âêå„ÅòÂÄ§„Çí‰Ωø„ÅÜ
                        COALESCE(
                            parse_time_to_minutes(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(1)]),
                            parse_time_to_minutes(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)])
                        )
                    ) / 2
                -- ÁØÑÂõ≤„Åß„ÅØ„Å™„ÅÑÂçòÁ¥î„Å™ÂÄ§„ÅÆÂ†¥Âêà
                ELSE parse_time_to_minutes(distance_to_station_min)
            END
        AS INT64) AS distance_to_station_min -- „ÇØ„É¨„É≥„Ç∏„É≥„Ç∞Âæå„ÅÆÂÄ§„ÇíÂÖÉ„ÅÆ„Ç´„É©„É†Âêç„Åß‰ΩúÊàê

    FROM joined
)

-- Step 4: ÊúÄÁµÇÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Å®„Ç´„É©„É†ÈÅ∏Êäû
SELECT
    transaction_type,
    price_info_type,
    zipcode,
    prefecture,
    city_name,
    district_name,
    station_name,
    distance_to_station_min, -- „ÇØ„É¨„É≥„Ç∏„É≥„Ç∞Ê∏à„Åø„ÅÆÂÄ§„Åå„Åì„Åì„Å´ÂÖ•„Çã
    total_price_jpy,
    price_per_tsubo_jpy,
    floor_plan,
    floor_plan_category,
    area_sq_m,
    price_per_sq_m,
    land_shape,
    frontage_m,
    total_floor_area_sq_m,
    built_year_ad AS built_year,
    EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
    building_structure,
    building_structure_category,
    purpose,
    future_purpose,
    road_direction,
    road_type,
    road_width_m,
    city_planning,
    building_coverage_ratio_pct,
    floor_area_ratio_pct,
    transaction_date,
    renovation,
    special_notes
FROM final
WHERE
    -- ‚òÖ‚òÖ‚òÖ Â≥∂Â∂ºÈÉ®„ÅÆÂ∏ÇÁî∫Êùë„ÇíÂàÜÊûêÂØæË±°„Åã„ÇâÈô§Â§ñ ‚òÖ‚òÖ‚òÖ
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    
    -- JOIN„Ç≠„Éº„Å®„Åó„Å¶Ê©üËÉΩ„Åó„Å™„ÅÑÂú∞Âå∫Âêç„ÅÆ„Éá„Éº„Çø„ÇíÈô§Â§ñ
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m21:47:22.280709 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:47:23.021562 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:0f39836d-8fb2-4e36-90e2-b98172cd0c6d&page=queryresults
[0m21:47:23.025310 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:0f39836d-8fb2-4e36-90e2-b98172cd0c6d&page=queryresults
[0m21:47:23.043686 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Unexpected keyword CREATE at [9:1]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:47:23.043686 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38a7fa1f-ef94-45e0-b466-ac1661152ab2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000227036E7C40>]}
[0m21:47:23.043686 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 0.79s]
[0m21:47:23.043686 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:47:23.048793 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Unexpected keyword CREATE at [9:1]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m21:47:23.050239 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:47:23.051829 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:47:23.053352 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:47:23.053352 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:47:23.053352 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:47:23.053352 [info ] [MainThread]: 
[0m21:47:23.056908 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 9.59 seconds (9.59s).
[0m21:47:23.059171 [debug] [MainThread]: Command end result
[0m21:47:23.101483 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:47:23.108133 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:47:23.121413 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:47:23.121413 [info ] [MainThread]: 
[0m21:47:23.121413 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:47:23.121413 [info ] [MainThread]: 
[0m21:47:23.121413 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m21:47:23.121413 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Unexpected keyword CREATE at [9:1]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m21:47:23.121413 [info ] [MainThread]: 
[0m21:47:23.121413 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m21:47:23.121413 [info ] [MainThread]: 
[0m21:47:23.121413 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m21:47:23.134122 [debug] [MainThread]: Command `dbt run` failed at 21:47:23.134122 after 18.23 seconds
[0m21:47:23.136133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000227725DFE50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000227748592E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022773955CD0>]}
[0m21:47:23.136133 [debug] [MainThread]: Flushing usage events
[0m21:47:24.425313 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:50:13.951570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1079DFE20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1093F5520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F109C82F70>]}


============================== 21:50:13.957442 | c292d9ee-245e-46a5-b5e1-12a70c5a4cba ==============================
[0m21:50:13.957442 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:50:13.957442 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'warn_error': 'None', 'use_experimental_parser': 'False', 'empty': 'False', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:50:18.732178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c292d9ee-245e-46a5-b5e1-12a70c5a4cba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F116E8C670>]}
[0m21:50:18.823825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c292d9ee-245e-46a5-b5e1-12a70c5a4cba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F116D09D90>]}
[0m21:50:18.823825 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:50:19.903966 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:50:20.320415 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:50:20.320415 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m21:50:20.729837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c292d9ee-245e-46a5-b5e1-12a70c5a4cba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F117690130>]}
[0m21:50:20.860295 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:50:20.874079 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:50:20.909307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c292d9ee-245e-46a5-b5e1-12a70c5a4cba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F110C9C250>]}
[0m21:50:20.913200 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m21:50:20.913200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c292d9ee-245e-46a5-b5e1-12a70c5a4cba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1172B5FD0>]}
[0m21:50:20.915290 [info ] [MainThread]: 
[0m21:50:20.915290 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:50:20.915290 [info ] [MainThread]: 
[0m21:50:20.920080 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:50:20.922313 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:50:20.930748 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:50:24.219795 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:50:24.219795 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:50:24.924088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c292d9ee-245e-46a5-b5e1-12a70c5a4cba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1174B4730>]}
[0m21:50:24.924088 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:50:24.930574 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m21:50:24.930574 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m21:50:24.930574 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m21:50:24.930574 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m21:50:24.941005 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m21:50:24.941005 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m21:50:24.987277 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m21:50:24.987277 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
     -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m21:50:24.996980 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:50:26.305764 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:e42c6de5-f122-4848-b753-9969a367d7ac&page=queryresults
[0m21:50:26.816870 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c292d9ee-245e-46a5-b5e1-12a70c5a4cba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1093F5220>]}
[0m21:50:26.816870 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.89s]
[0m21:50:26.822954 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m21:50:26.822954 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:50:26.822954 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:50:26.822954 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m21:50:26.828004 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:50:26.834038 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:50:26.834038 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:50:26.834038 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */

        CREATE TEMP FUNCTION parse_time_to_minutes(time_str STRING) AS (
            CAST(
                -- 'H'„ÅÆÂâç„ÅÆÊï∞ÂÄ§ (ÊôÇÈñì) „ÇíÂàÜ„Å´Â§âÊèõ
                COALESCE(SAFE_CAST(REGEXP_EXTRACT(time_str, r'(\d+)H') AS INT64), 0) * 60 +
                -- 'H'„ÅÆÂæå„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
                COALESCE(SAFE_CAST(REGEXP_EXTRACT(time_str, r'H(\d+)') AS INT64), 0) +
                -- 'H'„ÅåÂê´„Åæ„Çå„Å™„ÅÑÂ†¥Âêà„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
                CASE 
                    WHEN NOT REGEXP_CONTAINS(time_str, 'H') THEN COALESCE(SAFE_CAST(REGEXP_EXTRACT(time_str, r'(\d+)'), AS INT64), 0) 
                    ELSE 0 
                END
            AS INT64)
        );
      
[0m21:50:26.834038 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:50:27.547237 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:8ccbbc52-d65b-4653-9d00-8fdfba623f9e&page=queryresults
[0m21:50:27.547237 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:8ccbbc52-d65b-4653-9d00-8fdfba623f9e&page=queryresults
[0m21:50:27.563240 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [11:119]
[0m21:50:27.563240 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c292d9ee-245e-46a5-b5e1-12a70c5a4cba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F118AC9AF0>]}
[0m21:50:27.563240 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 0.74s]
[0m21:50:27.563240 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:50:27.563240 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [11:119].
[0m21:50:27.563240 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:50:27.563240 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:50:27.563240 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:50:27.563240 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:50:27.563240 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:50:27.563240 [info ] [MainThread]: 
[0m21:50:27.563240 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 6.64 seconds (6.64s).
[0m21:50:27.579569 [debug] [MainThread]: Command end result
[0m21:50:27.617836 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:50:27.624014 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:50:27.627591 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:50:27.627591 [info ] [MainThread]: 
[0m21:50:27.627591 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:50:27.627591 [info ] [MainThread]: 
[0m21:50:27.627591 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m21:50:27.627591 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [11:119]
[0m21:50:27.643318 [info ] [MainThread]: 
[0m21:50:27.645370 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m21:50:27.645370 [info ] [MainThread]: 
[0m21:50:27.648415 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m21:50:27.650285 [debug] [MainThread]: Command `dbt run` failed at 21:50:27.650285 after 13.83 seconds
[0m21:50:27.650285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1079DFE20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F116DBC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F108D8B8E0>]}
[0m21:50:27.652135 [debug] [MainThread]: Flushing usage events
[0m21:50:28.884970 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:55:06.884194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025FC3B9FE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025FC5E43F40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025FC5E431C0>]}


============================== 21:55:06.891122 | bb79755b-7b94-42a4-ab4a-b4ef3fde17c5 ==============================
[0m21:55:06.891122 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:55:06.891122 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'quiet': 'False', 'partial_parse': 'True', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:55:12.089766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bb79755b-7b94-42a4-ab4a-b4ef3fde17c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025FC1F78BB0>]}
[0m21:55:12.199588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bb79755b-7b94-42a4-ab4a-b4ef3fde17c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025FD2FA9C40>]}
[0m21:55:12.201585 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:55:13.268526 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:55:13.680067 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:55:13.680067 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m21:55:14.102986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bb79755b-7b94-42a4-ab4a-b4ef3fde17c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025FD37B5130>]}
[0m21:55:14.244719 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:55:14.249824 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:55:14.293287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bb79755b-7b94-42a4-ab4a-b4ef3fde17c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025FD36003A0>]}
[0m21:55:14.294390 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m21:55:14.295472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bb79755b-7b94-42a4-ab4a-b4ef3fde17c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025FD37EA4F0>]}
[0m21:55:14.298913 [info ] [MainThread]: 
[0m21:55:14.300759 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:55:14.302266 [info ] [MainThread]: 
[0m21:55:14.303374 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:55:14.310688 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:55:14.311700 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:55:17.756418 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:55:17.756418 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:55:18.495502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bb79755b-7b94-42a4-ab4a-b4ef3fde17c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025FD30D51C0>]}
[0m21:55:18.495502 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:55:18.498160 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m21:55:18.504335 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m21:55:18.506175 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m21:55:18.507211 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m21:55:18.519224 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m21:55:18.521227 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m21:55:18.560156 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m21:55:18.560156 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
     -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m21:55:18.560156 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:55:19.902991 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:94f37c95-c062-471c-9032-52c1f7de0b25&page=queryresults
[0m21:55:20.427976 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb79755b-7b94-42a4-ab4a-b4ef3fde17c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025FD3918490>]}
[0m21:55:20.427976 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.92s]
[0m21:55:20.427976 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m21:55:20.427976 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:55:20.427976 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:55:20.427976 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m21:55:20.427976 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:55:20.442195 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:55:20.445016 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:55:20.445016 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m21:55:20.445016 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- „Äê„Çπ„ÉÜ„ÉÉ„Éó1„Äë interim CTE„ÅÆSAFE_CAST„ÇíËß£Èô§„Åó„ÄÅÂÖÉ„ÅÆÊñáÂ≠óÂàó„Çí„Åù„ÅÆ„Åæ„ÅæÊ∏°„Åó„Åæ„Åô

WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,

        -- ‚òÖ‚òÖ‚òÖ „Åì„ÅÆ1Ë°å„Å†„Åë„ÇíÂ§âÊõ¥ ‚òÖ‚òÖ‚òÖ
        distance_to_station_min, -- SAFE_CAST„ÇíÂâäÈô§

        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        
        prefecture || city_name || 
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''), -- 1. Â§ßÂ≠ó„ÇíÈô§Âéª
                    r'Ôºà.*?Ôºâ', ''), -- 2. Êã¨Âºß„ÇíÈô§Âéª
                '„Ç±', '„É∂'), -- 3. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
            'Êæ§', 'Ê≤¢') -- 4. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
        AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    -- ÊúÄÁµÇÁöÑ„Å™Âàó„ÅÆÈÅ∏Êäû„Å®È†ÜÁï™„ÅÆÂÆöÁæ©
    SELECT *
    FROM joined
)

-- ÊúÄÁµÇÁöÑ„Å™„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
SELECT
    transaction_type,
    price_info_type,
    zipcode,
    prefecture,
    city_name,
    district_name,
    station_name,
    distance_to_station_min,
    total_price_jpy,
    price_per_tsubo_jpy,
    floor_plan,
    floor_plan_category,
    area_sq_m,
    price_per_sq_m,
    land_shape,
    frontage_m,
    total_floor_area_sq_m,
    built_year_ad AS built_year,
    EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
    building_structure,
    building_structure_category,
    purpose,
    future_purpose,
    road_direction,
    road_type,
    road_width_m,
    city_planning,
    building_coverage_ratio_pct,
    floor_area_ratio_pct,
    transaction_date,
    renovation,
    special_notes
FROM final
WHERE
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m21:55:20.445016 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:55:21.825966 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:0816ea5e-69a1-4dea-af78-ad99d5d91f15&page=queryresults
[0m21:55:22.016306 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb79755b-7b94-42a4-ab4a-b4ef3fde17c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025FD36B52B0>]}
[0m21:55:22.018553 [info ] [Thread-1  ]: 2 of 2 OK created sql view model real_estate_silver.stg_transactions ........... [[32mCREATE VIEW (0 processed)[0m in 1.59s]
[0m21:55:22.018553 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:55:22.022830 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:55:22.022830 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:55:22.022830 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:55:22.022830 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:55:22.022830 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:55:22.022830 [info ] [MainThread]: 
[0m21:55:22.022830 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 7.72 seconds (7.72s).
[0m21:55:22.029414 [debug] [MainThread]: Command end result
[0m21:55:22.068080 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:55:22.074561 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:55:22.086113 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:55:22.086113 [info ] [MainThread]: 
[0m21:55:22.086113 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:55:22.086113 [info ] [MainThread]: 
[0m21:55:22.089099 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m21:55:22.090815 [debug] [MainThread]: Command `dbt run` succeeded at 21:55:22.090815 after 15.40 seconds
[0m21:55:22.090815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025FC3B9FE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025FC355C730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025FD2FA9C40>]}
[0m21:55:22.092997 [debug] [MainThread]: Flushing usage events
[0m21:55:23.302643 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:56:20.066191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149BA75FE50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149BCA03F40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149BCA03190>]}


============================== 21:56:20.072910 | 52679172-324e-4b43-a396-861d289fb783 ==============================
[0m21:56:20.072910 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:56:20.072910 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:56:24.922348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '52679172-324e-4b43-a396-861d289fb783', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149B8CF6E50>]}
[0m21:56:25.033058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '52679172-324e-4b43-a396-861d289fb783', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149BC966A90>]}
[0m21:56:25.033058 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:56:26.181268 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:56:26.621678 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:56:26.621678 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m21:56:27.063590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '52679172-324e-4b43-a396-861d289fb783', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149CA410130>]}
[0m21:56:27.205925 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:56:27.212760 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:56:27.245049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '52679172-324e-4b43-a396-861d289fb783', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149BA6305B0>]}
[0m21:56:27.245049 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m21:56:27.245049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '52679172-324e-4b43-a396-861d289fb783', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149CA1E3AF0>]}
[0m21:56:27.254095 [info ] [MainThread]: 
[0m21:56:27.256920 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:56:27.256920 [info ] [MainThread]: 
[0m21:56:27.259100 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:56:27.265406 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:56:27.268667 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:56:30.523559 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:56:30.523559 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:56:31.208136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '52679172-324e-4b43-a396-861d289fb783', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149CA3D7220>]}
[0m21:56:31.208136 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:56:31.224488 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m21:56:31.224488 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m21:56:31.224488 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m21:56:31.224488 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m21:56:31.240565 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m21:56:31.240565 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m21:56:31.292598 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m21:56:31.292598 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
     -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m21:56:31.300993 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:56:32.383942 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:a9c6c3c4-e046-42d9-a894-6009921543d5&page=queryresults
[0m21:56:32.952258 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '52679172-324e-4b43-a396-861d289fb783', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149CA4D6FD0>]}
[0m21:56:32.954850 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.73s]
[0m21:56:32.954850 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m21:56:32.957078 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:56:32.957078 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:56:32.957078 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m21:56:32.957078 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:56:32.969672 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:56:32.969672 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:56:32.969672 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */

        CREATE TEMP FUNCTION parse_time_to_minutes(time_str STRING) AS (
            CAST(
                -- 'H'„ÅÆÂâç„ÅÆÊï∞ÂÄ§ (ÊôÇÈñì) „ÇíÂàÜ„Å´Â§âÊèõ
                COALESCE(SAFE_CAST(REGEXP_EXTRACT(time_str, r'(\d+)H') AS INT64), 0) * 60 +
                -- 'H'„ÅÆÂæå„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
                COALESCE(SAFE_CAST(REGEXP_EXTRACT(time_str, r'H(\d+)') AS INT64), 0) +
                -- 'H'„ÅåÂê´„Åæ„Çå„Å™„ÅÑÂ†¥Âêà„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
                CASE 
                    WHEN NOT REGEXP_CONTAINS(time_str, 'H') THEN COALESCE(SAFE_CAST(REGEXP_EXTRACT(time_str, r'(\d+)') AS INT64), 0) 
                    ELSE 0 
                END
            AS INT64)
        );
      
[0m21:56:32.969672 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:56:33.668050 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:9a5dbfee-b85b-422a-8e98-d7a497ab786d&page=queryresults
[0m21:56:33.677921 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:9a5dbfee-b85b-422a-8e98-d7a497ab786d&page=queryresults
[0m21:56:33.696403 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  CREATE TEMPORARY FUNCTION statements must be followed by an actual query.
[0m21:56:33.696403 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '52679172-324e-4b43-a396-861d289fb783', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149CB841700>]}
[0m21:56:33.698413 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 0.74s]
[0m21:56:33.698413 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:56:33.700984 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  CREATE TEMPORARY FUNCTION statements must be followed by an actual query..
[0m21:56:33.702473 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:56:33.704469 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:56:33.704469 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:56:33.704469 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:56:33.704469 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:56:33.704469 [info ] [MainThread]: 
[0m21:56:33.704469 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 6.45 seconds (6.45s).
[0m21:56:33.704469 [debug] [MainThread]: Command end result
[0m21:56:33.749111 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:56:33.754954 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:56:33.761493 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:56:33.761493 [info ] [MainThread]: 
[0m21:56:33.768671 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:56:33.770612 [info ] [MainThread]: 
[0m21:56:33.770612 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m21:56:33.770612 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  CREATE TEMPORARY FUNCTION statements must be followed by an actual query.
[0m21:56:33.770612 [info ] [MainThread]: 
[0m21:56:33.774341 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m21:56:33.774341 [info ] [MainThread]: 
[0m21:56:33.774341 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m21:56:33.774341 [debug] [MainThread]: Command `dbt run` failed at 21:56:33.774341 after 13.83 seconds
[0m21:56:33.774341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149BA75FE50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149BC9E4730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000149BBB18820>]}
[0m21:56:33.774341 [debug] [MainThread]: Flushing usage events
[0m21:56:35.097452 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:57:54.280924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000294747FFEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029476AA3F70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029476AA31C0>]}


============================== 21:57:54.288411 | e2cbafec-05ac-481e-80c2-69d9bcebff40 ==============================
[0m21:57:54.288411 [info ] [MainThread]: Running with dbt=1.10.11
[0m21:57:54.288411 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'use_experimental_parser': 'False', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'invocation_command': 'dbt run', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:57:59.324350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e2cbafec-05ac-481e-80c2-69d9bcebff40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029403BBB190>]}
[0m21:57:59.428679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e2cbafec-05ac-481e-80c2-69d9bcebff40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029403B80370>]}
[0m21:57:59.430688 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:58:00.474034 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m21:58:00.890135 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:58:00.890135 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m21:58:01.346352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e2cbafec-05ac-481e-80c2-69d9bcebff40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000294044BE130>]}
[0m21:58:01.497746 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:58:01.501777 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:58:01.540061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e2cbafec-05ac-481e-80c2-69d9bcebff40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000294040E6F10>]}
[0m21:58:01.540061 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m21:58:01.542334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2cbafec-05ac-481e-80c2-69d9bcebff40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002940426F610>]}
[0m21:58:01.545526 [info ] [MainThread]: 
[0m21:58:01.546542 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:58:01.546542 [info ] [MainThread]: 
[0m21:58:01.548210 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:58:01.549641 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m21:58:01.549641 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:58:06.569878 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m21:58:06.569878 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:58:07.259592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2cbafec-05ac-481e-80c2-69d9bcebff40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029403D7D610>]}
[0m21:58:07.261326 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:58:07.261326 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m21:58:07.261326 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m21:58:07.270624 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m21:58:07.270624 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m21:58:07.282643 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m21:58:07.282643 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m21:58:07.333946 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m21:58:07.335948 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
     -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m21:58:07.337422 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:58:08.135089 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:ed7f9619-a26d-47c1-bf71-2fb3e8ca37a1&page=queryresults
[0m21:58:08.990620 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2cbafec-05ac-481e-80c2-69d9bcebff40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000294045913A0>]}
[0m21:58:08.994885 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.73s]
[0m21:58:08.996368 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m21:58:08.996368 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m21:58:08.998670 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m21:58:08.998670 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m21:58:09.001127 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m21:58:09.007333 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m21:58:09.010617 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m21:58:09.010617 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */

        CREATE TEMP FUNCTION parse_time_to_minutes(time_str STRING) AS (
            CAST(
                -- 'H'„ÅÆÂâç„ÅÆÊï∞ÂÄ§ (ÊôÇÈñì) „ÇíÂàÜ„Å´Â§âÊèõ
                COALESCE(SAFE_CAST(REGEXP_EXTRACT(time_str, r'(\d+)H') AS INT64), 0) * 60 +
                -- 'H'„ÅÆÂæå„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
                COALESCE(SAFE_CAST(REGEXP_EXTRACT(time_str, r'H(\d+)') AS INT64), 0) +
                -- 'H'„ÅåÂê´„Åæ„Çå„Å™„ÅÑÂ†¥Âêà„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
                CASE 
                    WHEN NOT REGEXP_CONTAINS(time_str, 'H') THEN COALESCE(SAFE_CAST(REGEXP_EXTRACT(time_str, r'(\d+)') AS INT64), 0) 
                    ELSE 0 
                END
            AS INT64)
        )
      
[0m21:58:09.010617 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:58:09.719658 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:9f6ec042-3eda-4335-b787-83f1b19f95f4&page=queryresults
[0m21:58:09.719658 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:9f6ec042-3eda-4335-b787-83f1b19f95f4&page=queryresults
[0m21:58:09.743792 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  CREATE TEMPORARY FUNCTION statements must be followed by an actual query.
[0m21:58:09.744855 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2cbafec-05ac-481e-80c2-69d9bcebff40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000294058F1BB0>]}
[0m21:58:09.744855 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 0.75s]
[0m21:58:09.748997 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m21:58:09.749506 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  CREATE TEMPORARY FUNCTION statements must be followed by an actual query..
[0m21:58:09.751514 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:58:09.753753 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:58:09.753753 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m21:58:09.755762 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m21:58:09.755762 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m21:58:09.755762 [info ] [MainThread]: 
[0m21:58:09.757884 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 8.21 seconds (8.21s).
[0m21:58:09.757884 [debug] [MainThread]: Command end result
[0m21:58:09.796714 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m21:58:09.799414 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m21:58:09.815159 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m21:58:09.815159 [info ] [MainThread]: 
[0m21:58:09.815159 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:58:09.818034 [info ] [MainThread]: 
[0m21:58:09.818034 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m21:58:09.819937 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  CREATE TEMPORARY FUNCTION statements must be followed by an actual query.
[0m21:58:09.819937 [info ] [MainThread]: 
[0m21:58:09.821525 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m21:58:09.821525 [info ] [MainThread]: 
[0m21:58:09.823293 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m21:58:09.824533 [debug] [MainThread]: Command `dbt run` failed at 21:58:09.824533 after 15.68 seconds
[0m21:58:09.825861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000294747FFEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029475C43220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029475BA4D60>]}
[0m21:58:09.825861 [debug] [MainThread]: Flushing usage events
[0m21:58:11.070368 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:20:15.570748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C364C0FE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C366EB3F40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C366EB31C0>]}


============================== 22:20:15.579149 | 2a661764-0b7e-48ea-a3a7-2b07ac7f2b7d ==============================
[0m22:20:15.579149 [info ] [MainThread]: Running with dbt=1.10.11
[0m22:20:15.580950 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'partial_parse': 'True', 'warn_error': 'None', 'empty': 'False', 'invocation_command': 'dbt run', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m22:20:21.510311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2a661764-0b7e-48ea-a3a7-2b07ac7f2b7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C362FE8BB0>]}
[0m22:20:21.617221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2a661764-0b7e-48ea-a3a7-2b07ac7f2b7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C373F5DF70>]}
[0m22:20:21.617221 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m22:20:22.712153 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m22:20:23.193874 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:20:23.193874 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m22:20:23.654476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2a661764-0b7e-48ea-a3a7-2b07ac7f2b7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C3748C0FD0>]}
[0m22:20:23.793066 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m22:20:23.806901 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m22:20:23.887425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2a661764-0b7e-48ea-a3a7-2b07ac7f2b7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C364A92220>]}
[0m22:20:23.887425 [info ] [MainThread]: Found 2 models, 2 sources, 495 macros
[0m22:20:23.887425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2a661764-0b7e-48ea-a3a7-2b07ac7f2b7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C3741963D0>]}
[0m22:20:23.887425 [info ] [MainThread]: 
[0m22:20:23.887425 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:20:23.887425 [info ] [MainThread]: 
[0m22:20:23.902108 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:20:23.902108 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m22:20:23.902108 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:20:31.754499 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m22:20:31.758547 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:20:32.472284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2a661764-0b7e-48ea-a3a7-2b07ac7f2b7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C3746DA220>]}
[0m22:20:32.476108 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:20:32.479696 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m22:20:32.479696 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m22:20:32.486290 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m22:20:32.487860 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m22:20:32.499902 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m22:20:32.501911 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m22:20:32.549369 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m22:20:32.552200 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
     -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m22:20:32.553491 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m22:20:33.708356 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:aa1395bc-fada-4f33-9fa6-d1be2d669a33&page=queryresults
[0m22:20:34.266165 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a661764-0b7e-48ea-a3a7-2b07ac7f2b7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C374986E50>]}
[0m22:20:34.266165 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.78s]
[0m22:20:34.266165 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m22:20:34.266165 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m22:20:34.266165 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m22:20:34.266165 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m22:20:34.275204 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m22:20:34.282270 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m22:20:34.282270 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m22:20:34.285099 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */

        CREATE TEMP FUNCTION parse_time_to_minutes(time_str STRING) AS (
            CAST(
                -- 'H'„ÅÆÂâç„ÅÆÊï∞ÂÄ§ (ÊôÇÈñì) „ÇíÂàÜ„Å´Â§âÊèõ
                COALESCE(SAFE_CAST(REGEXP_EXTRACT(time_str, r'(\d+)H') AS INT64), 0) * 60 +
                -- 'H'„ÅÆÂæå„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
                COALESCE(SAFE_CAST(REGEXP_EXTRACT(time_str, r'H(\d+)') AS INT64), 0) +
                -- 'H'„ÅåÂê´„Åæ„Çå„Å™„ÅÑÂ†¥Âêà„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
                CASE 
                    WHEN NOT REGEXP_CONTAINS(time_str, 'H') THEN COALESCE(SAFE_CAST(REGEXP_EXTRACT(time_str, r'(\d+)') AS INT64), 0) 
                    ELSE 0 
                END
            AS INT64)
        );
        SELECT 1;
      
[0m22:20:34.285099 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m22:20:35.073759 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:1cf4ab2a-756a-43d3-8a1d-d6bd7d8b521f&page=queryresults
[0m22:20:35.315721 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m22:20:35.315721 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as 

WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        prefecture || city_name || 
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''),
                    r'Ôºà.*?Ôºâ', ''),
                '„Ç±', '„É∂'),
            'Êæ§', 'Ê≤¢')
        AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    SELECT
        * EXCEPT(distance_to_station_min),

        CAST(
            CASE
                WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                    (
                        parse_time_to_minutes(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)])
                        +
                        COALESCE(
                            parse_time_to_minutes(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(1)]),
                            parse_time_to_minutes(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)])
                        )
                    ) / 2
                ELSE parse_time_to_minutes(distance_to_station_min)
            END
        AS INT64) AS distance_to_station_min

    FROM joined
)

SELECT
    transaction_type,
    price_info_type,
    zipcode,
    prefecture,
    city_name,
    district_name,
    station_name,
    distance_to_station_min,
    total_price_jpy,
    price_per_tsubo_jpy,
    floor_plan,
    floor_plan_category,
    area_sq_m,
    price_per_sq_m,
    land_shape,
    frontage_m,
    total_floor_area_sq_m,
    built_year_ad AS built_year,
    EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
    building_structure,
    building_structure_category,
    purpose,
    future_purpose,
    road_direction,
    road_type,
    road_width_m,
    city_planning,
    building_coverage_ratio_pct,
    floor_area_ratio_pct,
    transaction_date,
    renovation,
    special_notes
FROM final
WHERE
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m22:20:36.073282 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:480d47fc-4b25-42b7-b992-75a04073e88f&page=queryresults
[0m22:20:36.156721 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:480d47fc-4b25-42b7-b992-75a04073e88f&page=queryresults
[0m22:20:36.181657 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Function not found: parse_time_to_minutes at [107:25]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m22:20:36.181657 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a661764-0b7e-48ea-a3a7-2b07ac7f2b7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C374986C10>]}
[0m22:20:36.184756 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 1.92s]
[0m22:20:36.187041 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m22:20:36.187041 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Function not found: parse_time_to_minutes at [107:25]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m22:20:36.191936 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:20:36.191936 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:20:36.191936 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m22:20:36.191936 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m22:20:36.191936 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m22:20:36.195946 [info ] [MainThread]: 
[0m22:20:36.195946 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 12.29 seconds (12.29s).
[0m22:20:36.195946 [debug] [MainThread]: Command end result
[0m22:20:36.235006 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m22:20:36.240081 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m22:20:36.254386 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m22:20:36.256448 [info ] [MainThread]: 
[0m22:20:36.256448 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:20:36.256448 [info ] [MainThread]: 
[0m22:20:36.256448 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m22:20:36.256448 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Function not found: parse_time_to_minutes at [107:25]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m22:20:36.256448 [info ] [MainThread]: 
[0m22:20:36.262074 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m22:20:36.262074 [info ] [MainThread]: 
[0m22:20:36.264266 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m22:20:36.267487 [debug] [MainThread]: Command `dbt run` failed at 22:20:36.267487 after 20.84 seconds
[0m22:20:36.267487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C364C0FE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C373FD4310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C37466E8E0>]}
[0m22:20:36.267487 [debug] [MainThread]: Flushing usage events
[0m22:20:37.489640 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:09:48.097561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001967DB8FE20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001967F5A6520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001967FE33F70>]}


============================== 19:09:48.106453 | 828f4f5e-9c57-479f-8c98-ac8681d957f9 ==============================
[0m19:09:48.106453 [info ] [MainThread]: Running with dbt=1.10.11
[0m19:09:48.108470 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'partial_parse': 'True', 'no_print': 'None', 'empty': 'False', 'invocation_command': 'dbt run', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m19:09:55.336985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '828f4f5e-9c57-479f-8c98-ac8681d957f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001967DA7A5B0>]}
[0m19:09:55.439257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '828f4f5e-9c57-479f-8c98-ac8681d957f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001960CEE7EE0>]}
[0m19:09:55.441265 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m19:09:56.554005 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m19:09:57.122343 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m19:09:57.124343 [debug] [MainThread]: Partial parsing: added file: realestate_analytics://macros\parse_time_to_minutes.sql
[0m19:09:57.125534 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m19:09:57.609103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '828f4f5e-9c57-479f-8c98-ac8681d957f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001960D7D6130>]}
[0m19:09:57.744159 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m19:09:57.750181 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m19:09:57.820950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '828f4f5e-9c57-479f-8c98-ac8681d957f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001960D12DDC0>]}
[0m19:09:57.822189 [info ] [MainThread]: Found 2 models, 2 sources, 496 macros
[0m19:09:57.823226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '828f4f5e-9c57-479f-8c98-ac8681d957f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001960D61E760>]}
[0m19:09:57.826222 [info ] [MainThread]: 
[0m19:09:57.827223 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:09:57.828227 [info ] [MainThread]: 
[0m19:09:57.829222 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m19:09:57.839069 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m19:09:57.840068 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:10:07.585974 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m19:10:07.587975 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:10:08.309586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '828f4f5e-9c57-479f-8c98-ac8681d957f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001960D6864C0>]}
[0m19:10:08.310585 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:10:08.320138 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m19:10:08.322799 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m19:10:08.324841 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m19:10:08.325841 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m19:10:08.342654 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m19:10:08.344953 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m19:10:08.391759 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m19:10:08.393775 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
     -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m19:10:08.394767 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m19:10:09.438963 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:48ee8afe-8708-40af-bc8d-b4099ee76231&page=queryresults
[0m19:10:10.599919 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '828f4f5e-9c57-479f-8c98-ac8681d957f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001960D9199A0>]}
[0m19:10:10.600925 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 2.27s]
[0m19:10:10.602926 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m19:10:10.603960 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m19:10:10.605322 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m19:10:10.606691 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m19:10:10.607693 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m19:10:10.614688 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m19:10:10.615685 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m19:10:10.621784 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m19:10:10.625335 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        prefecture || city_name || 
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''),
                    r'Ôºà.*?Ôºâ', ''),
                '„Ç±', '„É∂'),
            'Êæ§', 'Ê≤¢')
        AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    SELECT
        * EXCEPT(distance_to_station_min),

        CAST(
            CASE
                WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                    (
                        parse_time_to_minutes(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)])
                        +
                        COALESCE(
                            parse_time_to_minutes(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(1)]),
                            parse_time_to_minutes(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)])
                        )
                    ) / 2
                ELSE parse_time_to_minutes(distance_to_station_min)
            END
        AS INT64) AS distance_to_station_min

    FROM joined
)

SELECT
    transaction_type,
    price_info_type,
    zipcode,
    prefecture,
    city_name,
    district_name,
    station_name,
    distance_to_station_min,
    total_price_jpy,
    price_per_tsubo_jpy,
    floor_plan,
    floor_plan_category,
    area_sq_m,
    price_per_sq_m,
    land_shape,
    frontage_m,
    total_floor_area_sq_m,
    built_year_ad AS built_year,
    EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
    building_structure,
    building_structure_category,
    purpose,
    future_purpose,
    road_direction,
    road_type,
    road_width_m,
    city_planning,
    building_coverage_ratio_pct,
    floor_area_ratio_pct,
    transaction_date,
    renovation,
    special_notes
FROM final
WHERE
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m19:10:10.625843 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:10:11.863810 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:403e8073-efe5-43a0-932c-1949e2b8c6d7&page=queryresults
[0m19:10:11.948719 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:403e8073-efe5-43a0-932c-1949e2b8c6d7&page=queryresults
[0m19:10:11.970445 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Function not found: parse_time_to_minutes at [105:25]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m19:10:11.972443 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '828f4f5e-9c57-479f-8c98-ac8681d957f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001960D919760>]}
[0m19:10:11.973443 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 1.37s]
[0m19:10:11.975443 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m19:10:11.976442 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Function not found: parse_time_to_minutes at [105:25]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m19:10:11.978893 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:10:11.979891 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:10:11.981782 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m19:10:11.983266 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m19:10:11.983266 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m19:10:11.984470 [info ] [MainThread]: 
[0m19:10:11.985898 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 14.16 seconds (14.16s).
[0m19:10:11.988134 [debug] [MainThread]: Command end result
[0m19:10:12.028577 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m19:10:12.035359 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m19:10:12.048688 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m19:10:12.048688 [info ] [MainThread]: 
[0m19:10:12.049688 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m19:10:12.050682 [info ] [MainThread]: 
[0m19:10:12.052104 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m19:10:12.053103 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Function not found: parse_time_to_minutes at [105:25]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m19:10:12.054107 [info ] [MainThread]: 
[0m19:10:12.055103 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m19:10:12.055103 [info ] [MainThread]: 
[0m19:10:12.056106 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m19:10:12.058108 [debug] [MainThread]: Command `dbt run` failed at 19:10:12.058108 after 24.19 seconds
[0m19:10:12.059187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001967DB8FE20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001960CF501C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001967D59EE20>]}
[0m19:10:12.060276 [debug] [MainThread]: Flushing usage events
[0m19:10:13.318194 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:16:11.154945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002488953FEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002488B7F2F70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002488B7F21C0>]}


============================== 19:16:11.162833 | 49781c76-8849-4edb-bbcf-422ca71a2f2e ==============================
[0m19:16:11.162833 [info ] [MainThread]: Running with dbt=1.10.11
[0m19:16:11.164334 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'quiet': 'False', 'empty': 'False', 'partial_parse': 'True', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m19:16:18.405474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '49781c76-8849-4edb-bbcf-422ca71a2f2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024892829070>]}
[0m19:16:18.535532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '49781c76-8849-4edb-bbcf-422ca71a2f2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024898886880>]}
[0m19:16:18.537573 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m19:16:20.350532 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m19:16:20.932252 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:16:20.933418 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:16:21.037381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '49781c76-8849-4edb-bbcf-422ca71a2f2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024899009130>]}
[0m19:16:21.233563 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m19:16:21.241534 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m19:16:21.322208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '49781c76-8849-4edb-bbcf-422ca71a2f2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024898FB0DC0>]}
[0m19:16:21.324558 [info ] [MainThread]: Found 2 models, 2 sources, 496 macros
[0m19:16:21.325558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49781c76-8849-4edb-bbcf-422ca71a2f2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024898FF50A0>]}
[0m19:16:21.328557 [info ] [MainThread]: 
[0m19:16:21.329557 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:16:21.330834 [info ] [MainThread]: 
[0m19:16:21.332303 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m19:16:21.344144 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m19:16:21.346316 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:16:27.230398 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m19:16:27.232699 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:16:28.175648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49781c76-8849-4edb-bbcf-422ca71a2f2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000248988D9730>]}
[0m19:16:28.176643 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:16:28.185998 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m19:16:28.186998 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m19:16:28.190059 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m19:16:28.191004 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m19:16:28.214688 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m19:16:28.217717 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m19:16:28.281146 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m19:16:28.283143 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
     -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m19:16:28.285981 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m19:16:29.394625 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:a400b912-2af0-4770-9135-7eec0c3d4b15&page=queryresults
[0m19:16:30.534436 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49781c76-8849-4edb-bbcf-422ca71a2f2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000248991099D0>]}
[0m19:16:30.536436 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 2.34s]
[0m19:16:30.538435 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m19:16:30.540438 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m19:16:30.542757 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m19:16:30.543758 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m19:16:30.545754 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m19:16:30.553804 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m19:16:30.557038 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m19:16:30.565130 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m19:16:30.569155 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        prefecture || city_name || 
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''),
                    r'Ôºà.*?Ôºâ', ''),
                '„Ç±', '„É∂'),
            'Êæ§', 'Ê≤¢')
        AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    SELECT
        * EXCEPT(distance_to_station_min),

        CAST(
            CASE
                WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                    (
                        parse_time_to_minutes(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)])
                        +
                        COALESCE(
                            parse_time_to_minutes(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(1)]),
                            parse_time_to_minutes(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)])
                        )
                    ) / 2
                ELSE parse_time_to_minutes(distance_to_station_min)
            END
        AS INT64) AS distance_to_station_min

    FROM joined
)

SELECT
    transaction_type,
    price_info_type,
    zipcode,
    prefecture,
    city_name,
    district_name,
    station_name,
    distance_to_station_min,
    total_price_jpy,
    price_per_tsubo_jpy,
    floor_plan,
    floor_plan_category,
    area_sq_m,
    price_per_sq_m,
    land_shape,
    frontage_m,
    total_floor_area_sq_m,
    built_year_ad AS built_year,
    EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
    building_structure,
    building_structure_category,
    purpose,
    future_purpose,
    road_direction,
    road_type,
    road_width_m,
    city_planning,
    building_coverage_ratio_pct,
    floor_area_ratio_pct,
    transaction_date,
    renovation,
    special_notes
FROM final
WHERE
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m19:16:30.571151 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:16:32.016885 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:0b823ec2-865d-4f44-b423-1176c07e85d1&page=queryresults
[0m19:16:32.105064 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:0b823ec2-865d-4f44-b423-1176c07e85d1&page=queryresults
[0m19:16:32.141085 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Function not found: parse_time_to_minutes at [105:25]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m19:16:32.143545 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49781c76-8849-4edb-bbcf-422ca71a2f2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002489954FB80>]}
[0m19:16:32.145546 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 1.60s]
[0m19:16:32.148931 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m19:16:32.150358 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Function not found: parse_time_to_minutes at [105:25]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m19:16:32.154529 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:16:32.156527 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:16:32.157537 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m19:16:32.159530 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m19:16:32.160534 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m19:16:32.162931 [info ] [MainThread]: 
[0m19:16:32.164930 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 10.83 seconds (10.83s).
[0m19:16:32.169170 [debug] [MainThread]: Command end result
[0m19:16:32.269855 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m19:16:32.278828 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m19:16:32.303262 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m19:16:32.304263 [info ] [MainThread]: 
[0m19:16:32.306284 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m19:16:32.307347 [info ] [MainThread]: 
[0m19:16:32.308369 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m19:16:32.310368 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Function not found: parse_time_to_minutes at [105:25]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m19:16:32.311369 [info ] [MainThread]: 
[0m19:16:32.313370 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m19:16:32.316725 [info ] [MainThread]: 
[0m19:16:32.318725 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m19:16:32.321725 [debug] [MainThread]: Command `dbt run` failed at 19:16:32.321725 after 21.31 seconds
[0m19:16:32.323721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002488953FEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024887918850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002488A8D4D60>]}
[0m19:16:32.324722 [debug] [MainThread]: Flushing usage events
[0m19:16:33.819954 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:29:27.012700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017AD226FE20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017AD4512EB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017AD45120D0>]}


============================== 19:29:27.019721 | 7d1e649b-5011-4c91-baa4-594902e84c5b ==============================
[0m19:29:27.019721 [info ] [MainThread]: Running with dbt=1.10.11
[0m19:29:27.021906 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'None', 'no_print': 'None', 'partial_parse': 'True', 'invocation_command': 'dbt clean', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m19:29:27.331663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7d1e649b-5011-4c91-baa4-594902e84c5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017AD3C86AF0>]}
[0m19:29:27.413356 [debug] [MainThread]: Command `dbt clean` succeeded at 19:29:27.411275 after 0.58 seconds
[0m19:29:27.413356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017AD226FE20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017AD1006E20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017AD45B8940>]}
[0m19:29:27.413356 [debug] [MainThread]: Flushing usage events
[0m19:29:28.760364 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:31:37.708801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EAF69FFE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EAF8CA3F40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EAF8CA31C0>]}


============================== 19:31:37.723310 | 94008803-cbca-4fb4-9a6c-c41021bdbd11 ==============================
[0m19:31:37.723310 [info ] [MainThread]: Running with dbt=1.10.11
[0m19:31:37.726697 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'quiet': 'False', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'use_experimental_parser': 'False', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m19:31:44.666955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '94008803-cbca-4fb4-9a6c-c41021bdbd11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EA85DA74C0>]}
[0m19:31:44.774205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '94008803-cbca-4fb4-9a6c-c41021bdbd11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EA85D9C3A0>]}
[0m19:31:44.776219 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m19:31:45.997256 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m19:31:45.997256 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m19:31:45.997256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '94008803-cbca-4fb4-9a6c-c41021bdbd11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EA85FA6730>]}
[0m19:31:48.368159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '94008803-cbca-4fb4-9a6c-c41021bdbd11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EA86832E80>]}
[0m19:31:48.511423 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m19:31:48.518927 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m19:31:48.562238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '94008803-cbca-4fb4-9a6c-c41021bdbd11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EA86803370>]}
[0m19:31:48.574302 [info ] [MainThread]: Found 2 models, 2 sources, 496 macros
[0m19:31:48.575979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '94008803-cbca-4fb4-9a6c-c41021bdbd11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EA86703130>]}
[0m19:31:48.578707 [info ] [MainThread]: 
[0m19:31:48.580850 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:31:48.580850 [info ] [MainThread]: 
[0m19:31:48.580850 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m19:31:48.591168 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m19:31:48.592205 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:31:56.074472 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m19:31:56.074472 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:31:56.822151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '94008803-cbca-4fb4-9a6c-c41021bdbd11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EA85D8E7F0>]}
[0m19:31:56.822151 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:31:56.833740 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m19:31:56.835328 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m19:31:56.835328 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m19:31:56.835328 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m19:31:56.851640 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m19:31:56.851640 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m19:31:56.916375 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m19:31:56.922446 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
     -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m19:31:56.922446 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m19:31:58.173762 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:183cd1c8-f4d5-4866-8596-8c02a8a722fb&page=queryresults
[0m19:31:59.216633 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94008803-cbca-4fb4-9a6c-c41021bdbd11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EA8793B6A0>]}
[0m19:31:59.220618 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 2.38s]
[0m19:31:59.220618 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m19:31:59.220618 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m19:31:59.220618 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m19:31:59.227029 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m19:31:59.227029 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m19:31:59.465738 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m19:31:59.469799 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m19:31:59.469799 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m19:31:59.469799 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- config„ÇíÂâäÈô§„Åó„ÄÅ„Éû„ÇØ„É≠Âëº„Å≥Âá∫„Åó„Å´‰øÆÊ≠£„Åó„ÅüÊúÄÁµÇÁâà
WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        prefecture || city_name || 
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''),
                    r'Ôºà.*?Ôºâ', ''),
                '„Ç±', '„É∂'),
            'Êæ§', 'Ê≤¢')
        AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    SELECT
        * EXCEPT(distance_to_station_min),

        CASE
            WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                CAST(
                    (
                        
    CAST(
        -- 'H'„ÅÆÂâç„ÅÆÊï∞ÂÄ§ (ÊôÇÈñì) „ÇíÂàÜ„Å´Â§âÊèõ
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)], r'(\d+)H') AS INT64), 0) * 60 +
        -- 'H'„ÅÆÂæå„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)], r'H(\d+)') AS INT64), 0) +
        -- 'H'„ÅåÂê´„Åæ„Çå„Å™„ÅÑÂ†¥Âêà„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        CASE
            WHEN NOT REGEXP_CONTAINS(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)], 'H') THEN COALESCE(SAFE_CAST(REGEXP_EXTRACT(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)], r'(\d+)'), AS INT64), 0)
            ELSE 0
        END
    AS INT64)

                        +
                        COALESCE(
                            
    CAST(
        -- 'H'„ÅÆÂâç„ÅÆÊï∞ÂÄ§ (ÊôÇÈñì) „ÇíÂàÜ„Å´Â§âÊèõ
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(1)], r'(\d+)H') AS INT64), 0) * 60 +
        -- 'H'„ÅÆÂæå„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(1)], r'H(\d+)') AS INT64), 0) +
        -- 'H'„ÅåÂê´„Åæ„Çå„Å™„ÅÑÂ†¥Âêà„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        CASE
            WHEN NOT REGEXP_CONTAINS(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(1)], 'H') THEN COALESCE(SAFE_CAST(REGEXP_EXTRACT(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(1)], r'(\d+)'), AS INT64), 0)
            ELSE 0
        END
    AS INT64)
,
                            
    CAST(
        -- 'H'„ÅÆÂâç„ÅÆÊï∞ÂÄ§ (ÊôÇÈñì) „ÇíÂàÜ„Å´Â§âÊèõ
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)], r'(\d+)H') AS INT64), 0) * 60 +
        -- 'H'„ÅÆÂæå„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)], r'H(\d+)') AS INT64), 0) +
        -- 'H'„ÅåÂê´„Åæ„Çå„Å™„ÅÑÂ†¥Âêà„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        CASE
            WHEN NOT REGEXP_CONTAINS(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)], 'H') THEN COALESCE(SAFE_CAST(REGEXP_EXTRACT(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)], r'(\d+)'), AS INT64), 0)
            ELSE 0
        END
    AS INT64)

                        )
                    ) / 2
                AS INT64)
            ELSE 
    CAST(
        -- 'H'„ÅÆÂâç„ÅÆÊï∞ÂÄ§ (ÊôÇÈñì) „ÇíÂàÜ„Å´Â§âÊèõ
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)H') AS INT64), 0) * 60 +
        -- 'H'„ÅÆÂæå„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'H(\d+)') AS INT64), 0) +
        -- 'H'„ÅåÂê´„Åæ„Çå„Å™„ÅÑÂ†¥Âêà„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        CASE
            WHEN NOT REGEXP_CONTAINS(distance_to_station_min, 'H') THEN COALESCE(SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)'), AS INT64), 0)
            ELSE 0
        END
    AS INT64)

        END AS distance_to_station_min

    FROM joined
)

SELECT
    transaction_type,
    price_info_type,
    zipcode,
    prefecture,
    city_name,
    district_name,
    station_name,
    distance_to_station_min,
    total_price_jpy,
    price_per_tsubo_jpy,
    floor_plan,
    floor_plan_category,
    area_sq_m,
    price_per_sq_m,
    land_shape,
    frontage_m,
    total_floor_area_sq_m,
    built_year_ad AS built_year,
    EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
    building_structure,
    building_structure_category,
    purpose,
    future_purpose,
    road_direction,
    road_type,
    road_width_m,
    city_planning,
    building_coverage_ratio_pct,
    floor_area_ratio_pct,
    transaction_date,
    renovation,
    special_notes
FROM final
WHERE
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m19:31:59.478116 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:32:00.152244 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:d184925d-5c76-40a8-92ff-fe394b6f829e&page=queryresults
[0m19:32:00.152244 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:d184925d-5c76-40a8-92ff-fe394b6f829e&page=queryresults
[0m19:32:00.171793 [debug] [Thread-1  ]: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [114:235]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m19:32:00.171793 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94008803-cbca-4fb4-9a6c-c41021bdbd11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EA8793B460>]}
[0m19:32:00.171793 [error] [Thread-1  ]: 2 of 2 ERROR creating sql view model real_estate_silver.stg_transactions ....... [[31mERROR[0m in 0.94s]
[0m19:32:00.176795 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m19:32:00.176795 [debug] [Thread-4  ]: Marking all children of 'model.realestate_analytics.stg_transactions' to be skipped because of status 'error'.  Reason: Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [114:235]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql.
[0m19:32:00.179904 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:32:00.182912 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:32:00.182912 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m19:32:00.182912 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m19:32:00.185623 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m19:32:00.185623 [info ] [MainThread]: 
[0m19:32:00.185623 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 11.60 seconds (11.60s).
[0m19:32:00.188686 [debug] [MainThread]: Command end result
[0m19:32:00.227576 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m19:32:00.228083 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m19:32:00.245141 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m19:32:00.245141 [info ] [MainThread]: 
[0m19:32:00.246479 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m19:32:00.247833 [info ] [MainThread]: 
[0m19:32:00.247833 [error] [MainThread]: [31mFailure in model stg_transactions (models\stg_transactions.sql)[0m
[0m19:32:00.247833 [error] [MainThread]:   Database Error in model stg_transactions (models\stg_transactions.sql)
  Syntax error: Expected keyword AS but got "," at [114:235]
  compiled code at target\run\realestate_analytics\models\stg_transactions.sql
[0m19:32:00.247833 [info ] [MainThread]: 
[0m19:32:00.251863 [info ] [MainThread]:   compiled code at target\compiled\realestate_analytics\models\stg_transactions.sql
[0m19:32:00.251863 [info ] [MainThread]: 
[0m19:32:00.253465 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m19:32:00.255147 [debug] [MainThread]: Command `dbt run` failed at 19:32:00.255147 after 22.68 seconds
[0m19:32:00.256555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EAF69FFE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EA868033D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EA865E2610>]}
[0m19:32:00.257571 [debug] [MainThread]: Flushing usage events
[0m19:32:01.519613 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:36:27.200061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A23087FEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A232B23F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A232B23220>]}


============================== 19:36:27.202477 | dada0077-b031-4cf1-ace8-85de1af544f1 ==============================
[0m19:36:27.202477 [info ] [MainThread]: Running with dbt=1.10.11
[0m19:36:27.208909 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'empty': 'False', 'partial_parse': 'True', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m19:36:34.182649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dada0077-b031-4cf1-ace8-85de1af544f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A22F6162B0>]}
[0m19:36:34.287131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dada0077-b031-4cf1-ace8-85de1af544f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A231CF23A0>]}
[0m19:36:34.287131 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m19:36:35.722125 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m19:36:36.427395 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:36:36.427395 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://macros\parse_time_to_minutes.sql
[0m19:36:36.855852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dada0077-b031-4cf1-ace8-85de1af544f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A240526130>]}
[0m19:36:36.989936 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m19:36:36.989936 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m19:36:37.056139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dada0077-b031-4cf1-ace8-85de1af544f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A24050F880>]}
[0m19:36:37.056139 [info ] [MainThread]: Found 2 models, 2 sources, 496 macros
[0m19:36:37.056139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dada0077-b031-4cf1-ace8-85de1af544f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A240305730>]}
[0m19:36:37.070780 [info ] [MainThread]: 
[0m19:36:37.071721 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:36:37.073441 [info ] [MainThread]: 
[0m19:36:37.073441 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m19:36:37.077613 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m19:36:37.084862 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:36:41.160739 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m19:36:41.160739 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:36:41.899673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dada0077-b031-4cf1-ace8-85de1af544f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A23FBEFB80>]}
[0m19:36:41.899673 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:36:41.911954 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m19:36:41.913507 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m19:36:41.913507 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m19:36:41.913507 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m19:36:41.929420 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m19:36:41.931468 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m19:36:41.978123 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m19:36:41.980668 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
     -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m19:36:41.980668 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m19:36:42.948593 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:75edb5d0-ae20-4c52-a835-5fc84b417d55&page=queryresults
[0m19:36:43.633864 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dada0077-b031-4cf1-ace8-85de1af544f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2405FF9A0>]}
[0m19:36:43.635629 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.72s]
[0m19:36:43.635629 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m19:36:43.635629 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m19:36:43.640241 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m19:36:43.640241 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m19:36:43.640241 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m19:36:43.652383 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m19:36:43.655438 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m19:36:43.660028 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m19:36:43.661545 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- config„ÇíÂâäÈô§„Åó„ÄÅ„Éû„ÇØ„É≠Âëº„Å≥Âá∫„Åó„Å´‰øÆÊ≠£„Åó„ÅüÊúÄÁµÇÁâà
WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        prefecture || city_name || 
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''),
                    r'Ôºà.*?Ôºâ', ''),
                '„Ç±', '„É∂'),
            'Êæ§', 'Ê≤¢')
        AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    SELECT
        * EXCEPT(distance_to_station_min),

        CASE
            WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                CAST(
                    (
                        
    CAST(
        -- 'H'„ÅÆÂâç„ÅÆÊï∞ÂÄ§ (ÊôÇÈñì) „ÇíÂàÜ„Å´Â§âÊèõ
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)], r'(\d+)H') AS INT64), 0) * 60 +
        -- 'H'„ÅÆÂæå„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)], r'H(\d+)') AS INT64), 0) +
        -- 'H'„ÅåÂê´„Åæ„Çå„Å™„ÅÑÂ†¥Âêà„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        CASE
            WHEN NOT REGEXP_CONTAINS(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)], 'H') THEN COALESCE(SAFE_CAST(REGEXP_EXTRACT(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)], r'(\d+)') AS INT64), 0)
            ELSE 0
        END
    AS INT64)

                        +
                        COALESCE(
                            
    CAST(
        -- 'H'„ÅÆÂâç„ÅÆÊï∞ÂÄ§ (ÊôÇÈñì) „ÇíÂàÜ„Å´Â§âÊèõ
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(1)], r'(\d+)H') AS INT64), 0) * 60 +
        -- 'H'„ÅÆÂæå„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(1)], r'H(\d+)') AS INT64), 0) +
        -- 'H'„ÅåÂê´„Åæ„Çå„Å™„ÅÑÂ†¥Âêà„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        CASE
            WHEN NOT REGEXP_CONTAINS(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(1)], 'H') THEN COALESCE(SAFE_CAST(REGEXP_EXTRACT(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(1)], r'(\d+)') AS INT64), 0)
            ELSE 0
        END
    AS INT64)
,
                            
    CAST(
        -- 'H'„ÅÆÂâç„ÅÆÊï∞ÂÄ§ (ÊôÇÈñì) „ÇíÂàÜ„Å´Â§âÊèõ
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)], r'(\d+)H') AS INT64), 0) * 60 +
        -- 'H'„ÅÆÂæå„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)], r'H(\d+)') AS INT64), 0) +
        -- 'H'„ÅåÂê´„Åæ„Çå„Å™„ÅÑÂ†¥Âêà„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        CASE
            WHEN NOT REGEXP_CONTAINS(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)], 'H') THEN COALESCE(SAFE_CAST(REGEXP_EXTRACT(SAFE.SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[OFFSET(0)], r'(\d+)') AS INT64), 0)
            ELSE 0
        END
    AS INT64)

                        )
                    ) / 2
                AS INT64)
            ELSE 
    CAST(
        -- 'H'„ÅÆÂâç„ÅÆÊï∞ÂÄ§ (ÊôÇÈñì) „ÇíÂàÜ„Å´Â§âÊèõ
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)H') AS INT64), 0) * 60 +
        -- 'H'„ÅÆÂæå„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'H(\d+)') AS INT64), 0) +
        -- 'H'„ÅåÂê´„Åæ„Çå„Å™„ÅÑÂ†¥Âêà„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        CASE
            WHEN NOT REGEXP_CONTAINS(distance_to_station_min, 'H') THEN COALESCE(SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)') AS INT64), 0)
            ELSE 0
        END
    AS INT64)

        END AS distance_to_station_min

    FROM joined
)

SELECT
    transaction_type,
    price_info_type,
    zipcode,
    prefecture,
    city_name,
    district_name,
    station_name,
    distance_to_station_min,
    total_price_jpy,
    price_per_tsubo_jpy,
    floor_plan,
    floor_plan_category,
    area_sq_m,
    price_per_sq_m,
    land_shape,
    frontage_m,
    total_floor_area_sq_m,
    built_year_ad AS built_year,
    EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
    building_structure,
    building_structure_category,
    purpose,
    future_purpose,
    road_direction,
    road_type,
    road_width_m,
    city_planning,
    building_coverage_ratio_pct,
    floor_area_ratio_pct,
    transaction_date,
    renovation,
    special_notes
FROM final
WHERE
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m19:36:43.663577 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:36:44.738823 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:d66adfea-6d52-4b83-b5ed-ac921cc11a0f&page=queryresults
[0m19:36:45.233288 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dada0077-b031-4cf1-ace8-85de1af544f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A23FDF0760>]}
[0m19:36:45.233288 [info ] [Thread-1  ]: 2 of 2 OK created sql view model real_estate_silver.stg_transactions ........... [[32mCREATE VIEW (0 processed)[0m in 1.59s]
[0m19:36:45.233288 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m19:36:45.252259 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:36:45.252259 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:36:45.252259 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m19:36:45.252259 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m19:36:45.252259 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m19:36:45.252259 [info ] [MainThread]: 
[0m19:36:45.252259 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 8.18 seconds (8.18s).
[0m19:36:45.252259 [debug] [MainThread]: Command end result
[0m19:36:45.300109 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m19:36:45.303512 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m19:36:45.317364 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m19:36:45.319165 [info ] [MainThread]: 
[0m19:36:45.319165 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:36:45.319165 [info ] [MainThread]: 
[0m19:36:45.319165 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m19:36:45.319165 [debug] [MainThread]: Command `dbt run` succeeded at 19:36:45.319165 after 18.27 seconds
[0m19:36:45.319165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A23087FEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A232AB2F70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A240526FD0>]}
[0m19:36:45.319165 [debug] [MainThread]: Flushing usage events
[0m19:36:46.539729 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:40:49.556892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019E9B55FE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019E9D802F40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019E9D8021C0>]}


============================== 19:40:49.565339 | 546176e8-1cdf-4fea-a8fe-986e6e2fc026 ==============================
[0m19:40:49.565339 [info ] [MainThread]: Running with dbt=1.10.11
[0m19:40:49.567389 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'empty': 'False', 'no_print': 'None', 'warn_error': 'None', 'log_path': 'C:\\Users\\yshoo\\Desktop\\DataScience\\RealEstateAnalytics\\dbt_project\\logs', 'invocation_command': 'dbt run', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\yshoo\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m19:40:56.033589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '546176e8-1cdf-4fea-a8fe-986e6e2fc026', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019E99938BB0>]}
[0m19:40:56.139383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '546176e8-1cdf-4fea-a8fe-986e6e2fc026', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019EAA917B80>]}
[0m19:40:56.141384 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m19:40:57.571544 [debug] [MainThread]: checksum: 5335e1629744fab92fa7809c625edbb36f0d7063a879d6215c971798f27e66f9, vars: {}, profile: , target: , version: 1.10.11
[0m19:40:58.143250 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:40:58.144248 [debug] [MainThread]: Partial parsing: updated file: realestate_analytics://models\stg_transactions.sql
[0m19:40:58.568996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '546176e8-1cdf-4fea-a8fe-986e6e2fc026', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019EAB207130>]}
[0m19:40:58.713043 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m19:40:58.718503 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m19:40:58.779268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '546176e8-1cdf-4fea-a8fe-986e6e2fc026', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019E9B430760>]}
[0m19:40:58.780269 [info ] [MainThread]: Found 2 models, 2 sources, 496 macros
[0m19:40:58.781271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '546176e8-1cdf-4fea-a8fe-986e6e2fc026', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019EAAFE69D0>]}
[0m19:40:58.783532 [info ] [MainThread]: 
[0m19:40:58.784534 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:40:58.785921 [info ] [MainThread]: 
[0m19:40:58.787920 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m19:40:58.796422 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025'
[0m19:40:58.797422 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:41:02.688346 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_real-estate-project-2025_real_estate_silver'
[0m19:41:02.689354 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:41:03.390104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '546176e8-1cdf-4fea-a8fe-986e6e2fc026', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019EAB0BF580>]}
[0m19:41:03.391105 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:41:03.398859 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_zipcodes
[0m19:41:03.401230 [info ] [Thread-1  ]: 1 of 2 START sql view model real_estate_silver.stg_zipcodes .................... [RUN]
[0m19:41:03.402229 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.realestate_analytics.stg_zipcodes'
[0m19:41:03.404708 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_zipcodes
[0m19:41:03.418773 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_zipcodes"
[0m19:41:03.420757 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_zipcodes
[0m19:41:03.471716 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_zipcodes"
[0m19:41:03.473719 [debug] [Thread-1  ]: On model.realestate_analytics.stg_zipcodes: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_zipcodes"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
  OPTIONS()
  as -- models/stg_zipcodes.sql

WITH source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_zipcode`
)

SELECT
    zipcode,
    prefecture,
    city_name,
    district_name,
     -- ‚òÖ‚òÖ‚òÖ ÊúÄÁµÇÁâà„ÅÆÂØæÁß∞„ÇØ„É™„Éº„Éã„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØ ‚òÖ‚òÖ‚òÖ
    prefecture || city_name ||
        REPLACE(
            REPLACE(
                REGEXP_REPLACE(district_name, r'Ôºà.*?Ôºâ', ''), -- 1. Êã¨Âºß„ÇíÈô§Âéª
            '„Ç±', '„É∂'), -- 2. „Ç±„Çí„É∂„Å´Áµ±‰∏Ä
        'Êæ§', 'Ê≤¢') -- 3. Êæ§„ÇíÊ≤¢„Å´Áµ±‰∏Ä
    AS address_key
FROM
    source;


[0m19:41:03.474718 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m19:41:04.493467 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:b6adb2bb-ef09-46de-af7c-c3278808ca20&page=queryresults
[0m19:41:05.392207 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '546176e8-1cdf-4fea-a8fe-986e6e2fc026', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019EAB2DC550>]}
[0m19:41:05.394502 [info ] [Thread-1  ]: 1 of 2 OK created sql view model real_estate_silver.stg_zipcodes ............... [[32mCREATE VIEW (0 processed)[0m in 1.99s]
[0m19:41:05.395541 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_zipcodes
[0m19:41:05.397976 [debug] [Thread-1  ]: Began running node model.realestate_analytics.stg_transactions
[0m19:41:05.399210 [info ] [Thread-1  ]: 2 of 2 START sql view model real_estate_silver.stg_transactions ................ [RUN]
[0m19:41:05.400399 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.realestate_analytics.stg_zipcodes, now model.realestate_analytics.stg_transactions)
[0m19:41:05.401396 [debug] [Thread-1  ]: Began compiling node model.realestate_analytics.stg_transactions
[0m19:41:05.409988 [debug] [Thread-1  ]: Writing injected SQL for node "model.realestate_analytics.stg_transactions"
[0m19:41:05.412197 [debug] [Thread-1  ]: Began executing node model.realestate_analytics.stg_transactions
[0m19:41:05.416858 [debug] [Thread-1  ]: Writing runtime sql for node "model.realestate_analytics.stg_transactions"
[0m19:41:05.418862 [debug] [Thread-1  ]: On model.realestate_analytics.stg_transactions: /* {"app": "dbt", "dbt_version": "1.10.11", "profile_name": "realestate_analytics", "target_name": "dev", "node_id": "model.realestate_analytics.stg_transactions"} */


  create or replace view `real-estate-project-2025`.`real_estate_silver`.`stg_transactions`
  OPTIONS()
  as -- config„ÇíÂâäÈô§„Åó„ÄÅ„Éû„ÇØ„É≠Âëº„Å≥Âá∫„Åó„Å´‰øÆÊ≠£„Åó„ÅüÊúÄÁµÇÁâà
WITH zipcodes AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_silver`.`stg_zipcodes`
),

source AS (
    SELECT * FROM `real-estate-project-2025`.`real_estate_bronze`.`raw_land`
    WHERE type NOT IN ('ÊûóÂú∞', 'Ëæ≤Âú∞')
),

interim AS (
    SELECT
        type AS transaction_type,
        price_info_type,
        prefecture,
        city_name,
        district_name,
        station_name,
        distance_to_station_min,
        SAFE_CAST(total_price AS INT64) AS total_price_jpy,
        SAFE_CAST(price_per_tsubo AS INT64) AS price_per_tsubo_jpy,
        floor_plan,
        SAFE_CAST(area_sq_m AS INT64) AS area_sq_m,
        SAFE_CAST(price_per_sq_m AS INT64) AS price_per_sq_m,
        land_shape,
        SAFE_CAST(frontage AS FLOAT64) AS frontage_m,
        SAFE_CAST(total_floor_area_sq_m AS INT64) AS total_floor_area_sq_m,
        building_structure,
        purpose,
        future_purpose,
        road_direction,
        road_type,
        SAFE_CAST(road_width_m AS FLOAT64) AS road_width_m,
        city_planning,
        SAFE_CAST(building_coverage_ratio_pct AS INT64) AS building_coverage_ratio_pct,
        SAFE_CAST(floor_area_ratio_pct AS INT64) AS floor_area_ratio_pct,
        CAST(
            REPLACE(REPLACE(REPLACE(REPLACE(transaction_period, 'Âπ¥Á¨¨1ÂõõÂçäÊúü', '-01-01'), 'Âπ¥Á¨¨2ÂõõÂçäÊúü', '-04-01'), 'Âπ¥Á¨¨3ÂõõÂçäÊúü', '-07-01'), 'Âπ¥Á¨¨4ÂõõÂçäÊúü', '-10-01')
        AS DATE) AS transaction_date,
        renovation,
        special_notes,
        CASE
            WHEN STARTS_WITH(built_year, 'Êò≠Âíå') THEN 1925 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, 'Âπ≥Êàê') THEN 1988 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            WHEN STARTS_WITH(built_year, '‰ª§Âíå') THEN 2018 + SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
            ELSE SAFE_CAST(REGEXP_EXTRACT(built_year, r'(\d+)') AS INT64)
        END AS built_year_ad,
        CASE
            WHEN floor_plan IN ('ÔºëÔº≤', 'ÔºëÔº´', '„Çπ„Çø„Ç∏„Ç™', '„Ç™„Éº„Éó„É≥„Éï„É≠„Ç¢') THEN '1 Room'
            WHEN floor_plan = 'ÔºëÔº§Ôº´' THEN '1DK'
            WHEN floor_plan = 'ÔºëÔº¨Ôº§Ôº´' THEN '1LDK'
            WHEN floor_plan IN ('ÔºíÔº´', 'ÔºíÔº§Ôº´') THEN '2K/DK'
            WHEN floor_plan = 'ÔºíÔº¨Ôº§Ôº´' THEN '2LDK'
            WHEN floor_plan IN ('ÔºìÔº´', 'ÔºìÔº§Ôº´') THEN '3K/DK'
            WHEN floor_plan = 'ÔºìÔº¨Ôº§Ôº´' THEN '3LDK'
            WHEN floor_plan LIKE 'Ôºî%' OR floor_plan LIKE 'Ôºï%' OR floor_plan LIKE 'Ôºñ%' OR floor_plan LIKE 'Ôºó%' THEN '4 Rooms+'
            ELSE 'Other'
        END AS floor_plan_category,
        CASE
            WHEN building_structure = 'Ôº≥Ôº≤Ôº£' THEN 'SRC'
            WHEN building_structure = 'Ôº≤Ôº£' THEN 'RC'
            WHEN building_structure IN ('ÈâÑÈ™®ÈÄ†', 'ËªΩÈáèÈâÑÈ™®ÈÄ†') THEN 'ÈâÑÈ™®ÈÄ†'
            WHEN building_structure = 'Êú®ÈÄ†' THEN 'Êú®ÈÄ†'
            WHEN building_structure LIKE '%Ôº≥Ôº≤Ôº£%' OR building_structure LIKE '%Ôº≤Ôº£%' THEN 'Ë§áÂêàSRC/RC'
            WHEN building_structure LIKE '%ÈâÑÈ™®%' THEN 'Ë§áÂêàÈâÑÈ™®'
            WHEN building_structure LIKE '%Êú®ÈÄ†%' THEN 'Ë§áÂêàÊú®ÈÄ†'
            WHEN building_structure IS NULL THEN NULL
            ELSE '„Åù„ÅÆ‰ªñ'
        END AS building_structure_category,
        prefecture || city_name || 
            REPLACE(
                REPLACE(
                    REGEXP_REPLACE(
                        REGEXP_REPLACE(district_name, r'^Â§ßÂ≠ó', ''),
                    r'Ôºà.*?Ôºâ', ''),
                '„Ç±', '„É∂'),
            'Êæ§', 'Ê≤¢')
        AS address_key

    FROM source
),

joined AS (
    SELECT
        interim.*,
        zipcodes.zipcode
    FROM
        interim
    LEFT JOIN zipcodes
        ON interim.address_key = zipcodes.address_key
),

final AS (
    SELECT
        * EXCEPT(distance_to_station_min), -- ÂÖÉ„ÅÆÊñáÂ≠óÂàó„Ç´„É©„É†„ÇíÈô§Â§ñ

        CAST(
            CASE
                -- 'ÔΩû'„Åã'~'„ÇíÂê´„ÇÄÁØÑÂõ≤„ÅÆÂ†¥Âêà
                WHEN REGEXP_CONTAINS(distance_to_station_min, 'ÔΩû|~') THEN
                    (
                        -- ÂâçÂçäÈÉ®ÂàÜ„Çí„Éû„ÇØ„É≠„ÅßÂ§âÊèõ
                        
    CAST(
        -- 'H'„ÅÆÂâç„ÅÆÊï∞ÂÄ§ (ÊôÇÈñì) „ÇíÂàÜ„Å´Â§âÊèõ
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[SAFE_OFFSET(0)], r'(\d+)H') AS INT64), 0) * 60 +
        -- 'H'„ÅÆÂæå„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[SAFE_OFFSET(0)], r'H(\d+)') AS INT64), 0) +
        -- 'H'„ÅåÂê´„Åæ„Çå„Å™„ÅÑÂ†¥Âêà„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        CASE
            WHEN NOT REGEXP_CONTAINS(SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[SAFE_OFFSET(0)], 'H') THEN COALESCE(SAFE_CAST(REGEXP_EXTRACT(SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[SAFE_OFFSET(0)], r'(\d+)') AS INT64), 0)
            ELSE 0
        END
    AS INT64)

                        +
                        -- ÂæåÂçäÈÉ®ÂàÜ„Çí„Éû„ÇØ„É≠„ÅßÂ§âÊèõ„ÄÇ„Åü„Å†„Åó'2HÔΩû'„ÅÆ„Çà„ÅÜ„Å´ÂæåÂçä„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄÅÂâçÂçä„Å®Âêå„ÅòÂÄ§„Çí‰Ωø„ÅÜ
                        COALESCE(
                            
    CAST(
        -- 'H'„ÅÆÂâç„ÅÆÊï∞ÂÄ§ (ÊôÇÈñì) „ÇíÂàÜ„Å´Â§âÊèõ
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[SAFE_OFFSET(1)], r'(\d+)H') AS INT64), 0) * 60 +
        -- 'H'„ÅÆÂæå„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[SAFE_OFFSET(1)], r'H(\d+)') AS INT64), 0) +
        -- 'H'„ÅåÂê´„Åæ„Çå„Å™„ÅÑÂ†¥Âêà„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        CASE
            WHEN NOT REGEXP_CONTAINS(SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[SAFE_OFFSET(1)], 'H') THEN COALESCE(SAFE_CAST(REGEXP_EXTRACT(SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[SAFE_OFFSET(1)], r'(\d+)') AS INT64), 0)
            ELSE 0
        END
    AS INT64)
,
                            
    CAST(
        -- 'H'„ÅÆÂâç„ÅÆÊï∞ÂÄ§ (ÊôÇÈñì) „ÇíÂàÜ„Å´Â§âÊèõ
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[SAFE_OFFSET(0)], r'(\d+)H') AS INT64), 0) * 60 +
        -- 'H'„ÅÆÂæå„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[SAFE_OFFSET(0)], r'H(\d+)') AS INT64), 0) +
        -- 'H'„ÅåÂê´„Åæ„Çå„Å™„ÅÑÂ†¥Âêà„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        CASE
            WHEN NOT REGEXP_CONTAINS(SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[SAFE_OFFSET(0)], 'H') THEN COALESCE(SAFE_CAST(REGEXP_EXTRACT(SPLIT(REPLACE(distance_to_station_min, '~', 'ÔΩû'), 'ÔΩû')[SAFE_OFFSET(0)], r'(\d+)') AS INT64), 0)
            ELSE 0
        END
    AS INT64)

                        )
                    ) / 2
                -- ÁØÑÂõ≤„Åß„ÅØ„Å™„ÅÑÂçòÁ¥î„Å™ÂÄ§„ÅÆÂ†¥Âêà
                ELSE 
    CAST(
        -- 'H'„ÅÆÂâç„ÅÆÊï∞ÂÄ§ (ÊôÇÈñì) „ÇíÂàÜ„Å´Â§âÊèõ
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)H') AS INT64), 0) * 60 +
        -- 'H'„ÅÆÂæå„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        COALESCE(SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'H(\d+)') AS INT64), 0) +
        -- 'H'„ÅåÂê´„Åæ„Çå„Å™„ÅÑÂ†¥Âêà„ÅÆÊï∞ÂÄ§ (ÂàÜ) „ÇíÂèñÂæó
        CASE
            WHEN NOT REGEXP_CONTAINS(distance_to_station_min, 'H') THEN COALESCE(SAFE_CAST(REGEXP_EXTRACT(distance_to_station_min, r'(\d+)') AS INT64), 0)
            ELSE 0
        END
    AS INT64)

            END
        AS INT64) AS distance_to_station_min -- „ÇØ„É¨„É≥„Ç∏„É≥„Ç∞Âæå„ÅÆÂÄ§„ÇíÂÖÉ„ÅÆ„Ç´„É©„É†Âêç„Åß‰ΩúÊàê

    FROM joined
)

SELECT
    transaction_type,
    price_info_type,
    zipcode,
    prefecture,
    city_name,
    district_name,
    station_name,
    distance_to_station_min,
    total_price_jpy,
    price_per_tsubo_jpy,
    floor_plan,
    floor_plan_category,
    area_sq_m,
    price_per_sq_m,
    land_shape,
    frontage_m,
    total_floor_area_sq_m,
    built_year_ad AS built_year,
    EXTRACT(YEAR FROM transaction_date) - built_year_ad AS building_age_at_transaction,
    building_structure,
    building_structure_category,
    purpose,
    future_purpose,
    road_direction,
    road_type,
    road_width_m,
    city_planning,
    building_coverage_ratio_pct,
    floor_area_ratio_pct,
    transaction_date,
    renovation,
    special_notes
FROM final
WHERE
    city_name NOT IN ('‰∏âÂÆÖÊùë', 'ÂÖ´‰∏àÁî∫', 'Êñ∞Â≥∂Êùë', 'Â§ßÂ≥∂Áî∫', 'Á•ûÊ¥•Â≥∂Êùë', 'Èùí„Ç±Â≥∂Êùë', 'Âæ°ËîµÂ≥∂Êùë', 'Âà©Â≥∂Êùë', 'Â∞èÁ¨†ÂéüÊùë')
    AND district_name IS NOT NULL
    AND district_name != ''
    AND district_name != 'ÔºàÂ§ßÂ≠ó„Å™„ÅóÔºâ';


[0m19:41:05.420863 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:41:06.611539 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=real-estate-project-2025&j=bq:asia-northeast1:8c56acda-a6a6-40db-a4b0-70c63f169ed6&page=queryresults
[0m19:41:07.065746 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '546176e8-1cdf-4fea-a8fe-986e6e2fc026', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019EAC6AA580>]}
[0m19:41:07.066744 [info ] [Thread-1  ]: 2 of 2 OK created sql view model real_estate_silver.stg_transactions ........... [[32mCREATE VIEW (0 processed)[0m in 1.66s]
[0m19:41:07.068108 [debug] [Thread-1  ]: Finished running node model.realestate_analytics.stg_transactions
[0m19:41:07.070529 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:41:07.071535 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:41:07.072534 [debug] [MainThread]: Connection 'list_real-estate-project-2025' was properly closed.
[0m19:41:07.073534 [debug] [MainThread]: Connection 'list_real-estate-project-2025_real_estate_silver' was properly closed.
[0m19:41:07.073534 [debug] [MainThread]: Connection 'model.realestate_analytics.stg_transactions' was properly closed.
[0m19:41:07.074534 [info ] [MainThread]: 
[0m19:41:07.075527 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 8.29 seconds (8.29s).
[0m19:41:07.078053 [debug] [MainThread]: Command end result
[0m19:41:07.118297 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\manifest.json
[0m19:41:07.124086 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\semantic_manifest.json
[0m19:41:07.136568 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\yshoo\Desktop\DataScience\RealEstateAnalytics\dbt_project\target\run_results.json
[0m19:41:07.137580 [info ] [MainThread]: 
[0m19:41:07.138796 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:41:07.139778 [info ] [MainThread]: 
[0m19:41:07.141089 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m19:41:07.143540 [debug] [MainThread]: Command `dbt run` succeeded at 19:41:07.143540 after 17.84 seconds
[0m19:41:07.144695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019E9B55FE80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019E9AF1B730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019EAA917B80>]}
[0m19:41:07.145759 [debug] [MainThread]: Flushing usage events
[0m19:41:08.397825 [debug] [MainThread]: An error was encountered while trying to flush usage events
